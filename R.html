<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Paul Rougieux" />

<meta name="date" content="2017-08-17" />

<title>R Commands</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Paul Rougieux</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Tools
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="bash.html">Bash</a>
    </li>
    <li>
      <a href="communication.html">Communication</a>
    </li>
    <li>
      <a href="debian.html">Debian</a>
    </li>
    <li>
      <a href="docker.html">Docker</a>
    </li>
    <li>
      <a href="git.html">Git</a>
    </li>
    <li>
      <a href="learning.html">Learning</a>
    </li>
    <li>
      <a href="lyx.html">Lyx</a>
    </li>
    <li>
      <a href="mysql.html">MySQL</a>
    </li>
    <li>
      <a href="postgresql.html">PostgreSQL</a>
    </li>
    <li>
      <a href="publish.html">Publish</a>
    </li>
    <li>
      <a href="python.html">Python</a>
    </li>
    <li>
      <a href="R.html">R</a>
    </li>
    <li>
      <a href="vim.html">Vim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-microchip"></span>
     
    Algos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="clustering.html">Clustering</a>
    </li>
    <li>
      <a href="musical_scales.html">Musical scales</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="datasources.html">Sources</a>
    </li>
    <li>
      <a href="explore.html">Explore</a>
    </li>
  </ul>
</li>
<li>
  <a href="events.html">
    <span class="fa fa-users"></span>
     
    Events
  </a>
</li>
<li>
  <a href="publications.html">
    <span class="fa fa-book"></span>
     
    Publications
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R Commands</h1>
<h4 class="author">Paul Rougieux</h4>
<h4 class="date">17 August 2017</h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This page is the continuation of <a href="https://paulremote.blogspot.de/2014/04/r-commands.html">my blog post on R commands</a>. On the blog, see also <a href="http://paulremote.blogspot.fr/2013/10/why-r.html">why use R</a> and the <a href="http://paulremote.blogspot.com/feeds/posts/default/-/R">RSS feed of posts labelled R</a>.</p>
<p>See also documentation at:</p>
<ul>
<li>The Comprehensive R Archive Network CRAN <a href="https://cran.r-project.org/manuals.html">manuals</a></li>
<li>The Tidyverse <a href="http://www.tidyverse.org/packages/">packages</a></li>
</ul>
</div>
<div id="control-flow" class="section level1">
<h1>Control flow</h1>
<p>dplyr::case_when is a generalised vectorised if. Example use:</p>
<pre><code> x &lt;- 1:50
 case_when(
   x %% 35 == 0 ~ &quot;fizz buzz&quot;,
   x %% 5 == 0 ~ &quot;fizz&quot;,
   x %% 7 == 0 ~ &quot;buzz&quot;,
   TRUE ~ as.character(x)
 )</code></pre>
</div>
<div id="data-types" class="section level1">
<h1>Data types</h1>
<div id="everything-is-a-vector" class="section level2">
<h2>Everything is a vector</h2>
<p>There are no scalar values in R, only vectors, this makes it very natural to process times series or cross sectional data over many N observations as if we were processing only one instance.</p>
<p><a href="https://stackoverflow.com/a/7500961/2641825">SO answer concerning indexing up to end of vector/matrix</a> “Sometimes it’s easier to tell R what you don’t want”</p>
<pre><code>x &lt;- c(5,5,4,3,2,1)
x[-(1:3)]
x[-c(1,3,6)]</code></pre>
<div id="set-operations" class="section level3">
<h3>Set operations</h3>
<pre class="r"><code>x = letters[1:3]
y = letters[3:5]
union(x, y)</code></pre>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot;</code></pre>
<pre class="r"><code>intersect(x, y)</code></pre>
<pre><code>## [1] &quot;c&quot;</code></pre>
<pre class="r"><code>setdiff(x, y)</code></pre>
<pre><code>## [1] &quot;a&quot; &quot;b&quot;</code></pre>
<pre class="r"><code>setdiff(y, x)</code></pre>
<pre><code>## [1] &quot;d&quot; &quot;e&quot;</code></pre>
<pre class="r"><code>setequal(x, y)</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="factors" class="section level2">
<h2>Factors</h2>
<p><a href="https://stackoverflow.com/questions/45148897/how-to-reorder-factor-levels-in-a-tidy-way/59246372#59246372">My answer to the question how to reorder factor levels the tidy way</a></p>
<p>If you happen to have a character vector to order, for example:</p>
<pre><code>iris2 &lt;- iris %&gt;%
    mutate(Species = as.character(Species)) %&gt;%
    group_by(Species) %&gt;%
    mutate(mean_sepal_width = mean(Sepal.Width)) %&gt;%
    ungroup()</code></pre>
<p>You can also order the factor level using the behavior of the forcats::as_factor function :</p>
<pre><code>&quot;Compared to base R, this function creates levels in the order in which they appear&quot;

library(forcats)
iris2 %&gt;%
    # Change the order
    arrange(mean_sepal_width) %&gt;%
    # Create factor levels in the order in which they appear
    mutate(Species = forcats::as_factor(Species)) %&gt;%
    ggplot() +
    aes(Species, Sepal.Width, color = Species) +
    geom_point()</code></pre>
<p>Notice how the species names on the x axis are not ordered alphabetically but by increasing value of their mean_sepal_width. Remove the line containing as_factor to see the difference.</p>
</div>
<div id="lists" class="section level2">
<h2>Lists</h2>
<p>Given a list structure x, unlist simplifies it to produce a vector which contains all the atomic components which occur in x.</p>
<pre class="r"><code>l1 &lt;- list(a=&quot;a&quot;, b=&quot;2,&quot;, c=&quot;pi+2i&quot;)
str(l1)</code></pre>
<pre><code>## List of 3
##  $ a: chr &quot;a&quot;
##  $ b: chr &quot;2,&quot;
##  $ c: chr &quot;pi+2i&quot;</code></pre>
<pre class="r"><code>unlist(l1) # a character vector </code></pre>
<pre><code>##       a       b       c 
##     &quot;a&quot;    &quot;2,&quot; &quot;pi+2i&quot;</code></pre>
<pre class="r"><code>str(unlist(l1))</code></pre>
<pre><code>##  Named chr [1:3] &quot;a&quot; &quot;2,&quot; &quot;pi+2i&quot;
##  - attr(*, &quot;names&quot;)= chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<p>Extract the first element of a nested list <a href="https://stackoverflow.com/questions/20428742/select-first-element-of-nested-list">SO</a></p>
<pre class="r"><code>minyearmaxyear &lt;- list(c(2001, 2009), c(2010, 2014), c(2015, 2100))
library(purrr)
map(minyearmaxyear, 1)</code></pre>
<pre><code>## [[1]]
## [1] 2001
## 
## [[2]]
## [1] 2010
## 
## [[3]]
## [1] 2015</code></pre>
</div>
<div id="strings" class="section level2">
<h2>Strings</h2>
<pre class="r"><code>message(&quot;Using the following letters: &quot;, paste(letters, collapse=&quot;,&quot;), &quot;.&quot;)</code></pre>
<pre><code>## Using the following letters: a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z.</code></pre>
<div id="levenshtein-distance-between-words" class="section level3">
<h3>Levenshtein distance between words</h3>
<p>Cf. <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" class="uri">https://en.wikipedia.org/wiki/Levenshtein_distance</a></p>
<pre><code>adist(&quot;kitten&quot;, &quot;sitting&quot;)</code></pre>
</div>
</div>
<div id="s3-methods" class="section level2">
<h2>S3 methods</h2>
<p>List all available methods for a class:</p>
<pre><code>methods(class=&quot;lm&quot;) </code></pre>
</div>
</div>
<div id="debug" class="section level1">
<h1>Debug</h1>
<div id="debug-with-base-r" class="section level2">
<h2>Debug with base R</h2>
<p>Print the call stack of the last error:</p>
<pre><code>traceback()</code></pre>
</div>
<div id="debug-with-rlang" class="section level2">
<h2>Debug with rlang</h2>
<p>Print the call stack of the last error in simplified form:</p>
<pre><code>rlang::last_error()</code></pre>
<p>Print the full call stack of the last error:</p>
<pre><code>rlang::last_trace()</code></pre>
<p>More information on the behaviour of backtrace:</p>
<pre><code>help(trace_back, package=rlang)</code></pre>
<blockquote>
<p>“Because of lazy evaluation, the call stack in R is actually a tree, which the ‘summary()’ method of this object will reveal.”</p>
</blockquote>
</div>
</div>
<div id="environement" class="section level1">
<h1>Environement</h1>
<p>List objects in the global environment:</p>
<pre><code>ls</code></pre>
<p>List objects coming from a specific loaded package:</p>
<pre><code>ls(&quot;package:stats&quot;)
ls(&quot;package:stats&quot;, pattern=&quot;smooth&quot;)</code></pre>
<p>Remove all objects in the environement except one:</p>
<pre><code>rm(list=ls()[!ls()==&quot;object_to_keep&quot;]) 
rm(list=ls()[!ls()==&quot;con&quot;]) # Remove all except a database connection</code></pre>
<p>Get the current environment</p>
<pre><code>rlang::current_env()</code></pre>
</div>
<div id="editors" class="section level1">
<h1>Editors</h1>
<p>I use Vim and the great <a href="https://github.com/jalvesaq/Nvim-R">Nvim-R</a> plugin to edit R markdown documents and R scripts. I browse the table of content of R markdown files with the Voom plugin. I create R packages with Makefiles. I use the fugitive plugin to manage my git commits. See my <a href="Vim.html">Vim page</a> for more information.</p>
<p>Rstudio is a great editors for those who prefer a graphical user interface. It has a Vim mode. In fact I trained my muscle memory for Vim movement keys inside RStudio initially. Rstudio also has a lot of menus and buttons to work with Rmarkdown documents, view the state of a git repository and build packages.</p>
</div>
<div id="files-input-output" class="section level1">
<h1>Files input output</h1>
<pre><code>getwd()
list.files(tempdir()) 
dir.create(&quot;blabla&quot;)</code></pre>
<div id="csv-files" class="section level2">
<h2>CSV files</h2>
<p>Read one csv file with default R function.</p>
<pre><code>read.csv(&quot;data.csv&quot;, )</code></pre>
<p>Read many csv files with functions from the tidyverse packages.</p>
<p>First write sample csv files to a temporary directory. It’s more complicated than I thought it would be.</p>
<pre><code>data_folder &lt;- file.path(tempdir(), &quot;iris&quot;)
dir.create(data_folder)
iris %&gt;%
    # Keep the Species column in the output
    # Create a new column that will be used as the grouping variable
    mutate(species_group = Species) %&gt;% 
    group_by(species_group) %&gt;%
    nest() %&gt;%
    by_row(~write.csv(.$data, 
                      file = file.path(data_folder, paste0(.$species_group, &quot;.csv&quot;)),
                      row.names = FALSE))</code></pre>
<p>Read these csv files into one data frame. Note the Species column has to be present in the csv files, otherwise we would loose that information.</p>
<pre><code>iris_csv &lt;- list.files(data_folder, full.names = TRUE) %&gt;% 
    map_dfr(read_csv)</code></pre>
<p><code>write_csv</code> returned an <code>Error in write_delim(...) is.data.frame(x) is not TRUE</code> That’s why we used <code>write.csv</code> instead.</p>
</div>
<div id="rds-files" class="section level2">
<h2>RDS files</h2>
<p>RDS is a Serialization Interface for Single Objects. Objects are saved to binary data and compressed to the gzip format, see <code>help(saveRDS)</code> for more details.</p>
<p>Write a dataset to an rds file:</p>
<pre><code>saveRDS(iris, &quot;/tmp/iris.rds&quot;)</code></pre>
<p>Read a dataset from an rds file</p>
<pre><code>iris2 &lt;- readRDS(&quot;/tmp/iris.rds&quot;)
identical(iris, iris2)</code></pre>
</div>
</div>
<div id="find-and-replace" class="section level1">
<h1>Find and replace</h1>
<div id="longest-contiguous-stretch-of-non-nas" class="section level2">
<h2>Longest contiguous stretch of non-NAs:</h2>
<pre><code>na.contiguous(c(NA,1:3,NA,NA,3:5,NA,NA))
] 1 2 3
tr(,&quot;na.action&quot;)
]  1  5  6  7  8  9 10 11
tr(,&quot;class&quot;)
] &quot;omit&quot;
tr(,&quot;tsp&quot;)
] 2 4 1
na.contiguous(c(NA,1:3,NA,NA,3:6,NA,NA))
] 3 4 5 6
tr(,&quot;na.action&quot;)
]  1  2  3  4  5  6 11 12
tr(,&quot;class&quot;)
] &quot;omit&quot;
tr(,&quot;tsp&quot;)
]  7 10  1</code></pre>
</div>
<div id="replace-text-in-column-names" class="section level2">
<h2>Replace text in column names</h2>
<p>Add the first row to the column name, useful for some double headed csv files coming from pandas.</p>
<pre><code>paste(names(df), df[1,])</code></pre>
<p>Replace a regular expression with optional numerical pattern and final space</p>
<pre><code>names(df) &lt;- gsub(&quot;.per.hectare.[0-9]* *&quot;, &quot;_&quot;, names(df))</code></pre>
<p><a href="https://stackoverflow.com/questions/18237852/grep-in-r-using-or-and-not/18239222">And in a regular expression</a></p>
<pre><code>|</code></pre>
</div>
</div>
<div id="installing-r-and-packages" class="section level1">
<h1>Installing R and packages</h1>
<p>To install R and Rstudio on Debian, see the <a href="debian.html#r_and_rstudio" class="uri">debian.html#r_and_rstudio</a> page on this site.</p>
<p>To install packages simply enter the following at an R command prompt:</p>
<pre><code>install.packages(&quot;package_name&quot;)</code></pre>
<p>Some packages have dependencies that need to be installed at the OS level. Error messages:</p>
<pre><code>&quot;Configuration failed because libcurl was not found.&quot; 
&quot;Configuration failed because libxml-2.0 was not found.&quot;
&quot;Configuration failed because openssl was not found.&quot;</code></pre>
<p>Can be solved by installing these dependencies:</p>
<pre><code>sudo apt install libcurl4-openssl-dev 
sudo apt install libxml2-dev 
sudo apt install libssl-dev</code></pre>
</div>
<div id="information-about-your-r-system" class="section level1">
<h1>Information about your R system</h1>
<pre class="r"><code>sessionInfo()
installed.packages()</code></pre>
</div>
<div id="knitr" class="section level1">
<h1>knitr</h1>
<div id="create-websites" class="section level2">
<h2>Create websites</h2>
<div id="rmarkdown-site-generator" class="section level3">
<h3>Rmarkdown site generator</h3>
<p>This website is generated from R Markdown documents with:</p>
<pre><code> Rscript -e &quot;rmarkdown::render_site()&quot;</code></pre>
<p>The advantage of the rmarkdown site generator is that it creates pages with a floating, foldable table of content. It’s nice for pages that have a lot of subdivisions like this blog. The structure of a website is specified in a yaml file. For example, the code below creates a navigation bar:</p>
<pre><code>navbar:
  title: &quot;Paul Rougieux&quot;
  left:
    - text: &quot;Home&quot;
      icon: fa-home 
      href: index.html
    - text: &quot;Tools&quot;
      icon: fa-wrench
      menu:
        - text: &quot;Bash&quot;
          href: bash.html</code></pre>
</div>
<div id="bookdown-site-generator" class="section level3">
<h3>Bookdown site generator</h3>
<p>For blogs that fit into a book structure, with chapters, the bookdown package create a single clickable table of content for the whole site. It can also export the content to pdf format.</p>
<p>Specifying input from many sub directories in <code>_bookdown.yml</code>:</p>
<pre><code>rmd_files: [&quot;index.Rmd&quot;, &quot;chapters/chapt1.RMD&quot;, &quot;chapters/chapt2.RMD&quot;]</code></pre>
<p>Attention this will only work in the Merge and Knit strategy, as explained in the <a href="https://bookdown.org/yihui/bookdown/new-session.html">book chapter on two rendering approaches</a></p>
<blockquote>
<p>“We call these two approaches “Merge and Knit” (M-K) and “Knit and Merge” (K-M), respectively.&quot; “K-M does not allow Rmd files to be in subdirectories, but M-K does.”</p>
</blockquote>
</div>
</div>
<div id="cross-references" class="section level2">
<h2>Cross references</h2>
<p><a href="https://bookdown.org/yihui/rmarkdown-cookbook/cross-ref.html">R markdown cross ref</a></p>
<blockquote>
<p>“Cross-referencing is not provided directly within the base rmarkdown package, but is provided as an extension in bookdown (Xie 2020c). We must therefore use an output format from bookdown (e.g., html_document2, pdf_document2, and word_document2, etc.) in the YAML output field.”</p>
</blockquote>
<ul>
<li>Bookdown issue with flextable <a href="https://github.com/rstudio/bookdown/issues/746">Table and figure cross references in word</a> Now solved with the following implementation</li>
</ul>
<pre class="r"><code>iris %&gt;% head() %&gt;% flextable()</code></pre>
<p>This is a reference to flextable @ref(tab:irishead). The chunk name should not contain an underscore, otherwise the cross reference will not work. See <a href="https://github.com/rstudio/bookdown/issues/941">bookdown issue 941</a>.</p>
<p>See more flextable caption examples in <code>system.file(package = &quot;flextable&quot;, &quot;examples&quot;, &quot;rmd&quot;, &quot;captions&quot;)</code></p>
</div>
<div id="flextable-and-officer-package" class="section level2">
<h2>Flextable and officer package</h2>
<p>The officer package makes it possible to create improved word and powerpoint documents. The flextable package has a few functions to generate tables for word documents (otherwise they look funny).</p>
<p>Before installing flextable, the following system dependencies were required:</p>
<pre><code>sudo apt install libcairo2-dev libjpeg-dev libgif-dev</code></pre>
<p>Installation in R:</p>
<pre><code>install.packages(&quot;flextable&quot;)</code></pre>
<p>This is to work with colleagues who are not in the latex/pdf world.</p>
<div id="landscape-pages" class="section level3">
<h3>Landscape pages</h3>
<pre class="r"><code>library(officer)
library(flextable)
ft_iris &lt;- iris %&gt;%
    head() %&gt;%
    flextable() %&gt;%
    autofit()
# Add a flex table in landscape format 
# Supply document name here, otherwise start an empty doc
doc &lt;- read_docx() %&gt;% 
  # Portait and landscape sections are defined by their ending
  # A portrait section is ending here
  body_end_section_portrait() %&gt;%
  body_add_flextable(value = ft_iris, split = TRUE) %&gt;%
  # A landscape section is ending here
  body_end_section_landscape() %&gt;% 
  print(target = &quot;/tmp/iris.docx&quot;)</code></pre>
</div>
</div>
<div id="kable-to-create-tables" class="section level2">
<h2>kable to create tables</h2>
<pre class="r"><code>cat(kable(head(iris, 1), format = &quot;html&quot;))</code></pre>
<pre><code>## &lt;table&gt;
##  &lt;thead&gt;
##   &lt;tr&gt;
##    &lt;th style=&quot;text-align:right;&quot;&gt; Sepal.Length &lt;/th&gt;
##    &lt;th style=&quot;text-align:right;&quot;&gt; Sepal.Width &lt;/th&gt;
##    &lt;th style=&quot;text-align:right;&quot;&gt; Petal.Length &lt;/th&gt;
##    &lt;th style=&quot;text-align:right;&quot;&gt; Petal.Width &lt;/th&gt;
##    &lt;th style=&quot;text-align:left;&quot;&gt; Species &lt;/th&gt;
##   &lt;/tr&gt;
##  &lt;/thead&gt;
## &lt;tbody&gt;
##   &lt;tr&gt;
##    &lt;td style=&quot;text-align:right;&quot;&gt; 5.1 &lt;/td&gt;
##    &lt;td style=&quot;text-align:right;&quot;&gt; 3.5 &lt;/td&gt;
##    &lt;td style=&quot;text-align:right;&quot;&gt; 1.4 &lt;/td&gt;
##    &lt;td style=&quot;text-align:right;&quot;&gt; 0.2 &lt;/td&gt;
##    &lt;td style=&quot;text-align:left;&quot;&gt; setosa &lt;/td&gt;
##   &lt;/tr&gt;
## &lt;/tbody&gt;
## &lt;/table&gt;</code></pre>
<pre class="r"><code>cat(kable(head(iris, 1), format = &quot;latex&quot;))</code></pre>
<pre><code>## 
## \begin{tabular}{r|r|r|r|l}
## \hline
## Sepal.Length &amp; Sepal.Width &amp; Petal.Length &amp; Petal.Width &amp; Species\\
## \hline
## 5.1 &amp; 3.5 &amp; 1.4 &amp; 0.2 &amp; setosa\\
## \hline
## \end{tabular}</code></pre>
<pre class="r"><code>cat(kable(head(iris, 1), format = &quot;markdown&quot;))</code></pre>
<pre><code>## | Sepal.Length| Sepal.Width| Petal.Length| Petal.Width|Species | |------------:|-----------:|------------:|-----------:|:-------| |          5.1|         3.5|          1.4|         0.2|setosa  |</code></pre>
<div id="booktabs" class="section level3">
<h3>Booktabs</h3>
<p>Booktabs tables look nicer in latex document, they can be created by specifying the argument <code>booktabs = TRUE</code> into the <code>kable()</code> call.</p>
<p>Knitr adds an extra space every five lines into booktabs tables for readability. This is undesirable for short tables. To remove this space specify the <code>linesep = &quot;&quot;</code> argument to <code>kable()</code> as explained in this <a href="https://stackoverflow.com/questions/49015578/space-after-every-five-rows-in-kable-output-with-booktabs-option-in-r-markdown">SO answer</a>.</p>
</div>
</div>
<div id="python-engine" class="section level2">
<h2>Python engine</h2>
<p>Rstudio: <a href="https://rstudio.github.io/reticulate/articles/r_markdown.html">R Mardown python engine</a></p>
</div>
<div id="set-knitr-options" class="section level2">
<h2>Set knitr options</h2>
<p>Those 2 commands are different. Sets the options for chunk, within a knitr chunk inside the .Rmd document</p>
<pre><code>opts_chunk$set(fig.width=10)</code></pre>
<p>Sets the options for knitr outside the .Rmd document</p>
<pre><code>opts_knit$set()</code></pre>
</div>
</div>
<div id="manipulate-vectors" class="section level1">
<h1>Manipulate vectors</h1>
<div id="cut-and-split" class="section level2">
<h2>Cut and split</h2>
<p>Cut a vector in smaller components</p>
<pre><code>cut(0:16, 4)</code></pre>
</div>
<div id="combine-vectors" class="section level2">
<h2>Combine vectors</h2>
<p>Combine vectors with c()</p>
<pre><code>x &lt;- c(1, 2, 3)
y &lt;- c(4, 5)
c(x, y)</code></pre>
<p>Unite multiple columns into one by pasting strings together</p>
<pre><code>df &lt;- expand_grid(x = c(&quot;a&quot;, NA), y = c(&quot;b&quot;, NA))
df

df %&gt;% unite(&quot;z&quot;, x:y, remove = FALSE)
# To remove missing values:
df %&gt;% unite(&quot;z&quot;, x:y, na.rm = TRUE, remove = FALSE)

# Separate is almost the complement of unite
df %&gt;%
  unite(&quot;xy&quot;, x:y) %&gt;%
  separate(xy, c(&quot;x&quot;, &quot;y&quot;))
# (but note `x` and `y` contain now &quot;NA&quot; not NA)</code></pre>
</div>
</div>
<div id="packages" class="section level1">
<h1>Packages</h1>
<p>You might want to read the CRAN manual on <a href="https://cran.r-project.org/doc/manuals/R-exts.html">Writing R Extensions</a>, and its section on <a href="https://cran.r-project.org/doc/manuals/R-exts.html#Package-Dependencies">Package dependencies</a>. See also Hadley’s book on R package and its section on <a href="http://r-pkgs.had.co.nz/namespace.html">Namespace</a></p>
<p>Use the devtools library to start a package folder structure:</p>
<pre><code>devtools::create(&quot;package_name&quot;)</code></pre>
<p>Use git to track code modifications (shell commands):</p>
<pre><code>$ cd package_name
$ git init</code></pre>
<div id="documentation" class="section level2">
<h2>Documentation</h2>
<p>The roxygen2 package helps with function documentation. Documentation can be written in the form of comments #’ tags such as <code>@param</code> and <code>@description</code> structure the documentation of each function.</p>
<p>For an introcution to roxygen2, call <code>vignette(&quot;roxygen2&quot;, package = &quot;roxygen2&quot;)</code> at the R prompt.</p>
<p>Since roxygen2 version 6, markdown formating can be used in the documentation, by specifying the <code>@md</code> tag.</p>
<div id="examples" class="section level3">
<h3>Examples</h3>
<p>Examples are crucial to demonstrate the use of a fonction. They can be specified in a roxygen block called <code>@examples</code>:</p>
<pre><code>#&#39; @examples</code></pre>
<p>Wrap the examples in donttest if you don’t want R CMD check to test them at package building time.</p>
<pre><code>#&#39; \donttest{d</code></pre>
<p>It is also possible to wrap them in another statement called <code>dontrun</code>, but this is not recomended on CRAN according to this <a href="https://stackoverflow.com/a/44997778/2641825">Stackoverflow question</a>.</p>
</div>
<div id="vignettes" class="section level3">
<h3>Vignettes</h3>
<p><a href="http://r-pkgs.had.co.nz/vignettes.html">Vignettes: long-form documentation</a></p>
<pre><code>devtools::use_vignette(&quot;my-vignette&quot;)</code></pre>
<p><a href="https://stackoverflow.com/questions/12325223/where-to-put-package-vignettes-for-cran-submission">Where to put package vignettes for CRAN submission</a></p>
<blockquote>
<p>“You put the .Rnw sources in vignettes/ as you did, but you missed out a critical step; don’t check the source tree. The expected workflow is to build the source tarball and then check that tarball. Building the tarball will create the vignette PDF.”</p>
</blockquote>
<pre><code>R CMD build ../foo/pkg
R CMD check ./pkg-0.4.tar.gz</code></pre>
<p>Issues while building vignette for a packages:</p>
<ul>
<li><p>sh: 1: /usr/bin/texi2dvi: not found</p>
<p>sudo apt-get install texinfo</p></li>
<li><p><a href="https://github.com/clonghurst/Res.plotter/issues/3">Warning about “vignette without corresponding PDF/HTML”?</a></p></li>
</ul>
<blockquote>
<p>“Maybe you’re running R CMD check using the directory name rather than the .tar.gz file?”</p>
</blockquote>
<ul>
<li><a href="https://stackoverflow.com/questions/34524357/inconsolata-missing-to-build-r-vignette">Inconsolata missing to build R vignette</a></li>
</ul>
<blockquote>
<p>“Installing texlive-fonts-extra should take care of it.”</p>
</blockquote>
<p>R CMD checking data for non-ASCII characters found 179 marked UTF-8 strings No solution for this one but I guess it’s ok since it concerns country names?</p>
</div>
</div>
<div id="unit-tests" class="section level2">
<h2>Unit tests</h2>
<p>Back in R, add testing infrastructure:</p>
<pre><code>devtools::use_testthat()</code></pre>
<p>When checking the package with R CMD CHECK, <a href="https://stackoverflow.com/questions/9439256/how-can-i-handle-r-cmd-check-no-visible-binding-for-global-variable-notes-when">How can I handle R CMD check “no visible binding for global variable”?</a> These notes are caused by variables used with dplyr verbs and ggplot2 aesthetics.</p>
</div>
<div id="continuous-integration" class="section level2">
<h2>Continuous Integration</h2>
<p>It is good to know if your package can be installed on a fresh system. Continuous integration systems make this possible each time you submit a modification to your repository. I have used travis-ci which is free for open github repositories. <a href="https://docs.travis-ci.com/user/languages/r/">Instructions to build an R project on travis</a>. Unit tests are also run on travis, in addition to R CMD CHECK.</p>
<p>Package dependencies can be configured in a <code>.travis.yml</code> file that is read by the travis machine performing the build. For package that are not on Cran, it’s possible to specify a dependency field under <code>r_github_packages</code>.</p>
</div>
<div id="make-file" class="section level2">
<h2>Make file</h2>
<ul>
<li>kbroman <a href="https://kbroman.org/minimal_make/">minimal make</a></li>
<li>Cran <a href="https://stackoverflow.com/questions/46741739/how-to-use-makefiles-with-r-cmd-build">how to use make files with R CMD build</a></li>
</ul>
<p>I copied the make file from the knitr package.</p>
</div>
<div id="submitting-to-cran" class="section level2">
<h2>Submitting to CRAN</h2>
<p><a href="https://cran.r-project.org/submit.html">Submit package to CRAN</a> The second page will ask to</p>
<ul>
<li>Step 1 (Upload) the <code>*.tar.gz</code> file.</li>
<li>Step 2 (Submission) review information from the package’s DESCRIPTION file.</li>
<li>Step 3 (Confirmation)</li>
</ul>
<p>The maintainer of this package has been sent an email to confirm the submission. After their confirmation the package will be passed to CRAN for review.</p>
<p>In general enter the Git tag after the submission has been completed, because it is very likely that additional information will need to be added to the package before or during the submission process.</p>
</div>
</div>
<div id="plots" class="section level1">
<h1>Plots</h1>
<div id="plotting-with-ggplot2" class="section level2">
<h2>Plotting with ggplot2</h2>
<pre><code>geom_bar
geom_tile + a gradient produce heat maps</code></pre>
<div id="axes" class="section level3">
<h3>Axes</h3>
<p>Rotate the tick text of the X axis. SO question <a href="https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2">rotating axis labels in ggplot2</a></p>
<pre><code>theme(axis.text.x=element_text(angle = 90, hjust=0))</code></pre>
<p>Increase number of axis ticks by specifying an integer break vector</p>
<pre><code>scale_x_continuous(breaks = 1:10)</code></pre>
<p>When dates are on the x axis, use a time scale and specify the breaks as a time vector</p>
<pre><code>scale_x_date(breaks = lubridate::parse_date_time(2000:2020, &quot;%y&quot;))</code></pre>
<p>Alternatively breaks can be specified as an interval, and minor breaks as well</p>
<pre><code>scale_x_datetime(date_breaks = &quot;5 years&quot;, labels = scales::date_format(&quot;%Y&quot;), date_minor_breaks = &quot;1 year&quot;)</code></pre>
</div>
<div id="legend" class="section level3">
<h3>Legend</h3>
<p>Place the legend at the bottom of the plot:</p>
<pre><code>library(ggplot2)
ggplot(iris, aes(Petal.Width, Sepal.Width, color=Species)) + 
    geom_point() + 
    theme(legend.position=&quot;bottom&quot;)</code></pre>
<p>Change the name of a particular sub element in the legend:</p>
<pre><code>labs(color=&quot;Iris Species&quot;)
labs(linetype=&quot;Sawnwood product group&quot;)</code></pre>
<p>Make a multi column legend</p>
<pre><code>library(scales)

plot + # With a fill aeasthetic
    guides(fill=guide_legend(ncol = 2))

plot + # with a color aesthetic 
     guides(col = guide_legend(ncol = 1))</code></pre>
<p>See ggplot2 reference <a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide legend</a>.</p>
</div>
<div id="math-formulas-in-facet-labels" class="section level3">
<h3>Math formulas in facet labels</h3>
<pre class="r"><code>library(dplyr)
library(ggplot2)

# Create a first facet variable with examples of math formulas
iris2 &lt;- iris %&gt;%
    mutate(species_math = factor(Species,
                            levels = c(&quot;setosa&quot;, &quot;versicolor&quot;, &quot;virginica&quot;),
                            labels = c(&quot;m^2&quot;,
                                       expression(bar(x) == sum(frac(x[i], n), i==1, n) * beta * Q[t-1]),
                                       bquote(pi == .(pi)))))

# Create a second facet variable with mean lengths
# This illustrates how to pass a numeric vector inside a formula
iris_mean &lt;- iris2 %&gt;%
    group_by(Species) %&gt;%
    summarise(across(ends_with(&quot;Length&quot;), mean), .groups=&quot;drop&quot;)

iris2$mean_length &lt;- factor(iris2$Species,
                           levels =  c(&quot;setosa&quot;, &quot;versicolor&quot;, &quot;virginica&quot;),
                           labels = mapply(function(p, s) bquote(bar(p) == .(p) ~ bar(s) ==.(s)),
                                            round(iris_mean$Petal.Length,3), round(iris_mean$Sepal.Length,3)))

# Create the faceted plot
iris2 %&gt;%
    ggplot(aes(x = Petal.Length, y = Petal.Width)) +
    geom_point() +
    facet_wrap(species_math ~ mean_length + Species,
               labeller = labeller(species_math = label_parsed, mean_length = label_parsed))</code></pre>
<p><img src="R_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>As shown in the example above, the labeller can parse:</p>
<ol style="list-style-type: decimal">
<li><p>A character vector such as “m^2” for simple formulas</p></li>
<li><p>An <code>expression</code> for more complex math with indices</p></li>
<li><p>The output of <code>bquote</code> to include numerical values in the formula. See also <a href="https://stackoverflow.com/a/58048944/2641825">this answer</a> on how to use <code>bquote</code> with numerical vectors of more than one value.</p></li>
<li><p>see <a href="https://stackoverflow.com/a/51863090/2641825">this other answer</a> on how to apply the labeller to one of the faceting variables only. In our case we apply it to the <code>species_math</code> variable only.</p></li>
</ol>
<p>The syntax is different from Latex math formulas because <code>label_parsed</code> interprets labels as <code>plotmath</code> expressions. For example indices are written <code>x_i</code> in Latex and <code>x[i]</code> in plot math expressions, and Greek letters are written directly as <code>alpha</code> instead of <code>\alpha</code> in Latex. You can find many formulas in the help page of the <a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html">plotmath</a> function. Good luck with the <code>plotmath</code> examples.</p>
</div>
<div id="save-plots-to-pdf" class="section level3">
<h3>Save plots to pdf</h3>
<p>Use <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a>:</p>
<pre><code>ggplot(mtcars, aes(mpg, wt)) + geom_point()
ggsave(&quot;mtcars.pdf&quot;)</code></pre>
</div>
<div id="themes" class="section level3">
<h3>Themes</h3>
<p>Minimal theme</p>
<pre><code>theme_minimal()</code></pre>
</div>
</div>
<div id="choropleth-maps" class="section level2">
<h2>Choropleth maps</h2>
<p><a href="https://www.r-graph-gallery.com/choropleth-map.html">Choropleth map</a></p>
<p>Shape files to make choropleth maps of Europe: <a href="https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/nuts">GISCO: Geographical Information and maps</a></p>
</div>
<div id="palettes" class="section level2">
<h2>Palettes</h2>
<p><a href="https://data.library.virginia.edu/setting-up-color-palettes-in-r/">Setting up colour palettes in R</a></p>
<blockquote>
<p>To create a RColorBrewer palette, use the brewer.pal function. It takes two arguments: n, the number of colors in the palette; and name, the name of the palette. Let’s make a palette of 8 colors from the qualitative palette, “Set2”.</p>
</blockquote>
<pre><code>library(RColorBrewer)
brewer.pal(n = 8, name = &quot;Set2&quot;) 
[1] &quot;#66C2A5&quot; &quot;#FC8D62&quot; &quot;#8DA0CB&quot; &quot;#E78AC3&quot;
&quot;#A6D854&quot; &quot;#FFD92F&quot; &quot;#E5C494&quot; &quot;#B3B3B3&quot; 
palette(brewer.pal(n = 8, name = &quot;Set2&quot;))</code></pre>
<p>Use this palette in ggplot2</p>
<pre><code>ggplot(iris, aes(x=Sepal.Length, y=Petal.Length, color=Species)) + 
    geom_point() +
    scale_color_brewer(palette = &quot;Set2&quot;)</code></pre>
<div id="manual-colours" class="section level3">
<h3>Manual colours</h3>
<p>Use a named vector to set a palette in ggplot2 as explained in <a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">ggplot2 scale_manual</a></p>
<pre><code>p &lt;- ggplot(iris, aes(x=Sepal.Length, y=Petal.Length, color=Species)) +
        geom_point() 
p + scale_colour_manual(values = c(setosa=&#39;black&#39;, versicolor=&#39;red&#39;, virginica=&#39;green&#39;))</code></pre>
<p>Create a named palette using R colour brewer:</p>
<pre><code>species_names &lt;- c(&quot;setosa&quot;, &quot;versicolor&quot;, &quot;virginica&quot;) 
iris_palette &lt;- setNames(brewer.pal(n=length(species_names), name=&#39;Set2&#39;), 
                         species_names)
p + scale_colour_manual(values = iris_palette)</code></pre>
</div>
<div id="display-palettes" class="section level3">
<h3>Display palettes</h3>
<p>Display qualitative palettes:</p>
<pre><code>display.brewer.all(type=&quot;qual&quot;) </code></pre>
<p>Display all palettes</p>
<pre><code>display.brewer.all()</code></pre>
</div>
</div>
<div id="text-labels" class="section level2">
<h2>Text labels</h2>
<p>ggplot2 <a href="https://ggplot2.tidyverse.org/reference/geom_text.html">text</a></p>
<p>Use position jitter</p>
<pre class="r"><code>#  Reduce the number of points so it becomes more readable
iris2 &lt;- iris %&gt;% 
    group_by(Species, Petal.Width) %&gt;%
    summarise(Sepal.Width = mean(Sepal.Width))
ggplot(iris2, aes(x = Petal.Width, y=Sepal.Width, color = Species)) +
    geom_text(aes(label = Species), position=position_jitter(width=0.5,height=0.3))</code></pre>
<p>Use repulsive textual annotations</p>
<pre class="r"><code>ggplot(iris2, aes(x = Petal.Width, y=Sepal.Width, color = Species)) +
    ggrepel::geom_text_repel(aes(label = Species))</code></pre>
<p>Change the text size</p>
<pre class="r"><code>ggplot(iris2, aes(x = Petal.Width, y=Sepal.Width, color = Species)) +
    ggrepel::geom_text_repel(aes(label = Species), size=8)</code></pre>
<p><a href="https://ggrepel.slowkow.com/articles/examples.html">More ggrepel examples</a></p>
<p>Justification</p>
<pre class="r"><code>df &lt;- data.frame(
  x = c(1, 1, 2, 2, 1.5),
  y = c(1, 2, 1, 2, 1.5),
  text = c(&quot;bottom-left&quot;, &quot;bottom-right&quot;, &quot;top-left&quot;, &quot;top-right&quot;, &quot;center&quot;)
)
ggplot(df, aes(x, y)) +
  geom_text(aes(label = text))
ggplot(df, aes(x, y)) +
  geom_text(aes(label = text), vjust = &quot;inward&quot;, hjust = &quot;inward&quot;)</code></pre>
</div>
</div>
<div id="python-compared-to-r" class="section level1">
<h1>Python compared to R</h1>
<p>See also the <a href="python.html">python</a> page for a comparison between pandas methods and R data frames functions.</p>
<pre><code>l = c(1,2,3)
s = l
s[3]
[1] 3
s[3] = &quot;a&quot;
s
[1] &quot;1&quot; &quot;2&quot; &quot;a&quot;
l
[1] 1 2 3</code></pre>
<p>Using the address function to see the address of these objects in memory We can see that s and l share the same address. The address only changes when we asign something to s.</p>
<pre><code>library(pryr)
l = c(1,2,3)
s = l
address(l)
[1] &quot;0x316f718&quot;
address(s)
[1] &quot;0x316f718&quot;
s[3] = &quot;a&quot;
address(s)
[1] &quot;0x36a7d30&quot;
s
[1] &quot;1&quot; &quot;2&quot; &quot;a&quot;
l
[1] 1 2 3</code></pre>
<p>Checking string objects</p>
<pre><code>bla = &quot;qsdfmlkj&quot;
address(bla)
[1] &quot;0x38e5120&quot;
bli = bla
address(bli)
[1] &quot;0x38e5120&quot;
bli = paste(bli, &quot;sdf&quot;)
address(bli)
[1] &quot;0x38d1d60&quot;</code></pre>
<p>TODO Compare to the same code in python to see the difference between the above and passing by reference.</p>
</div>
<div id="reproducibility-and-cloud-computing" class="section level1">
<h1>Reproducibility and cloud computing</h1>
<div id="cloudyr-project" class="section level2">
<h2>Cloudyr project</h2>
<p>The <a href="https://cloudyr.github.io/packages/index.html">cloudyr project</a> is a collection of R packages to enable cloud computing.</p>
<p>R packages that are actively maintained can be seen on the <a href="https://github.com/cloudyr">github project page of cloudyr</a>.</p>
<ul>
<li><p>For example the <a href="https://github.com/cloudyr/googleCloudVisionR">googleCloudVisionR</a> package gets the following image annotations for a picture of golden retriever puppies</p>
<pre><code>    description     score topicality
            Dog 0.9953705  0.9953705
         Mammal 0.9890478  0.9890478
     Vertebrate 0.9851104  0.9851104
        Canidae 0.9813780  0.9813780
      Dog breed 0.9683250  0.9683250
          Puppy 0.9400384  0.9400384</code></pre>
<p>Golden retriever 0.8966703 0.8966703</p></li>
</ul>
</div>
<div id="rocker" class="section level2">
<h2>Rocker</h2>
<p><a href="https://github.com/rocker-org/rocker">rocker-org/rocker</a> provides a series of docker images for various R development purposes.</p>
<p>Bioconductor <a href="https://www.bioconductor.org/help/docker/#intro">docker intro</a></p>
<blockquote>
<p>“With Bioconductor containers, we hope to enhance Reproducibility: If you run some code in a container today, you can run it again in the same container (with the same tag) years later and know that nothing in the container has changed. You should always take note of the tag you used if you think you might want to reproduce some work later.”</p>
</blockquote>
</div>
</div>
<div id="rscript" class="section level1">
<h1>Rscript</h1>
<p>Capture arguments in an Rscript on windows and write them to a file</p>
<pre><code>&quot;C:\Program Files\R\R-3.5.0\bin\Rscript.exe&quot; --verbose -e &quot;args = commandArgs(trailingOnly=TRUE)&quot; -e &quot;writeLines(args,&#39;C:\\Dev\\args.txt&#39;)&quot; &quot;file1.csv&quot; &quot;file2.csv&quot; &quot;file3.csv&quot;</code></pre>
<p>Arguments can be extracted one by one with args[1] commandArgs() returns a <strong>character vector</strong> containing the name of the executable and the user-supplied command line arguments.</p>
</div>
<div id="shiny" class="section level1">
<h1>Shiny</h1>
<p><a href="https://shiny.rstudio.com/gallery/kmeans-example.html">K means example</a></p>
<div id="app.r" class="section level2">
<h2>App.R</h2>
<p><a href="https://shiny.rstudio.com/tutorial/written-tutorial/lesson1/">Shiny tutorial lesson 1</a></p>
<blockquote>
<p>“Note: Prior to version 0.10.2, Shiny did not support single-file apps and the ui object and server function needed to be contained in separate scripts called ui.R and server.R, respectively. This functionality is still supported in Shiny, however the tutorial and much of the supporting documentation focus on single-file apps.”</p>
</blockquote>
</div>
</div>
<div id="tidyverse" class="section level1">
<h1>Tidyverse</h1>
<div id="dplyr" class="section level2">
<h2>dplyr</h2>
<div id="group_by-and-summarise" class="section level3">
<h3>Group_by and summarise</h3>
<pre class="r"><code>library(dplyr)
cars %&gt;%
    group_by(speed) %&gt;%
    print(n=2) %&gt;% # works because the print function returns its argument
    summarise(numberofcars = n(),
              min = min(dist),
              mean = mean(dist),
              max = max(dist)) </code></pre>
<pre><code>## # A tibble: 50 x 2
## # Groups:   speed [19]
##   speed  dist
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     4     2
## 2     4    10
## # … with 48 more rows</code></pre>
<pre><code>## # A tibble: 19 x 5
##    speed numberofcars   min  mean   max
##    &lt;dbl&gt;        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     4            2     2   6      10
##  2     7            2     4  13      22
##  3     8            1    16  16      16
##  4     9            1    10  10      10
##  5    10            3    18  26      34
##  6    11            2    17  22.5    28
##  7    12            4    14  21.5    28
##  8    13            4    26  35      46
##  9    14            4    26  50.5    80
## 10    15            3    20  33.3    54
## 11    16            2    32  36      40
## 12    17            3    32  40.7    50
## 13    18            4    42  64.5    84
## 14    19            3    36  50      68
## 15    20            5    32  50.4    64
## 16    22            1    66  66      66
## 17    23            1    54  54      54
## 18    24            4    70  93.8   120
## 19    25            1    85  85      85</code></pre>
<p>group_by() creates a tbl_df objects which is a wrapper around a data.frame to enable some functionalities. Note that print returns its output on a tbl_df object. So print() can be used inside the pipe without stopping the workflow.</p>
</div>
<div id="across" class="section level3">
<h3>Across</h3>
<p>Apply the same transformation to multiple columns, allowing to use select semantics inside summarise and mutate.</p>
<pre class="r"><code>cars %&gt;%
    group_by(speed) %&gt;%
    summarise(across(dist, list(n = length , min = min, mean = mean, max = max)))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 19 x 5
##    speed dist_n dist_min dist_mean dist_max
##    &lt;dbl&gt;  &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     4      2        2       6         10
##  2     7      2        4      13         22
##  3     8      1       16      16         16
##  4     9      1       10      10         10
##  5    10      3       18      26         34
##  6    11      2       17      22.5       28
##  7    12      4       14      21.5       28
##  8    13      4       26      35         46
##  9    14      4       26      50.5       80
## 10    15      3       20      33.3       54
## 11    16      2       32      36         40
## 12    17      3       32      40.7       50
## 13    18      4       42      64.5       84
## 14    19      3       36      50         68
## 15    20      5       32      50.4       64
## 16    22      1       66      66         66
## 17    23      1       54      54         54
## 18    24      4       70      93.8      120
## 19    25      1       85      85         85</code></pre>
<p>Other examples from the help of the across function</p>
<pre class="r"><code># A purrr-style formula
iris %&gt;%
    group_by(Species) %&gt;%
    summarise(across(starts_with(&quot;Sepal&quot;), ~mean(.x, na.rm = TRUE)))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   Species    Sepal.Length Sepal.Width
##   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;
## 1 setosa             5.01        3.43
## 2 versicolor         5.94        2.77
## 3 virginica          6.59        2.97</code></pre>
<pre class="r"><code># A named list of functions
iris %&gt;%
    group_by(Species) %&gt;%
    summarise(across(starts_with(&quot;Sepal&quot;), list(mean = mean, sd = sd)))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   Species    Sepal.Length_mean Sepal.Length_sd Sepal.Width_mean Sepal.Width_sd
##   &lt;fct&gt;                  &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1 setosa                  5.01           0.352             3.43          0.379
## 2 versicolor              5.94           0.516             2.77          0.314
## 3 virginica               6.59           0.636             2.97          0.322</code></pre>
<p>More information in the vignette</p>
<pre><code>vignette(&quot;colwise&quot;, package=&quot;dplyr&quot;)</code></pre>
<p>The vignette mentions this about <code>rename</code>:</p>
<blockquote>
<p>“across() doesn’t work with select() or rename() because they already use tidy select syntax; if you want to transform column names with a function, you can use rename_with().”</p>
</blockquote>
</div>
<div id="mutate-to-create-a-new-vector" class="section level3">
<h3>Mutate to create a new vector</h3>
<p>Mutate multiple variables in the dataframe at once using the <code>vars()</code> helper function to scope the mutation: Note <code>mutate_at</code> has been superseded by the across function.</p>
<pre class="r"><code>iris %&gt;%
    mutate_at(vars(starts_with(&quot;Petal&quot;)), round) %&gt;%
    head()</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5            1           0  setosa
## 2          4.9         3.0            1           0  setosa
## 3          4.7         3.2            1           0  setosa
## 4          4.6         3.1            2           0  setosa
## 5          5.0         3.6            1           0  setosa
## 6          5.4         3.9            2           0  setosa</code></pre>
</div>
<div id="rename-columns" class="section level3">
<h3>Rename columns</h3>
<p><code>rename_with</code> from the <code>dplyr</code> package can use either a function or a formula to rename a selection of columns given as the <code>.cols</code> argument. For example passing the function name <code>toupper</code>:</p>
<pre><code>library(dplyr)
rename_with(head(iris), toupper, starts_with(&quot;Petal&quot;))</code></pre>
<p>Is equivalent to passing the formula <code>~ toupper(.x)</code>:</p>
<pre><code>rename_with(head(iris), ~ toupper(.x), starts_with(&quot;Petal&quot;))</code></pre>
<p>To rename all columns, you can also use <code>set_names</code> from the rlang package. We now use <code>paste0</code> as a renaming function. <code>pasteO</code> takes 2 arguments, as a result there are different ways to pass the second argument depending on whether we use a function or a formula.</p>
<pre><code>rlang::set_names(head(iris), paste0, &quot;_hi&quot;)
rlang::set_names(head(iris), ~ paste0(.x, &quot;_hi&quot;))</code></pre>
<p>The same can be achieved with <code>rename_with</code> by passing the data frame as first argument <code>.data</code>, the function as second argument <code>.fn</code>, all columns as third argument <code>.cols=everything()</code> and the function parameters as the fourth argument <code>...</code>. Alternatively you can place the second, third and fourth arguments in a formula given as the second argument.</p>
<pre><code>rename_with(head(iris), paste0, everything(), &quot;_hi&quot;)
rename_with(head(iris), ~ paste0(.x, &quot;_hi&quot;))</code></pre>
<p><code>rename_with</code> only works with data frames. <code>set_names</code> is more generic and can also perform vector renaming</p>
<pre><code>rlang::set_names(1:4, c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;))</code></pre>
</div>
<div id="recode-values-in-a-vector" class="section level3">
<h3>Recode values in a vector</h3>
<blockquote>
<p>“Replace numeric values based on their position or their name, and character or factor values only by their name.”</p>
</blockquote>
<pre><code>char_vec &lt;- sample(c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;), 10, replace = TRUE)
recode(char_vec, a = &quot;Apple&quot;)</code></pre>
</div>
</div>
<div id="pipes" class="section level2">
<h2>Pipes</h2>
</div>
<div id="purrr" class="section level2">
<h2>purrr</h2>
<p>Hadley Wickham’s answer to a SO question <a href="https://stackoverflow.com/a/47123420/2641825">Why use purrr::map instead of lapply?</a></p>
<div id="map-a-function-to-nested-data-sets" class="section level3">
<h3>Map a function to nested data sets</h3>
<p>Load data</p>
<pre class="r"><code>list.files(getwd())
forestEU_wide &lt;- read.csv(&quot;Forest-R-EU.csv&quot;, stringsAsFactors = FALSE)
head(forestEU)</code></pre>
<p>Pivot to long format</p>
<pre class="r"><code># at some pointin the future this will be called pivot_long
forestEU &lt;- forestEU_wide  %&gt;% 
      # select everything except the Year, then pivot all columns and put the value in area
      gather(-Year, key = &quot;Country&quot;, value = &quot;Area&quot;)</code></pre>
</div>
</div>
<div id="tricks" class="section level2">
<h2>Tricks</h2>
<p>David Robinson <a href="https://www.youtube.com/watch?v=NDHSBUN_rVU">Ten tricks in the tidyverse</a></p>
<ol style="list-style-type: decimal">
<li>count with weight, sort and renamining count(x, …, wt = NULL, sort = FALSE, name = “n”)</li>
<li>creating variables in count()</li>
<li>add_count()</li>
<li>summarize with a list column (to create many models for example)</li>
<li>fct_reorder() + geom_col() + coord_flip()</li>
<li>fct_lump() to lump less frequent values together</li>
<li>use a log scale scale_x/y_log10</li>
<li>crossing()</li>
<li>separate()</li>
<li>extract() use a regular expression such as <code>S(.*)E(.*)</code> to extract series and episode from a string of the form “S32E44”.</li>
</ol>
</div>
<div id="purrr-1" class="section level2">
<h2>Purrr</h2>
<div id="interpolation" class="section level3">
<h3>Interpolation</h3>
<p>Interpolate for one country</p>
<pre class="r"><code>country_interpolation &lt;- function(df) {
    df &lt;- data.frame(approx(df$Year, df$Area, method = &quot;linear&quot;, n=71))
    df &lt;- rename(df, Year = x, Area = y)
    return(df)
}
forestEU %&gt;%
    filter(Country==&quot;Austria&quot;) %&gt;%
    country_interpolation()</code></pre>
<p>Interpolate for all countries Perform the Interpolation on all countries</p>
<p>See documentation in * many models <a href="https://r4ds.had.co.nz/many-models.html" class="uri">https://r4ds.had.co.nz/many-models.html</a> * blog <a href="https://emoriebeck.github.io/R-tutorials/purrr/" class="uri">https://emoriebeck.github.io/R-tutorials/purrr/</a></p>
<pre class="r"><code>forestEU_nested &lt;- forestEU %&gt;%
      # Remove empty area
      filter(!is.na(Area)) %&gt;% 
      group_by(Country) %&gt;%  
      nest() %&gt;% 
      mutate(interpolated = map(data, country_interpolation))

# forestEU_nested %&gt;% unnest(data)
# Unnest the interpolated data to look at it and plotting
forestEU_interpolated &lt;- forestEU_nested %&gt;% unnest(interpolated)</code></pre>
</div>
<div id="read-many-csv" class="section level3">
<h3>Read many csv</h3>
<p>See iris_csv file created in the csv section of this document. Read these csv files into one data frame. Note the Species column has to be present in the csv files, otherwise we would loose that information.</p>
<pre class="r"><code>iris_csv &lt;- list.files(data_folder, full.names = TRUE) %&gt;% 
    purrr::map_dfr(read_csv)</code></pre>
</div>
<div id="write-to-many-csv" class="section level3">
<h3>Write to many csv</h3>
<pre class="r"><code>#dir.create(&quot;output&quot;)
forestEU_nested &lt;- forestEU_nested %&gt;% 
    mutate(filename = paste0(&quot;output/&quot;, Country, &quot;.csv&quot;),
    wrote_stuff = map2(interpolated, filename, write.csv))</code></pre>
</div>
</div>
<div id="tidy-evaluation" class="section level2">
<h2>tidy evaluation</h2>
<ul>
<li>Advanced R <a href="https://adv-r.hadley.nz/meta.html">metaprogramming section</a></li>
<li><a href="https://www.tidyverse.org/articles/2018/07/ggplot2-tidy-evaluation/">Examples of tidy evaluation with plots</a></li>
</ul>
<pre class="r"><code>scatter_plot &lt;- function(data, x, y) {
    x &lt;- enquo(x)
    y &lt;- enquo(y)
    ggplot(data) + geom_point(aes(!!x, !!y))
}
scatter_plot(mtcars, disp, drat)</code></pre>
<p>Another example use of metaprogramming to change variables</p>
<pre class="r"><code>add1000 &lt;- function(dtf, var){
      varright &lt;- enquo(var)
  varleft &lt;- quo_name(enquo(var))
    dtf %&gt;% 
            mutate(!!varleft := 1000 + (!!varright))
}
add1000(iris, Sepal.Length)</code></pre>
<ul>
<li><a href="https://thinkr.fr/tidyeval/">Tidy evaluation explained in French</a></li>
</ul>
</div>
<div id="tidyr" class="section level2">
<h2>tidyr</h2>
<p><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidyr vignette on tidy data</a> In the section on “Multiple types in one table”:</p>
<blockquote>
<p>Datasets often involve values collected at multiple levels, on different types of observational units. During tidying, each type of observational unit should be stored in its own table. This is closely related to the idea of database normalisation, where each fact is expressed in only one place. It’s important because otherwise inconsistencies can arise.</p>
</blockquote>
<blockquote>
<p>Normalisation is useful for tidying and eliminating inconsistencies. However, there are few data analysis tools that work directly with relational data, so analysis usually also requires denormalisation or the merging the datasets back into one table.</p>
</blockquote>
<p>Example use of <code>tidyr::nest()</code> to generate a group of plots: <a href="http://www.brodrigues.co/blog/2017-03-29-make-ggplot2-purrr/">make ggplot2 purrr</a>.</p>
<pre class="r"><code>library(tidyr)
library(dplyr)
library(purrr)
library(ggplot2)
piris &lt;- iris %&gt;%  
    group_by(Species) %&gt;% 
    nest() %&gt;% 
    mutate(plot = map2(data, Species, 
                       ~ggplot(data = .x, 
                               aes(x = Petal.Length, y = Petal.Width)) + 
                           geom_point() + ggtitle(.y)))
piris$plot[1]
piris$plot[3]
piris$plot[2]</code></pre>
</div>
</div>
<div id="working-directory" class="section level1">
<h1>Working directory</h1>
<p>Hadley Wickham on a <a href="https://stackoverflow.com/questions/4216753/check-existence-of-directory-and-create-if-doesnt-exist">Stackoverflow comment</a>:</p>
<blockquote>
<p>“You should never use setwd() in R code - it basically defeats the idea of using a working directory because you can no longer easily move your code between computers. – hadley Nov 20 ’10 at 23:44”</p>
</blockquote>
</div>
<div id="further-resources" class="section level1">
<h1>Further resources</h1>
<div id="blogs" class="section level2">
<h2>Blogs</h2>
<ul>
<li>Gavin Simpson <a href="http://www.fromthebottomoftheheap.net/2015/06/03/my-aversion-to-pipes/">My aversion to pipers</a> shows an Hadley tweet explaining that pipe might not be good in package development.</li>
</ul>
</div>
<div id="stackoverflow" class="section level2">
<h2>Stackoverflow</h2>
<ul>
<li><a href="https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/">Stack overflow question checklist</a> general programming</li>
<li><a href="https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example">How to make a great R reproducible example</a></li>
</ul>
</div>
<div id="teaching-r" class="section level2">
<h2>Teaching R</h2>
<ul>
<li><p><a href="http://varianceexplained.org/r/teach-tidyverse/">Teach the tidyverse to beginners</a></p></li>
<li><p><a href="http://www.noamross.net/blog/2014/4/16/vectorization-in-r--why.html">Vectorization in R, Why?</a></p></li>
<li><p><a href="https://github.com/carpentries/conversations/issues/18">Recommendations for resources for after workshops</a></p></li>
<li><p><a href="https://education.rstudio.com/learn/">Rstudio education</a></p></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
