<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Paul Rougieux" />

<meta name="date" content="2017-08-17" />

<title>Python Commands</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Paul Rougieux</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Tools
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="bash.html">Bash</a>
    </li>
    <li>
      <a href="communication.html">Communication</a>
    </li>
    <li>
      <a href="debian.html">Debian</a>
    </li>
    <li>
      <a href="docker.html">Docker</a>
    </li>
    <li>
      <a href="git.html">Git</a>
    </li>
    <li>
      <a href="learning.html">Learning</a>
    </li>
    <li>
      <a href="lyx.html">Lyx</a>
    </li>
    <li>
      <a href="mysql.html">MySQL</a>
    </li>
    <li>
      <a href="postgresql.html">PostgreSQL</a>
    </li>
    <li>
      <a href="publish.html">Publish</a>
    </li>
    <li>
      <a href="python.html">Python</a>
    </li>
    <li>
      <a href="R.html">R</a>
    </li>
    <li>
      <a href="vim.html">Vim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-microchip"></span>
     
    Algos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="clustering.html">Clustering</a>
    </li>
    <li>
      <a href="musical_scales.html">Musical scales</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="datasources.html">Sources</a>
    </li>
    <li>
      <a href="explore.html">Explore</a>
    </li>
  </ul>
</li>
<li>
  <a href="events.html">
    <span class="fa fa-users"></span>
     
    Events
  </a>
</li>
<li>
  <a href="publications.html">
    <span class="fa fa-book"></span>
     
    Publications
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Python Commands</h1>
<h4 class="author">Paul Rougieux</h4>
<h4 class="date">17 August 2017</h4>

</div>


<div id="pip" class="section level1">
<h1>Pip</h1>
<p>pypi.org <a href="https://pypi.org/project/pip/">pip</a>:</p>
<blockquote>
<p>“pip is the package installer for Python. You can use pip to install packages from the Python Package Index and other indexes.”</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/7948494/whats-the-difference-between-a-python-module-and-a-python-package">What is the difference between a python module and a python package</a></p>
<blockquote>
<p>“A package is a collection of modules in directories that give a package hierarchy.”</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/1471994/what-is-setup-py">What is setup.py?</a></p>
<div id="install-an-old-version" class="section level2">
<h2>Install an old version</h2>
<p>For example to install pandas 0.24.2</p>
<pre><code>python3 -m pip install --user pandas==0.24.2 </code></pre>
<p>or</p>
<pre><code>pip3 install --user pandas==0.24.2</code></pre>
<p>Sometimes you need to overwrite the existing version with I.</p>
<pre><code>pip install -I  package==version</code></pre>
</div>
<div id="install-a-local-version" class="section level2">
<h2>Install a local version</h2>
<p>To <a href="https://stackoverflow.com/a/18021540/2641825">install the local version of a package with pip</a></p>
<pre><code>pip install -e /develop/MyPackage</code></pre>
<p>According to <code>man pip</code>, the <code>-e</code> option “installs a project in editable mode (i.e. setuptools”develop mode“) from a local project path or a VCS url”.</p>
</div>
<div id="upload-a-package-to-pypi" class="section level2">
<h2>Upload a package to pypi</h2>
<p>To upload a package to pypi, you need a pypi account. The <a href="https://packaging.python.org/tutorials/packaging-projects/#uploading-the-distribution-archives">instructions on uploading distribution archives explain how to upload the package to pypi</a>:</p>
<pre><code>  python3 -m twine upload --repository testpypi dist/*</code></pre>
<div id="authorship" class="section level3">
<h3>Authorship</h3>
<p>It’s only possible to specify one author field in setup.py. The recommendation is to use a mailing list when there are multiple authors and to set separate files for attribution.</p>
<p><a href="https://stackoverflow.com/questions/9999829/how-to-specify-multiple-authors-emails-in-setup-py">How to specify multiple authords in setup.py?</a></p>
</div>
</div>
<div id="virtual-environments" class="section level2">
<h2>Virtual environments</h2>
<p><a href="https://pipenv.pypa.io/en/latest/">Pipenv</a> makes pip and virtual env work together.</p>
</div>
</div>
<div id="compilers" class="section level1">
<h1>Compilers</h1>
<div id="numba-just-in-time-compiler" class="section level2">
<h2>Numba just-in-time compiler</h2>
<p><a href="https://numba.readthedocs.io/en/stable/user/5minguide.html">Numba User Manual</a></p>
<blockquote>
<p>“When a call is made to a Numba-decorated function it is compiled to machine code “just-in-time” for execution and all or part of your code can subsequently run at native machine code speed!"</p>
</blockquote>
</div>
<div id="pythran-ahead-of-time-compiler" class="section level2">
<h2>Pythran Ahead of time compiler</h2>
<p><a href="https://github.com/serge-sans-paille/pythran" class="uri">https://github.com/serge-sans-paille/pythran</a></p>
<blockquote>
<p>“Pythran is an ahead of time compiler for a subset of the Python language, with a focus on scientific computing. It takes a Python module annotated with a few interface descriptions and turns it into a native Python module with the same interface, but (hopefully) faster.”</p>
</blockquote>
</div>
</div>
<div id="control-flow" class="section level1">
<h1>Control flow</h1>
<p>dotnetperls: <a href="https://www.dotnetperls.com/not-python">not python</a></p>
<p>Sample code with a function and if conditions:</p>
<pre><code>def function(condition):
    if condition:
        print(&quot;Hi&quot;)
    if not condition:
        print(&quot;Bye&quot;)
function(True)
function(False)
function(&#39;&#39;)
function(&#39;lalala&#39;)</code></pre>
</div>
<div id="databases" class="section level1">
<h1>Databases</h1>
<div id="sql-alchemy" class="section level2">
<h2>SQL Alchemy</h2>
<p>The <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-sql-method">pandas.to_sql</a> method uses sqlalchemy to write pandas data frame to a PostgreSQL database.</p>
<blockquote>
<p>“The pandas.io.sql module provides a collection of query wrappers to both facilitate data retrieval and to reduce dependency on DB-specific API. Database abstraction is provided by SQLAlchemy if installed. In addition you will need a driver library for your database. Examples of such drivers are psycopg2 for PostgreSQL or pymysql for MySQL. For SQLite this is included in Python’s standard library by default.”</p>
</blockquote>
<p>SQL Alchemy works with <a href="https://docs.sqlalchemy.org/en/14/core/schema.html">metadata objects</a>:</p>
<blockquote>
<p>The core of SQLAlchemy’s query and object mapping operations are supported by <strong>database metadata</strong>, which is comprised of Python objects that describe tables and other schema-level objects. These objects are at the core of three major types of operations - issuing CREATE and DROP statements (known as DDL), constructing SQL queries, and expressing information about structures that already exist within the database. Database metadata can be expressed by explicitly naming the various components and their properties, using constructs such as Table, Column, ForeignKey and Sequence, all of which are imported from the sqlalchemy.schema package. It can also be generated by SQLAlchemy using a process called reflection, which means you start with a single object such as Table, assign it a name, and then instruct SQLAlchemy to load all the additional information related to that name from a particular engine source.</p>
</blockquote>
<p><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html">Reflecting database objects</a></p>
<pre><code>from sqlalchemy import MetaData
from sqlalchemy import Table
meta = MetaData(schema = &quot;raw_comtrade&quot;)
meta.bind = comtrade.database.engine
yearly_hs2 = Table(&#39;yearly_hs2&#39;, meta, autoload_with=comtrade.database.engine)</code></pre>
<p>SQL Alchemy has an <a href="https://docs.sqlalchemy.org/en/14/orm/extensions/automap.html">automap</a> feature which generates mapped classes and relationships from a database schema.</p>
<p>I used <a href="https://pypi.org/project/sqlacodegen/">sqlacodegen</a> to automatically generate python code from an existing PostGreSQl database table as follows</p>
<pre><code>sqlacodegen --schema raw_comtrade --tables yearly_hs2 postgresql://rdb@localhost/biotrade</code></pre>
<div id="check-for-table-existence" class="section level3">
<h3>Check for table existence</h3>
<p>Paul’s <a href="https://stackoverflow.com/a/69224576/2641825">SO Answer</a>. SQL Alchemy’s recommended way to check for the presence of a table is to create an inspector object and use its <code>has_table()</code> method. The following example was copied from <a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table">sqlalchemy.engine.reflection.Inspector.has_table</a>, with the addition of an SQLite engine to make it reproducible:</p>
<pre><code>from sqlalchemy import create_engine, inspect
from sqlalchemy import MetaData, Table, Column, Text
engine = create_engine(&#39;sqlite://&#39;)
meta = MetaData()
meta.bind = engine
user_table = Table(&#39;user&#39;, meta, 
                   Column(&quot;name&quot;, Text),
                   Column(&quot;full_name&quot;, Text))
user_table.create()
inspector = inspect(engine)
inspector.has_table(&#39;user&#39;)</code></pre>
<p>You can also use the <code>user_table</code> metadata element <code>name</code> to check if it exists as such:</p>
<pre><code>inspector.has_table(user_table.name)</code></pre>
</div>
<div id="orm-querying-guide" class="section level3">
<h3>ORM querying guide</h3>
<div id="select-where" class="section level4">
<h4>Select where</h4>
<p>SQL Alchemy <a href="https://docs.sqlalchemy.org/en/14/orm/queryguide.html">Object Relational Model Querying Guide</a></p>
<pre><code>from sqlalchemy import select
stmt = select(user_table).where(user_table.c.name == &#39;spongebob&#39;)
print(stmt)</code></pre>
<p>Since version 1.4 <code>.where()</code> is a synonym of <code>.filter()</code> as explained in <a href="https://docs.sqlalchemy.org/en/14/orm/query.html#sqlalchemy.orm.Query.where">sqlalchemy.orm.Query.where</a>.</p>
</div>
<div id="insert" class="section level4">
<h4>Insert</h4>
<p><a href="https://docs.sqlalchemy.org/en/14/core/dml.html#sqlalchemy.sql.expression.insert">Insert</a> some data into the <code>user</code> table</p>
<pre><code>from sqlalchemy import insert
from sqlalchemy.orm import Session
stmt = (
    insert(user_table).
    values(name=&#39;Bob&#39;, full_name=&#39;Sponge Bob&#39;)
)
with Session(engine) as session:
    result = session.execute(stmt)
    session.commit()</code></pre>
</div>
<div id="orm-query-to-pandas" class="section level4">
<h4>ORM query to pandas</h4>
<p>Repeat the example table defined above, read the result of a <a href="https://docs.sqlalchemy.org/en/14/tutorial/data_select.html#the-select-sql-expression-construct">select</a> statement into a pandas data frame:</p>
<pre><code>import pandas
from sqlalchemy import create_engine
from sqlalchemy import MetaData, Table, Column, Text
from sqlalchemy.orm import Session
# Define metadata and create the table
engine = create_engine(&#39;sqlite://&#39;)
meta = MetaData()
meta.bind = engine
user_table = Table(&#39;user&#39;, meta,
                   Column(&quot;name&quot;, Text),
                   Column(&quot;full_name&quot;, Text))
user_table.create()
# Insert data into the user table
stmt = user_table.insert().values(name=&#39;Bob&#39;, full_name=&#39;Sponge Bob&#39;)
with Session(engine) as session:
    result = session.execute(stmt)
    session.commit()
# Select data into a pandas data frame
stmt = user_table.select().where(user_table.c.name == &#39;Bob&#39;)
df = pandas.read_sql_query(stmt, engine)</code></pre>
<p>Another way importing the select statement:</p>
<pre><code>from sqlalchemy import select
stmt = select(user_table).where(user_table.c.name == &#39;Bob&#39;)
df = pandas.read_sql_query(stmt, engine)</code></pre>
<p>Another way using a session</p>
<pre><code>with Session(engine) as session:
    df2 = pandas.read_sql(session.query(user_table).filter(user_table.name==&quot;Bob&quot;).statement, session.bind)</code></pre>
<p>Read the whole table into pandas</p>
<pre><code>df3 = pandas.read_sql_table(&quot;user&quot;, engine)</code></pre>
<p><a href="https://stackoverflow.com/a/69812326/2641825">Stack Overflow Answer</a></p>
</div>
</div>
</div>
<div id="postgresql" class="section level2">
<h2>PostgreSQL</h2>
<p>Create a database engin with SQLalchemy</p>
<pre><code>from sqlalchemy import create_engine
engine = create_engine(&#39;postgresql://myusername:mypassword@myhost:5432/mydatabase&#39;)</code></pre>
<p>Blogs and Stackoverflow</p>
<ul>
<li><p><a href="https://hakibenita.com/fast-load-data-python-postgresql">Load data into postgreSQL using python</a> (without pandas)</p></li>
<li><p><a href="https://medium.com/@apoor/quickly-load-csvs-into-postgresql-using-python-and-pandas-9101c274a92f">Load CSVs into PostgreSQL using python and pandas</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/413228/pygresql-vs-psycopg2">SO question pygresql-vs-psycopg2</a></p></li>
<li><p><a href="https://medium.com/poka-techblog/5-different-ways-to-backup-your-postgresql-database-using-python-3f06cea4f51">5 ways to backup your postgreSQl database using python</a> Mentions the <a href="https://pypi.org/project/sh/">sh package</a>, a subprocess replacement.</p></li>
</ul>
</div>
<div id="sqlite" class="section level2">
<h2>SQLite</h2>
<p>Create an SQLITE in memory database and add a table to it.</p>
<pre><code>In [17]: from sqlalchemy import create_engine, inspect
    ...: from sqlalchemy import MetaData, Table, Column, Text
    ...: engine = create_engine(&#39;sqlite://&#39;)
    ...: meta = MetaData()
    ...: meta.bind = engine
    ...: user_table = Table(&#39;user&#39;, meta, Column(&quot;name&quot;, Text))
    ...: user_table.create()
    ...: inspector = inspect(engine)
    ...: inspector.has_table(&#39;user&#39;)
Out[17]: True</code></pre>
<p>Create a file based database at a specific path:</p>
<pre><code># absolute path
e = create_engine(&#39;sqlite:////path/to/database.db&#39;)</code></pre>
</div>
</div>
<div id="editors" class="section level1">
<h1>Editors</h1>
<div id="spyder" class="section level2">
<h2>Spyder</h2>
<p>I have set the following shortcuts to be similar to RStudio:</p>
<ul>
<li>Ctrl+H find and replace dialog</li>
<li>Ctrl+R run selection or current line</li>
<li>Ctrl+Shift+C comment/uncomment code block</li>
<li>F1 inspect current object (i.e. display function and classes documentation)</li>
<li>F2 go to function definition</li>
</ul>
</div>
<div id="vim" class="section level2">
<h2>Vim</h2>
<p>See my page on <a href="vim.html">vim.html</a>.</p>
</div>
</div>
<div id="neural-networks" class="section level1">
<h1>Neural Networks</h1>
<div id="pytorch" class="section level2">
<h2>Pytorch</h2>
<p>Print the size of the output layer</p>
<pre><code>import torch
import torch.nn as nn
x = torch.randn(28,28).view(-1,1,28,28)
model = nn.Sequential(
      nn.Conv2d(1, 32, (3, 3)),
      nn.ReLU(),
      nn.MaxPool2d((2, 2)),
      nn.Conv2d(32, 64, (3, 3)),
)
print(model(x).shape)</code></pre>
</div>
</div>
<div id="objects" class="section level1">
<h1>Objects</h1>
<div id="object-types" class="section level2">
<h2>Object types</h2>
<p><code>type()</code> displays the type of an object.</p>
<pre><code>i = 1
print(type(i))
# &lt;type &#39;int&#39;&gt;
x = 1.2
print(type(x))
# &lt;type &#39;float&#39;&gt;
t = (1,2)
print(type(t))
# &lt;type &#39;tuple&#39;&gt;
l = [1,2]
print(type(l))
# &lt;type &#39;list&#39;&gt;</code></pre>
<div id="check-object-types" class="section level3">
<h3>Check object types</h3>
<p>Check if a variable is a string, int or float</p>
<pre><code>isinstance(&quot;a&quot;, str)
isinstance(1,  int)
isinstance(1.2, float)</code></pre>
</div>
<div id="convert-between-object-types" class="section level3">
<h3>Convert between object types</h3>
<p>Character to numeric</p>
<pre><code>int(&quot;3&quot;)
float(&quot;3.33&quot;)
int(&quot;3.33&quot;)</code></pre>
<p>Numeric to character</p>
<pre><code>str(2)</code></pre>
<p>Convert a list to a comma separated string</p>
<pre><code>&quot;,&quot;.join([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;])</code></pre>
<p>Another example with the list of the last 5 years</p>
<pre><code>import datetime
year = datetime.datetime.today().year
# Create a numeric list of years
YEARS = [year - i for i in range(1,6)]
# Convert each element of the list to a string
YEARS = [str(x) for x in YEARS]
&quot;,&quot;.join(YEARS)</code></pre>
</div>
<div id="dictionary" class="section level3">
<h3>Dictionary</h3>
<p>Create a dictionary</p>
<pre><code>ceci = {&#39;x&#39;:1, &#39;y&#39;:2, &#39;z&#39;:3}</code></pre>
<p>Converts 2 lists into a dictionary</p>
<pre><code>dict(zip([&#39;x&#39;, &#39;y&#39;, &#39;z&#39;], [1, 2, 3]))</code></pre>
<p>Loop over the key and values of a dictionary</p>
<pre><code>for key, value in ceci.items():
    print(key, &quot;has the value&quot;, value)</code></pre>
</div>
<div id="list" class="section level3">
<h3>List</h3>
<p><a href="https://stackoverflow.com/a/31077838/2641825">Remove an element from a list of strings</a></p>
<pre><code>myList = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]
myList.remove(&#39;c&#39;)
myList
[&#39;a&#39;, &#39;b&#39;, &#39;d&#39;]</code></pre>
<div id="list-of-tuples" class="section level4">
<h4>List of tuples</h4>
<p><a href="https://stackoverflow.com/questions/10632839/transform-list-of-tuples-into-a-flat-list-or-a-matrix">How to flatten a list of tuples</a></p>
<pre><code>nested_list = [(1, 2, 4), (0, 9)]</code></pre>
<p>Using <code>reduce</code>:</p>
<pre><code>reduce(lambda x,y:x+y, map(list, nested_list))                                                                                                                              
[1, 2, 4, 0, 9]</code></pre>
<p>Using itertools.chain:</p>
<pre><code>import itertools
list(itertools.chain.from_iterable(nested_list))</code></pre>
<p>Using <code>extend</code>:</p>
<pre><code>flat_list = []
for a_tuple in nested_list:
    flat_list.extend(list(a_tuple))                                                                                                                                     
flat_list
[1, 2, 4, 0, 9]</code></pre>
</div>
</div>
<div id="set" class="section level3">
<h3>Set</h3>
<p>Instances of <a href="https://docs.python.org/3/library/stdtypes.html#set">set</a> provide the following operations:</p>
<pre><code>issubset(other)
set &lt;= other

    Test whether every element in the set is in other.

set &lt; other

    Test whether the set is a proper subset of other, that is, set &lt;= other and set != other.

issuperset(other)
set &gt;= other

    Test whether every element in other is in the set.

set &gt; other

    Test whether the set is a proper superset of other, that is, set &gt;= other and set != other.

union(*others)
set | other | ...

    Return a new set with elements from the set and all others.

intersection(*others)
set &amp; other &amp; ...

    Return a new set with elements common to the set and all others.

difference(*others)
set - other - ...

    Return a new set with elements in the set that are not in the others.

symmetric_difference(other)
set ^ other

    Return a new set with elements in either the set or other but not both.</code></pre>
</div>
</div>
<div id="programming-objects" class="section level2">
<h2>Programming objects</h2>
<div id="inheritance-and-composition" class="section level3">
<h3>Inheritance and composition</h3>
<p>Below is an example of object inheritance where a Car and a Boat classes inherit from a Vehicle class.</p>
<pre><code>class Vehicle(object):

    def __init__(self, color, speed_max, garage=None):
        self.color = color
        self.speed_max = speed_max
        self.garage = garage

    def paint(self, new_color):
        self.color = new_color

    def go_back_home(self, new_color):
        self.position = self.go_to(self.parent.location)

class Car(Vehicle):

    def open_door(self):
        pass

class Boat(Vehicle):

    def open_balast(self):
        pass

honda = Car(&#39;bleu&#39;, 60)
gorgeoote = Boat(&#39;rouge&#39;, 30)
honda.paint(&#39;purple&#39;)</code></pre>
<p>Note that the object should be able to access it’s parent properties through the super() method.</p>
<p>Below an example of object composition where the Garage class is parent to many Vehicle objects.</p>
<pre><code>class Garage(object):

    def __init__(self, all_vehicles):
        self.all_vehicles = all_vehicles

    def mass_paint(self, new_color):
        for v in self.all_vehicles: v.paint(new_color)

    def build_car(self, color):
        new_car = Car(color, 90, self)
        self.all_vehicles.append(new_car)
        return new_car

    @property
    def location(self):
        return &#39;10, 18&#39;


mike = Garage([honda, gorgeoote])

mike.mass_paint()

sport_car = mike.build_car(&#39;rouge&#39;)</code></pre>
</div>
<div id="why-do-python-classes-inherit-object" class="section level3">
<h3>Why do Python classes inherit object?</h3>
<p><a href="https://stackoverflow.com/questions/4015417/why-do-python-classes-inherit-object">Why do Python classes inherit object?</a></p>
<blockquote>
<p>So, what should you do?</p>
</blockquote>
<blockquote>
<p>In Python 2: always inherit from object explicitly. Get the perks.</p>
</blockquote>
<blockquote>
<p>In Python 3: inherit from object if you are writing code that tries to be Python agnostic, that is, it needs to work both in Python 2 and in Python 3. Otherwise don’t, it really makes no difference since Python inserts it for you behind the scenes.</p>
</blockquote>
</div>
</div>
</div>
<div id="http" class="section level1">
<h1>HTTP</h1>
<div id="file-download" class="section level2">
<h2>File download</h2>
<div id="zipped-csv-files" class="section level3">
<h3>Zipped csv files</h3>
<p>The following example uses urllib.request.urlopen to download a zip file containing Oceania’s crop production data from the FAO statistical database. In that example, it is necessary to define a minimal header, otherwise FAOSTAT throws an <code>Error 403: Forbidden</code>. It was posted as a <a href="https://stackoverflow.com/a/68804963/2641825">StackOverflow Answer</a>.</p>
<pre><code>import shutil
import urllib.request
import tempfile

# Create a request object with URL and headers    
url = “http://fenixservices.fao.org/faostat/static/bulkdownloads/Production_Crops_Livestock_E_Oceania.zip”
header = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (X11; Linux x86_64) &#39;}
req = urllib.request.Request(url=url, headers=header)

# Define the destination file
dest_file = tempfile.gettempdir() + &#39;/&#39; + &#39;crop.zip&#39;
print(f“File located at:{dest_file}”)

# Create an http response object
with urllib.request.urlopen(req) as response:
    # Create a file object
    with open(dest_file, &quot;wb&quot;) as f:
        # Copy the binary content of the response to the file
        shutil.copyfileobj(response, f)</code></pre>
<p>Based on <a href="https://stackoverflow.com/a/48691447/2641825" class="uri">https://stackoverflow.com/a/48691447/2641825</a> and <a href="https://stackoverflow.com/a/66591873/2641825" class="uri">https://stackoverflow.com/a/66591873/2641825</a>, see also the documentation at <a href="https://docs.python.org/3/howto/urllib2.html" class="uri">https://docs.python.org/3/howto/urllib2.html</a></p>
</div>
<div id="json-files" class="section level3">
<h3>JSON files</h3>
<p>The following loads a JSON file into a pandas data frame from the Comtrade API.</p>
<pre><code>import urllib.request
import json
import pandas

url_reporter = &quot;https://comtrade.un.org/Data/cache/reporterAreas.json&quot;
url_partner = &quot;https://comtrade.un.org/Data/cache/partnerAreas.json&quot;

# attempt with pandas.io, with an issue related to nested json
pandas.io.json.read_json(url_reporter, encoding=&#39;utf-8-sig&#39;)
pandas.io.json.read_json(url_partner)
# `results` is a character column containing {&#39;id&#39;: &#39;4&#39;, &#39;text&#39;: &#39;Afghanistan&#39;}.
# Is there a way to tell read_json to load the id and text columns directly instead?</code></pre>
<p><a href="https://stackoverflow.com/a/68988284/2641825">SO answer</a></p>
<blockquote>
<p>“Since the whole processing is done in the pd.io.json.read_json method, we cannot select the keys to direct to the actual data that we are after. So you need to run this additional code to get your desired results:”</p>
</blockquote>
<pre><code>df = pandas.io.json.read_json(url_reporter, encoding=&#39;utf-8-sig&#39;)
df2 = pandas.json_normalize(df.results.to_list())</code></pre>
<p>Other attempt using lower level packages</p>
<pre><code>req = urllib.request.Request(url=url_reporter)
with urllib.request.urlopen(req) as response:
    json_content = json.load(response)
    df = pandas.json_normalize(json_content[&#39;results&#39;])

In [17]: df
Out[17]:
      id                    text
0    all                     All
1      4             Afghanistan
2      8                 Albania
3     12                 Algeria
4     20                 Andorra
..   ...                     ...
252  876  Wallis and Futuna Isds
253  887                   Yemen
254  894                  Zambia
255  716                Zimbabwe
256  975                   ASEAN</code></pre>
<ul>
<li><p>Related question I asked on SO.: <a href="https://stackoverflow.com/questions/68985729/how-to-load-a-nested-data-frame-with-pandas-io-json-read-json">How to load a nested data frame with pandas.io.json.read_json?</a></p></li>
<li><p>Enconding issue <a href="https://stackoverflow.com/questions/57152985/what-is-the-difference-between-utf-8-and-utf-8-sig">What is the difference between utf-8 and utf-8-sig?</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/2223882/whats-the-difference-between-utf-8-and-utf-8-without-bom">What’s the difference between UTF-8 and UTF-8 without BOM?</a></p></li>
</ul>
</div>
</div>
</div>
<div id="ipython" class="section level1">
<h1>ipython</h1>
<p>Add these options at the ipyhton command line to reload objects automatically while you are coding</p>
<pre><code>%load_ext autoreload   
%autoreload 2         </code></pre>
<div id="debugging-in-ipython" class="section level2">
<h2>Debugging in ipython</h2>
<p>Once an error occurs at the ipython command line. Press <code>debug</code> then you can move up the stack trace with:</p>
<pre><code>`u`</code></pre>
<p>Move down the stack trace with:</p>
<pre><code>`d` </code></pre>
<p>Show code context of the error:</p>
<pre><code>`l` </code></pre>
<p>Show available variable in the current context:</p>
<pre><code>`a` </code></pre>
</div>
</div>
<div id="jupyter-notebooks" class="section level1">
<h1>Jupyter notebooks</h1>
<div id="call-bash-from-a-notebook" class="section level2">
<h2>Call bash from a notebook</h2>
<p>Prefix the bash call with an exclamation mark, for example:</p>
<pre><code>!df -h</code></pre>
<p>In fact the question mark also works from an ipython shell. See also <a href="https://stackoverflow.com/questions/45784499/difference-between-and-in-jupyter-notebooks">Difference between ! and % in Jupyter Notebooks</a></p>
</div>
<div id="dashboards-and-widgets" class="section level2">
<h2>Dashboards and widgets</h2>
<ul>
<li><p><a href="https://github.com/voila-dashboards/voila">Voila dashboard</a></p>
<ul>
<li>Examples dasboards and applications in the <a href="https://voila-gallery.org/">Voilà gallery</a></li>
</ul></li>
<li><p><a href="https://github.com/jupyter-widgets/ipywidgets">ipywidgets</a></p>
<blockquote>
<p>“interactive HTML widgets for Jupyter notebooks and the IPython kernel.”</p>
</blockquote></li>
</ul>
</div>
<div id="display-all-rows-and-columns-of-a-data-frame" class="section level2">
<h2>Display all rows and columns of a data frame</h2>
<p>Display all columns</p>
<pre><code>pandas.options.display.max_columns = None</code></pre>
<p>Display max rows</p>
<pre><code>pandas.set_option(&#39;display.max_rows&#39;, 500)</code></pre>
<p>With a context manager <a href="https://stackoverflow.com/a/47113685/2641825">as in this answer</a></p>
<pre><code>with pd.option_context(&#39;display.max_rows&#39;, 100, &#39;display.max_columns&#39;, 10):
some pandas stuff</code></pre>
</div>
<div id="download-data-from-a-jupyter-notebook" class="section level2">
<h2>Download data from a jupyter notebook</h2>
<p>I wrote this csv download function in an <a href="https://stackoverflow.com/a/57613621/2641825">SO answer</a></p>
<pre><code>def csv_download_link(df, csv_file_name, delete_prompt=True):
    &quot;&quot;&quot;Display a download link to load a data frame as csv from within a Jupyter notebook&quot;&quot;&quot;
    df.to_csv(csv_file_name, index=False)
    from IPython.display import FileLink
    display(FileLink(csv_file_name))
    if delete_prompt:
        a = input(&#39;Press enter to delete the file after you have downloaded it.&#39;)
        import os
        os.remove(csv_file_name)</code></pre>
<p>To get a link to a csv file, enter the above function and the code below in a jupyter notebook cell :</p>
<pre><code>csv_download_link(df, &#39;df.csv&#39;)</code></pre>
</div>
<div id="documentation-with-jupyter" class="section level2">
<h2>Documentation with Jupyter</h2>
<p><a href="https://hub.packtpub.com/using-jupyter-write-documentation/">Using jupyter to write documentation</a></p>
</div>
<div id="help-in-a-jupyter-notebook" class="section level2">
<h2>Help in a jupyter notebook</h2>
<p>To get help on a function, enter <code>function_name?</code> in a cell. Quick hep can also be obtained by pressing SHIFT + TAB.</p>
</div>
<div id="install-jupyter" class="section level2">
<h2>Install Jupyter</h2>
<p>To <a href="https://jupyter.org/install">install Jupyter</a> notebooks on python3:</p>
<pre><code>pip3 install jupyter notebook</code></pre>
<p>Then start the notebook server as such:</p>
<pre><code>jupyter notebook</code></pre>
</div>
<div id="security-and-authentication-on-a-public-server" class="section level2">
<h2>Security and authentication on a public server</h2>
<p><a href="https://stackoverflow.com/questions/37808410/ipython-jupyter-notebook-with-authentication">Jupyter notebook with authentication</a></p>
</div>
<div id="toc-table-of-content-in-your-notebooks" class="section level2">
<h2>TOC Table of content in your notebooks</h2>
<p>Install <a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions">jupyter_contrib_nbextensions</a></p>
<pre><code>python3 -m pip install --user jupyter_contrib_nbextensions
python3 -m jupyter contrib nbextension install --user</code></pre>
<p>Activate the table of content extension:</p>
<pre><code>python3 -m jupyter nbextension enable toc2/main</code></pre>
<p>There are many other extensions available in this package. <strong>Optionally</strong> you can install the jupyter notebook extension configurator (not needed)</p>
<pre><code>python3 -m pip install --user jupyter_nbextensions_configurator
jupyter nbextensions_configurator enable --user</code></pre>
<p>This will make a configuration interface available at:</p>
<pre><code>http://localhost:8888/nbextensions</code></pre>
<p>Using the old Table of Content extension <a href="https://github.com/minrk/ipython_extensions#table-of-contents">jupyter table of content extension</a></p>
<pre><code>jupyter nbconvert --to markdown mynotebook.ipynb
jupyter nbconvert --to html mynotebook.ipynb</code></pre>
<p>For a colleague using Anaconda <a href="https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/install.html">Installing jupyter_contrib_nbextensions</a> specifies that</p>
<blockquote>
<p>“There are conda packages for the notebook extensions and the jupyter_nbextensions_configurator available from conda-forge. You can install both using”</p>
</blockquote>
<pre><code>conda install -c conda-forge jupyter_contrib_nbextensions</code></pre>
</div>
<div id="jupytext-version-control-with-markdown-and-git" class="section level2">
<h2>Jupytext version control with markdown and git</h2>
<p>Convert notebooks to markdown so they are easier to track in git.</p>
<p>Install <a href="https://github.com/mwouts/jupytext" class="uri">https://github.com/mwouts/jupytext</a></p>
<pre><code>python3 -m pip install --user jupytext</code></pre>
<p>More commands:</p>
<pre><code>python3 -m jupyter notebook --generate-config
vim ~/.jupyter/jupyter_notebook_config.py</code></pre>
<p>Add this line:</p>
<pre><code>c.NotebookApp.contents_manager_class = &quot;jupytext.TextFileContentsManager&quot;</code></pre>
<p>And also this line if you always want to pair notebooks with their markdown counterparts:</p>
<pre><code>c.ContentsManager.default_jupytext_formats = &quot;ipynb,md&quot;</code></pre>
<p>More commands:</p>
<pre><code>python3 -m jupyter nbextension install jupytext --py --user
python3 -m jupyter nbextension enable  jupytext --py --user</code></pre>
<p>Add syncing to a given notebook:</p>
<pre><code># Markdown sync
jupytext --set-formats ipynb,md --sync ~/repos/example_repos/notebooks/test.ipynb
# Python sync
jupytext --set-formats ipynb,py --sync ~/repos/example_repos/notebooks/test.ipynb</code></pre>
</div>
</div>
<div id="errors-exceptions-and-logging" class="section level1">
<h1>Errors, exceptions and logging</h1>
<div id="handling-exceptions-with-try-and-except-statements" class="section level2">
<h2>Handling Exceptions with try and except statements</h2>
<p>Python documentation on <a href="https://docs.python.org/3/tutorial/errors.html#handling-exceptions">Handling Exceptions</a>.</p>
<pre><code>while True:
    try:
        x = int(input(&quot;Please enter a number: &quot;))
        break
    except ValueError:
        print(&quot;Oops!  That was no valid number.  Try again...&quot;)</code></pre>
<p><a href="https://stackoverflow.com/a/4690655/2641825">Exception message capturing</a></p>
<pre><code>for i in [1,0]:
    try:
        print(1/i)
    except Exception as e:
        print(&quot;Failed to compute:&quot;, str(e))</code></pre>
</div>
<div id="raising-exceptions" class="section level2">
<h2>Raising Exceptions</h2>
<p>Python documentation on <a href="https://docs.python.org/3/tutorial/errors.html#raising-exceptions">Raising Exceptions</a></p>
<pre><code>raise Exception(&#39;spam&#39;)
raise ValueError(&#39;Not an acceptable value&#39;)
raise NameError(&#39;Wrong name&#39;)</code></pre>
</div>
<div id="logging" class="section level2">
<h2>Logging</h2>
<p>docs.python.org <a href="https://docs.python.org/3/howto/logging-cookbook.html">logging cookbook</a></p>
<p>Pylint error: Use lazy % formatting in logging functions</p>
<p><a href="https://stackoverflow.com/a/52012660/2641825">Answer to Lazy evaluation of strings in python logging: comparing <code>%</code> with <code>.format</code></a></p>
<p>The documentation <a href="https://docs.python.org/2/library/logging.html" class="uri">https://docs.python.org/2/library/logging.html</a> suggest the following for lazy evaluation of string interpolation:</p>
<pre><code>logging.getLogger().debug(&#39;test: %i&#39;, 42)</code></pre>
</div>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>Functions in python can be defined with</p>
<pre><code>def add_one(x):
    return x + 1
add_one(1)

# 2</code></pre>
<div id="call-by-reference-or-call-by-value" class="section level2">
<h2>Call by reference or call by value</h2>
<p>When using numpy arrays, python displays a behaviour of call by reference</p>
<pre><code>a = np.array([1,2])

def changeinput(x, scalar):
    x[0] = scalar

changeinput(a,3)

a
# array([3, 2])</code></pre>
<p>This is really weird coming from R, which has a copy-on-modify principle.</p>
<p>The R Language Definition says this (in section 4.3.3 Argument Evaluation)</p>
<blockquote>
<p>“The semantics of invoking a function in R argument are call-by-value. In general, supplied arguments behave as if they are local variables initialized with the value supplied and the name of the corresponding formal argument. Changing the value of a supplied argument within a function will not affect the value of the variable in the calling frame. [Emphasis added]”</p>
</blockquote>
</div>
<div id="decorators" class="section level2">
<h2>Decorators</h2>
<p>Decorators are a way to wrap a function around another function. It is useful to repeat a pattern of behaviour around a function.</p>
<ul>
<li>Data camp <a href="https://www.datacamp.com/community/tutorials/decorators-python">course on decorators</a></li>
<li>Examples <a href="https://www.oreilly.com/ideas/5-reasons-you-need-to-learn-to-write-python-decorators">5 use cases for decorators</a></li>
</ul>
<p>I have used decorators to cache the function output along a data processing pipeline.</p>
</div>
<div id="docstring-documentation" class="section level2">
<h2>Docstring Documentation</h2>
<p>Document python functions with the sphinx convention <a href="https://stackoverflow.com/a/40596167">SO Answer</a></p>
<pre><code>def send_message(sender, recipient, message_body, priority=1) -&gt; int:
   &quot;&quot;&quot;
   Send a message to a recipient

   :param str sender: The person sending the message
   :param str recipient: The recipient of the message
   :param str message_body: The body of the message
   :param priority: The priority of the message, can be a number 1-5
   :type priority: integer or None
   :return: the message id
   :rtype: int
   :raises ValueError: if the message_body exceeds 160 characters
   :raises TypeError: if the message_body is not a basestring
   &quot;&quot;&quot;</code></pre>
</div>
</div>
<div id="math" class="section level1">
<h1>Math</h1>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-do-math-in-python-3-with-operators">How to do maths in python 3 with operators</a></p>
<p>2 to the power of 3</p>
<pre><code>2**3
# 8</code></pre>
<p>Floor division</p>
<pre><code>5//3
# 1</code></pre>
<p>Modulo</p>
<pre><code>5%3
# 2</code></pre>
</div>
<div id="numpy-vectors-and-matrices-arrays" class="section level1">
<h1>Numpy vectors and matrices (arrays)</h1>
<p>All examples below are based on the numpy package being imported as np :</p>
<pre><code>import numpy as np</code></pre>
<div id="indexing-multi-dimensional-arrays-and-masks" class="section level2">
<h2>Indexing Multi-dimensional arrays and masks</h2>
<p>Numpy <a href="https://docs.scipy.org/doc/numpy/reference/arrays.indexing.html">array indexing</a></p>
<blockquote>
<p>“Basic slicing extends Python’s basic concept of slicing to N dimensions. Basic slicing occurs when obj is a slice object (constructed by start:stop:step notation inside of brackets), an integer, or a tuple of slice objects and integers.” […] The basic slice syntax is i:j:k where i is the starting index, j is the stopping index, and k is the step (<span class="math inline">\(k\neq0\)</span>). “[…]”Advanced indexing always returns a copy of the data (contrast with basic slicing that returns a view)." “Integer array indexing allows selection of arbitrary items in the array based on their N-dimensional index. Each integer array represents a number of indexes into that dimension.”</p>
</blockquote>
<pre><code>x[0:3,0:2]
# array([[0.64174957, 0.18540429],
#        [0.97558697, 0.69314058],
#        [0.51646795, 0.71055115]])</code></pre>
<p>In this case because every row is selected, it is the same as:</p>
<pre><code>x[:,0:2]</code></pre>
<p>Examples modified from <a href="https://docs.scipy.org/doc/numpy/user/basics.indexing.html" class="uri">https://docs.scipy.org/doc/numpy/user/basics.indexing.html</a></p>
<pre><code>y = np.arange(35).reshape(5,7)
print(y[np.array([0,2,4]), np.array([0,1,2])])

print(&#39;With slice 1:3&#39;)
print(y[np.array([0,2,4]),1:3])
print(&#39;is equivalent to&#39;)
print(y[np.array([[0],[2],[4]]),np.array([[1,2]])])
# This one is the same but transposed, which is weird
print(y[np.array([[0,2,4]]),np.array([[1],[2]])])
# Notice the difference with the following
print(y[np.array([0,2,4]),np.array([1,2,3])])</code></pre>
<p>Masks <a href="https://docs.scipy.org/doc/numpy/reference/maskedarray.generic.html">masked array</a> We wish to mark the fourth entry as invalid. The easiest is to create a masked array:</p>
<pre><code>x = np.array([1, 2, 3, -1, 5])
mx = np.ma.masked_array(x, mask=[0, 0, 0, 1, 0])
print(x.sum(), mx.sum())
# 10 11</code></pre>
</div>
<div id="matrix-creation-and-shapes" class="section level2">
<h2>Matrix creation and shapes</h2>
<p>Create a vector</p>
<pre><code>a = np.array([1,2,3])</code></pre>
<p>Create a matrix</p>
<pre><code>b = np.array([[1,2,3],[5,6,6]])</code></pre>
<p>Shape</p>
<pre><code>a.shape
# (3,)
b.shape
# (2, 3)</code></pre>
<p>Matrix of zeroes</p>
<pre><code>np.zeros([2,2])
#array([[0., 0.],
#       [0., 0.]])</code></pre>
<p>Create a matrix with an additional dimension</p>
<pre><code>np.zeros(b.shape + (2,))
array([[[0., 0.],
        [0., 0.],
        [0., 0.]],

       [[0., 0.],
        [0., 0.],
        [0., 0.]]])</code></pre>
<p>Transpose</p>
<pre><code>b.transpose()
# array([[1, 5],
#        [2, 6],
#        [3, 6]])
c = b.transpose()</code></pre>
<p>Math functions in numpy:</p>
<pre><code>np.cos()
np.sin()
np.tan()
np.exp()</code></pre>
<p>min and max</p>
<pre><code>x = np.array([1,2,3,4,5,-7,10,-8])
x.max()
# 10
x.min()
# -8</code></pre>
</div>
<div id="matrix-multiplication" class="section level2">
<h2>Matrix multiplication</h2>
<p>Matrix multiplication <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.matmul.html">matmul</a></p>
<pre><code>np.matmul(a,c)
# array([14, 35])

# Can also be written as
a @ c
# array([14, 35])</code></pre>
<p>Otherwise the multiplication symbol implements an element wise multiplication, also called the</p>
<p><a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices)">Hadamard product</a>. It only works on 2 matrices of same dimensions. Element-wise multiplication is used for example in convolution kernels.</p>
<pre><code>b * b
# array([[ 1,  4,  9],
#        [25, 36, 36]])</code></pre>
<p>So here is again an example showing the difference between</p>
<pre><code>m = np.array([[0,1],[2,3]])</code></pre>
<p>Element wise multiplication :</p>
<pre><code>m * m 
# array([[0, 1],
#        [4, 9]])</code></pre>
<p>Matrix multiplication :</p>
<pre><code>m @ m
# array([[ 2,  3],
#        [ 6, 11]])</code></pre>
</div>
<div id="norm-of-a-matrix" class="section level2">
<h2>Norm of a matrix</h2>
<p>Linear algebra functionalities are provided by numpy.linalg For example the norm of a matrix or vector:</p>
<pre><code>np.linalg.norm(x)
# 16.3707055437449
np.linalg.norm(np.array([3,4]))
# 5.0
np.linalg.norm(a)
# 3.7416573867739413</code></pre>
<p>Norm of the matrix for the regularization parameter in a machine learning model</p>
<pre><code>bli = np.array([[1, 1, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 1, 0.0, 0.0, 0.0]])
sum(np.linalg.norm(bli, axis=0)**2) 3.0000000000000004
sum(np.linalg.norm(bli, axis=1)**2) 3.0000000000000004
np.linalg.norm(bli)**2 2.9999999999999996</code></pre>
<p>Append vs concatenate</p>
<pre><code>x = np.array([1,2])
print(np.append(x,x))
# [1 2 1 2]
print(np.concatenate((x,x),axis=None))
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6]])
print(np.concatenate((a, b), axis=0))
print(np.concatenate((a, b.T), axis=1))
print(np.concatenate((a, b), axis=None))</code></pre>
</div>
<div id="random-vector-or-matrices" class="section level2">
<h2>Random vector or matrices</h2>
<pre><code>x = np.random.random([3,4])
x
# array([[0.64174957, 0.18540429, 0.7045183 , 0.44623567],
#        [0.97558697, 0.69314058, 0.32469324, 0.82612627],
#        [0.51646795, 0.71055115, 0.74864751, 0.2142459 ]])</code></pre>
<p>Random choice, with a given probability Choose zero with probability 0.1 and one with probability 0.9.</p>
<pre><code>for i in range(10):
    print(np.random.choice(2, p=[0.1, 0.9]))
    
print(np.random.choice(2, 10, p=[0.1, 0.9]))
print(np.random.choice(2, (10,10), p=[0.1, 0.9]))

[[1 1 1 1 1 1 1 1 1 0]
 [1 1 1 1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1 1 1 0]
 [1 1 1 1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1 0 1 1]
 [1 1 1 0 1 1 1 1 1 1]
 [1 1 0 1 1 1 1 1 0 1]
 [1 1 1 1 1 1 1 1 1 1]
 [1 1 1 1 1 1 0 1 1 0]
 [1 1 1 1 1 1 1 1 1 1]]</code></pre>
<p>Error if probabilities do not sum up to one</p>
<pre><code>print(np.random.choice(2, p=[0.1, 0.8]))

# ---------------------------------------------------------------------------
# ValueError                                Traceback (most recent call last)
# &lt;ipython-input-31-8a8665287968&gt; in &lt;module&gt;
# ----&gt; 1 print(np.random.choice(2, p=[0.1, 0.8]))

# mtrand.pyx in numpy.random.mtrand.RandomState.choice()

# ValueError: probabilities do not sum to 1</code></pre>
</div>
</div>
<div id="pandas-data-frames" class="section level1">
<h1>Pandas data frames</h1>
<p>All code below assumes you have imported pandas</p>
<pre><code>import pandas </code></pre>
<div id="creating-a-data-frame" class="section level2">
<h2>Creating a data frame</h2>
<p>You can create a data frame by passing a dictionary with column names as keys</p>
<pre><code>pandas.DataFrame({&#39;x&#39;:range(0,3), &#39;y&#39;:[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]})
       a  b
    0  0  3
    1  1  4
    2  2  5</code></pre>
<p>Or by passing a list of tuples and defining the <code>columns</code> argument</p>
<pre><code>pandas.DataFrame(
    list(zip(range(0,3), [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;])), 
    columns=[&quot;x&quot;, &quot;y&quot;]
)</code></pre>
</div>
<div id="converting-a-data-frame" class="section level2">
<h2>Converting a data frame</h2>
<p>Convert 2 columns to a dictionary</p>
<pre><code>df = pandas.DataFrame({&#39;a&#39;:range(0,3), 
                       &#39;b&#39;:[&#39;p&#39;,&#39;q&#39;,&#39;r&#39;], 
                       &#39;c&#39;:[&#39;m&#39;,&#39;n&#39;,&#39;o&#39;]})
df.set_index(&#39;b&#39;).to_dict()[&#39;c&#39;]</code></pre>
</div>
<div id="assign-values" class="section level2">
<h2>Assign values</h2>
<p>Create a new column based on another one</p>
<pre><code>df = pandas.DataFrame({&#39;a&#39;:range(0,3), 
                       &#39;b&#39;:[&#39;p&#39;,&#39;q&#39;,&#39;r&#39;], 
                       &#39;c&#39;:[&#39;m&#39;,&#39;n&#39;,&#39;o&#39;]})
df[&quot;d&quot;] = df[&quot;a&quot;] * 2</code></pre>
<p>Use the <code>assign</code> method</p>
<pre><code>df.assign(e = lambda x: x[&quot;a&quot;] * 3)</code></pre>
<div id="recursive-function-xt-depends-on-xt-1" class="section level3">
<h3>Recursive function x(t) depends on x(t-1)</h3>
<p>A recursive function is difficult to vectorize because each input at time t depends on the previous input at time t-1. When possible use a year index for shorter selection with <code>.loc()</code>.</p>
<pre><code>import pandas
df = pandas.DataFrame({&#39;year&#39;:range(2020,2024),&#39;a&#39;:range(3,7)})
df1 = df.copy()
# Set the initial value
t0 = min(df1.year)
df1.loc[df1.year==t0, &quot;x&quot;] = 0

# Doesn&#39;t work when the right side of the equation is a pandas.core.series.Series
for t in range (min(df1.year)+1, max(df1.year)+1):
    df1.loc[df1.year==t, &quot;x&quot;] = df1.loc[df1.year==t-1,&quot;x&quot;] + df1.loc[df1.year==t-1,&quot;a&quot;]
print(df1)
#    year  a    x
# 0  2020  3  0.0
# 1  2021  4  NaN
# 2  2022  5  NaN
# 3  2023  6  NaN
print(type(df1.loc[df1.year==t-1,&quot;x&quot;] + df1.loc[df1.year==t-1,&quot;a&quot;]))
# &lt;class &#39;pandas.core.series.Series&#39;&gt;

# Works when the right side of the equation is a numpy array
for t in range (min(df1.year)+1, max(df1.year)+1):
    df1.loc[df1.year==t, &quot;x&quot;] = (df1.loc[df1.year==t-1,&quot;x&quot;] + df1.loc[df1.year==t-1,&quot;a&quot;]).unique()
    #break
print(df1)
#    year  a     x
# 0  2020  3   0.0
# 1  2021  4   3.0
# 2  2022  5   7.0
# 3  2023  6  12.0
print(type((df1.loc[df1.year==t-1,&quot;x&quot;] + df1.loc[df1.year==t-1,&quot;a&quot;]).unique()))
# &lt;class &#39;numpy.ndarray&#39;&gt;

# Assignement works directly when the .loc() selection is using a year index
df2 = df.set_index(&quot;year&quot;).copy()
# Set the initial value
df2.loc[df2.index.min(), &quot;x&quot;] = 0
for t in range (df2.index.min()+1, df2.index.max()+1):
    df2.loc[t, &quot;x&quot;] = df2.loc[t-1, &quot;x&quot;] + df2.loc[t-1,&quot;a&quot;]
    #break
print(df2)
#       a     x
# year
# 2020  3   0.0
# 2021  4   3.0
# 2022  5   7.0
# 2023  6  12.0
print(type(df2.loc[t-1, &quot;x&quot;] + df2.loc[t-1,&quot;a&quot;]))
# &lt;class &#39;numpy.float64&#39;&gt;

#SO answer using cumsum</code></pre>
<p>Our real problem is more complicated since there is a multiplicative and an additive component</p>
<pre><code>import pandas
df3 = pandas.DataFrame({&#39;year&#39;:range(2020,2024),&#39;a&#39;:range(3,7), &#39;b&#39;:range(8,12)})
df3 = df3.set_index(&quot;year&quot;).copy()
# Set the initial value
initial_value = 1
df3.loc[df3.index.min(), &quot;x&quot;] = initial_value
# Use a loop
for t in range (df3.index.min()+1, df3.index.max()+1):
    df3.loc[t, &quot;x&quot;] = df3.loc[t-1, &quot;x&quot;] * df3.loc[t-1, &quot;a&quot;] + df3.loc[t-1, &quot;b&quot;]
# Use cumsum and cumprod
df3[&quot;cumprod_a&quot;] = df3.a.cumprod().shift(1).fillna(1)
df3[&quot;cumsum_cumprod_a_b&quot;] = df3.cumprod_a.cumsum().shift(1).fillna(0) * df3.b
df3[&quot;x2&quot;] = df3.cumprod_a * initial_value + df3.cumsum_cumprod_a_b
print(df3)</code></pre>
<ul>
<li><p><code>type(df1.loc[df1.year==t-1,"x"] + df1.loc[df1.year==t-1,"a"])</code> is a pandas series while <code>type(df2.loc[t-1, "x"] + df2.loc[t-1,"a"])</code> is a numpy float. Why are types different?</p></li>
<li><p>Is there a better way to write a recursive <code>.loc()</code> assignment than to use <code>.unique()</code>?</p></li>
</ul>
<p>See also:</p>
<ul>
<li>related Question and Answer on <a href="https://stackoverflow.com/a/38008937/2641825">recursive assignment</a></li>
<li>related documentation on <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/gotchas.html#mutating-with-user-defined-function-udf-methods">Mutating User Defined Function methods</a></li>
</ul>
<blockquote>
<p>“It is a general rule in programming that one should not mutate a container while it is being iterated over. Mutation will invalidate the iterator, causing unexpected behavior.” […] “To resolve this issue, one can make a copy so that the mutation does not apply to the container being iterated over.”</p>
</blockquote>
</div>
</div>
<div id="columns" class="section level2">
<h2>Columns</h2>
<p>List columns as an index object</p>
<pre><code>df = pandas.DataFrame({&#39;a&#39;:range(0,3),&#39;b&#39;:range(3,6)})
df.columns</code></pre>
<p>List columns as a list</p>
<pre><code>df.columns.tolist()</code></pre>
<p>Select only certain columns in a list</p>
<pre><code>df[&#39;bla&#39;] = 0
cols = df.columns.tolist()
[name for name in cols if &#39;a&#39; in name]</code></pre>
<div id="rename-columns" class="section level3">
<h3>Rename columns</h3>
<p>Rename the ‘a’ column to ‘new’</p>
<pre><code>df.rename(columns={&#39;a&#39;:&#39;new&#39;})</code></pre>
<p>Rename columns to snake case using a regular expression</p>
<pre><code>import re
df.rename(columns=lambda x: re.sub(r&quot; &quot;, &quot;_&quot;, str(x)).lower(), inplace=True)
# Another regexp that replaces all non alphanumeric characters by an
# underscore
df.rename(columns=lambda x: re.sub(r&quot;\W+&quot;, &quot;_&quot;, str(x)).lower(), inplace=True)</code></pre>
<p>Remove parenthesis and dots in column names</p>
<pre><code>df.rename(columns=lambda x: re.sub(r&quot;[()\.]&quot;, &quot;&quot;, x), inplace=True)</code></pre>
</div>
</div>
<div id="group-by-operations" class="section level2">
<h2>Group by operations</h2>
<p>Compute the sum for the sepal length grouped by species</p>
<pre><code>import seaborn
iris = seaborn.load_dataset(&quot;iris&quot;)
iris.groupby(&#39;species&#39;).agg(sepal_length = (&#39;sepal_length&#39;, sum))</code></pre>
<p>Compute the sum but repeated for every original row</p>
<pre><code>iris[&#39;sepal_sum&#39;] = iris.groupby(&#39;species&#39;)[&#39;sepal_length&#39;].transform(&#39;sum&#39;)
iris</code></pre>
<p>Compute the cumulative sum of the sepal length</p>
<pre><code>iris[&#39;cumsum&#39;] = iris.groupby(&#39;species&#39;).sepal_length.cumsum()
iris[&#39;cumsum&#39;].plot()
from matplotlib import pyplot
pyplot.show()</code></pre>
<p>Lag</p>
<pre><code>iris[&#39;cumsum_lag&#39;] = iris.groupby(&#39;species&#39;)[&#39;cumsum&#39;].transform(&#39;shift&#39;, fill_value=0)
iris[[&#39;cumsum&#39;, &#39;cumsum_lag&#39;]].plot()
pyplot.show()</code></pre>
<div id="lag-or-shift-a-grouped-variable" class="section level3">
<h3>Lag or shift a grouped variable</h3>
<p>Load the flights dataset and for each month, display the passenger value in the same month of the previous year. Compare the <code>passengers</code> and <code>pass_year_minus_one</code> columns by displaying the tables for January and December.</p>
<pre><code>import seaborn
flights = seaborn.load_dataset(&quot;flights&quot;)
flights[&#39;pass_year_minus_one&#39;] = flights.groupby([&#39;month&#39;]).passengers.shift()
flights.query(&quot;month==&#39;January&#39;&quot;)
flights.query(&quot;month==&#39;December&#39;&quot;)</code></pre>
</div>
</div>
<div id="joining-and-merging" class="section level2">
<h2>Joining and merging</h2>
<p>Stackoverflow <a href="https://stackoverflow.com/questions/53645882/pandas-merging-101/53645883#53645883">Pandas merging</a></p>
</div>
<div id="read-and-write-csv" class="section level2">
<h2>Read and write csv</h2>
<div id="from-an-api" class="section level3">
<h3>From an API</h3>
<p>Pandas data frames can be used to read CSV files from the <a href="https://comtrade.un.org/Data/">Comtrade data API</a>. For example, using the default API URL for all countries:</p>
<pre><code>import pandas
df1 = pandas.read_csv(&#39;http://comtrade.un.org/api/get?max=500&amp;type=C&amp;freq=A&amp;px=HS&amp;ps=2020&amp;r=all&amp;p=0&amp;rg=all&amp;cc=TOTAL&amp;fmt=csv&#39;)

df2 = pandas.read_csv(&#39;http://comtrade.un.org/api/get?max=500&amp;type=C&amp;freq=A&amp;px=HS&amp;ps=2020&amp;r=all&amp;p=0&amp;rg=all&amp;cc=01&amp;fmt=csv&#39;,
                       # Force the id column to remain a character column,
                       # otherwise str &quot;01&quot; becomes an int 1.
                       dtype={&#39;Commodity Code&#39;: str, &#39;bli&#39;: str})</code></pre>
<p>Then use df.to_csv to write the data frame to a csv file</p>
<pre><code> df1.to_csv(&quot;/tmp/comtrade.csv&quot;)</code></pre>
</div>
</div>
<div id="reshaping" class="section level2">
<h2>Reshaping</h2>
<div id="from-wide-to-long" class="section level3">
<h3>From wide to long</h3>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/reshaping.html#reshaping-by-melt">The Pandas user guide on reshaping</a> gives several example using <code>melt</code> (easier to rename the “variable” and “value” columns) or <code>stack</code> (designed to work together with MultiIndex objects).</p>
<p>Reshape using <code>melt</code></p>
<pre><code>cheese = pandas.DataFrame(
      {
          &quot;first&quot;: [&quot;John&quot;, &quot;Mary&quot;],
          &quot;last&quot;: [&quot;Doe&quot;, &quot;Bo&quot;],
          &quot;height&quot;: [5.5, 6.0],
          &quot;weight&quot;: [130, 150],
      }
)
cheese
cheese.melt(id_vars=[&quot;first&quot;, &quot;last&quot;], var_name=&quot;quantity&quot;)</code></pre>
<p>Reshape using the <code>wide_to_long</code> convenience function</p>
<pre><code>import numpy as np
dft = pandas.DataFrame(
    {
        &quot;A1970&quot;: {0: &quot;a&quot;, 1: &quot;b&quot;, 2: &quot;c&quot;},
        &quot;A1980&quot;: {0: &quot;d&quot;, 1: &quot;e&quot;, 2: &quot;f&quot;},
        &quot;B1970&quot;: {0: 2.5, 1: 1.2, 2: 0.7},
        &quot;B1980&quot;: {0: 3.2, 1: 1.3, 2: 0.1},
        &quot;X&quot;: dict(zip(range(3), np.random.randn(3))),
    }
)
dft[&quot;id&quot;] = dft.index
dft
pandas.wide_to_long(dft, stubnames=[&quot;A&quot;, &quot;B&quot;], i=&quot;id&quot;, j=&quot;year&quot;)</code></pre>
</div>
<div id="from-long-to-wide" class="section level3">
<h3>From long to wide</h3>
<p>Pivot from long to wide format using <code>pivot</code>:</p>
<pre><code>df = pandas.DataFrame({
    &quot;lev1&quot;: [1, 1, 1, 2, 2, 2],
    &quot;lev2&quot;: [1, 1, 2, 1, 1, 2],
    &quot;lev3&quot;: [1, 2, 1, 2, 1, 2],
    &quot;lev4&quot;: [1, 2, 3, 4, 5, 6],
    &quot;values&quot;: [0, 1, 2, 3, 4, 5]})
df_wide = df.pivot(index=&quot;lev1&quot;, columns=[&quot;lev2&quot;, &quot;lev3&quot;], values=&quot;values&quot;)
df_wide

# lev2    1         2
# lev3    1    2    1    2
# lev1
# 1     0.0  1.0  2.0  NaN
# 2     4.0  3.0  NaN  5.0</code></pre>
<p>Rename the (sometimes confusing) axis names</p>
<pre><code>df_wide.rename_axis(columns=[None, None])

#         1         2
#         1    2    1    2
# lev1
# 1     0.0  1.0  2.0  NaN
# 2     4.0  3.0  NaN  5.0</code></pre>
</div>
</div>
<div id="replacement" class="section level2">
<h2>Replacement</h2>
<p><a href="https://stackoverflow.com/questions/12152716/python-pandas-equivalent-for-replace">Pyton pandas equivalent for replace</a></p>
<pre><code>import pandas
s = pandas.Series([&quot;ape&quot;, &quot;monkey&quot;, &quot;seagull&quot;])
s.replace([&quot;ape&quot;, &quot;monkey&quot;], [&quot;lion&quot;, &quot;panda&quot;])
s.replace(&quot;a&quot;, &quot;x&quot;, regex=True)
`s.replace({&quot;ape&quot;: &quot;lion&quot;, &quot;monkey&quot;: &quot;panda&quot;})`
pandas.Series([&quot;bla&quot;, &quot;bla&quot;]).replace(&quot;a&quot;,&quot;i&quot;,regex=True)</code></pre>
<div id="replace-values-where-a-condition-is-false" class="section level3">
<h3>Replace values where a condition is false</h3>
<p>Replace values where the condition is false see <code>help(df.where)</code></p>
<blockquote>
<p>“Where <code>cond</code> is True, keep the original value. Where False, replace with corresponding value from <code>other</code>.”</p>
</blockquote>
<pre><code>df = pandas.DataFrame({&#39;a&#39;:range(0,3), 
                       &#39;b&#39;:[&#39;p&#39;,&#39;q&#39;,&#39;r&#39;], 
                       &#39;c&#39;:[&#39;m&#39;,&#39;n&#39;,&#39;o&#39;]})
df[&quot;b&quot;].where(df[&quot;c&quot;].isin([&quot;n&quot;,&quot;o&quot;]),&quot;no&quot;)
df.where(df[&quot;c&quot;].isin([&quot;n&quot;,&quot;o&quot;]),&quot;no&quot;)</code></pre>
</div>
<div id="fill-na-values" class="section level3">
<h3>Fill Na values</h3>
<p>Replace NA values by another value</p>
<pre><code>import pandas
import numpy as np
df = pandas.DataFrame([[np.nan, 2, np.nan, 0],
                  [3, 4, np.nan, 1],
                  [np.nan, np.nan, np.nan, 5],
                  [np.nan, 3, np.nan, 4]],
                 columns=list(&quot;ABCD&quot;))
# Replace all NaN elements with 0s.
df.fillna(0)
# Replace by 0 and column 2 and by 1 in column B
df.fillna({&quot;A&quot;:0, &quot;B&quot;:1}, inplace=True)
df</code></pre>
</div>
</div>
<div id="selection-with-loc-iloc-query-isin-and-xs" class="section level2">
<h2>Selection with loc, iloc, query, isin and xs</h2>
<ul>
<li>blog <a href="https://www.shanelynn.ie/select-pandas-dataframe-rows-and-columns-using-iloc-loc-and-ix/">Select pandas data frame rows and columns using iloc and loc</a></li>
</ul>
<div id="loc" class="section level3">
<h3>loc</h3>
<p><code>.loc</code> is primarily label based, but may also be used with a boolean array.</p>
<p>I copied the examples below from the pandas <strong>loc</strong> documentation at: <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">pandas.DataFrame.loc</a></p>
<p>Create an example data frame</p>
<pre><code>import pandas
df = pandas.DataFrame([[1, 2], [4, 5], [7, 8]],
                      index=[&#39;cobra&#39;, &#39;viper&#39;, &#39;sidewinder&#39;],
                      columns=[&#39;max_speed&#39;, &#39;shield&#39;])</code></pre>
<p>List of index labels</p>
<pre><code>In :  df.loc[[&#39;viper&#39;, &#39;sidewinder&#39;]]
Out:
                    max_speed  shield
        viper               4       5
        sidewinder          7       8</code></pre>
<p>Note: in the case of a multi index, use tuples for index selection, see section below on multi index selection with loc.</p>
<p>Conditional that returns a boolean Series</p>
<pre><code>In :  df.loc[df[&#39;shield&#39;] &gt; 6]
Out:
                     max_speed  shield
         sidewinder          7       8</code></pre>
<p>Select rows that are not in [‘cobra’,‘viper’] Based on a <a href="https://stackoverflow.com/a/29140194/2641825">SO answer use isin on the index</a>:</p>
<pre><code>In : df.index.isin([&#39;cobra&#39;,&#39;viper&#39;])
Out: array([ True,  True, False])

In : df.loc[~df.index.isin([&#39;cobra&#39;,&#39;viper&#39;])]
Out: 
            max_speed  shield
sidewinder          7       8</code></pre>
<p>Slice with labels for row and labels for columns.</p>
<pre><code>In :  df.loc[&#39;cobra&#39;:&#39;viper&#39;, &#39;max_speed&#39;:&#39;shield&#39;]
Out:
               max_speed  shield
        cobra          1       2
        viper          4       5</code></pre>
<p>Set value for all items matching the list of labels</p>
<pre><code>In : df.loc[[&#39;viper&#39;, &#39;sidewinder&#39;], [&#39;shield&#39;]] = 50

In : df
Out:
                    max_speed  shield
        cobra               1       2
        viper               4      50
        sidewinder          7      50</code></pre>
<p>Another example using integers for the index</p>
<pre><code>In : df = pandas.DataFrame([[1, 2], [4, 5], [7, 8]],
                           index=[7, 8, 9],
                           columns=[&#39;max_speed&#39;, &#39;shield&#39;])</code></pre>
<p>Slice with integer labels for rows. Note that both the start and stop of the slice are included.</p>
<pre><code>In :  df.loc[8:9]
Out:
      max_speed  shield
   8          4       5
   9          7       8</code></pre>
<div id="multi-index-selection-with-loc" class="section level4">
<h4>Multi-index selection with loc</h4>
<p>Sample data copied from <code>help(df.loc)</code>:</p>
<pre><code>tuples = [
   (&#39;cobra&#39;, &#39;mark i&#39;), (&#39;cobra&#39;, &#39;mark ii&#39;),
   (&#39;sidewinder&#39;, &#39;mark i&#39;), (&#39;sidewinder&#39;, &#39;mark ii&#39;),
   (&#39;viper&#39;, &#39;mark ii&#39;), (&#39;viper&#39;, &#39;mark iii&#39;)
]
index = pandas.MultiIndex.from_tuples(tuples)
values = [[12, 2], [0, 4], [10, 20],
        [1, 4], [7, 1], [16, 36]]
df = pandas.DataFrame(values, columns=[&#39;max_speed&#39;, &#39;shield&#39;], index=index)</code></pre>
<p>Single label. Note this returns a DataFrame with a single index.</p>
<pre><code>df.loc[&#39;cobra&#39;]</code></pre>
<p>Single index tuple. Note this returns a Series.</p>
<pre><code>df.loc[(&#39;cobra&#39;, &#39;mark ii&#39;)]
df.loc[(:,&#39;mark ii&#39;)]</code></pre>
<p>Single tuple. Note using <code>[[]]</code> returns a DataFrame.</p>
<pre><code>df.loc[[(&#39;cobra&#39;, &#39;mark ii&#39;)]]</code></pre>
<p>Single label for row and column. Similar to passing in a tuple, this returns a Series.</p>
<pre><code>df.loc[&#39;cobra&#39;, &#39;mark i&#39;]</code></pre>
<p>Slice from index tuple to single label</p>
<pre><code>df.loc[(&#39;cobra&#39;, &#39;mark i&#39;):&#39;viper&#39;]</code></pre>
<p>Slice from index tuple to index tuple</p>
<pre><code>df.loc[(&#39;cobra&#39;, &#39;mark i&#39;):(&#39;viper&#39;, &#39;mark ii&#39;)]</code></pre>
</div>
</div>
<div id="iloc" class="section level3">
<h3>iloc</h3>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#indexing-integer">.iloc</a> is primarily integer position based (from 0 to length -1 of the axis), but may also be used with a boolean array.</p>
<p>Create a sample data frame:</p>
<pre><code>In : example = [{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4},
                {&#39;a&#39;: 100, &#39;b&#39;: 200, &#39;c&#39;: 300, &#39;d&#39;: 400},
                {&#39;a&#39;: 1000, &#39;b&#39;: 2000, &#39;c&#39;: 3000, &#39;d&#39;: 4000 }]
      df = pandas.DataFrame(example)

In : df
Out: 
            a     b     c     d
      0     1     2     3     4
      1   100   200   300   400
      2  1000  2000  3000  4000</code></pre>
<p>Index with a slice object. Note that it doesn’t include the upper bound.</p>
<pre><code>In :  df.iloc[0:2]
Out: 
          a    b    c    d
     0    1    2    3    4
     1  100  200  300  400</code></pre>
<p>With lists of integers.</p>
<pre><code>In : df.iloc[[0, 2], [1, 3]]
Out: 
            b     d
      0     2     4
      2  2000  4000</code></pre>
<p>With slice objects.</p>
<pre><code>In : df.iloc[1:3, 0:3]
Out: 
            a     b     c
      1   100   200   300
      2  1000  2000  3000</code></pre>
<p>With a boolean array whose length matches the columns.</p>
<pre><code>In : df.iloc[:, [True, False, True, False]]
Out: 
            a     c
      0     1     3
      1   100   300
      2  1000  3000</code></pre>
</div>
<div id="query" class="section level3">
<h3>Query</h3>
<p>Query the columns of a Data Frame with a boolean expression.</p>
<pre><code>df = pandas.DataFrame({&#39;A&#39;: range(1, 6),
                       &#39;B&#39;: range(10, 0, -2),
                       &#39;C&#39;: range(10, 5, -1)})
df.query(&quot;A &gt; B&quot;)

A  B  C
5  2  6</code></pre>
<p>Query using a variable</p>
<pre><code>limit = 3
df.query(&quot;A &gt; @limit&quot;)

A  B  C
4  4  7
5  2  6</code></pre>
</div>
<div id="isin" class="section level3">
<h3>isin</h3>
<p><a href="https://stackoverflow.com/questions/12096252/use-a-list-of-values-to-select-rows-from-a-pandas-dataframe">Use alist of values to select rows</a></p>
<pre><code>df = pandas.DataFrame({&#39;A&#39;: [5,6,3,4], &#39;B&#39;: [1,2,3,5]})
df[df[&#39;A&#39;].isin([3, 6])]
df.loc[df[&#39;A&#39;].isin([3, 6])]
df.query(&quot;A in [3,6]&quot;)</code></pre>
</div>
<div id="xs-cross-sections" class="section level3">
<h3>xs cross sections</h3>
<p>The <code>key</code> and <code>level</code> arguments specify which part of the multilevel index should be used. Create a sample data frame, copied from <code>help(df.xs)</code>:</p>
<pre><code>d = {&#39;num_legs&#39;: [4, 4, 2, 2],
     &#39;num_wings&#39;: [0, 0, 2, 2],
     &#39;class&#39;: [&#39;mammal&#39;, &#39;mammal&#39;, &#39;mammal&#39;, &#39;bird&#39;],
     &#39;animal&#39;: [&#39;cat&#39;, &#39;dog&#39;, &#39;bat&#39;, &#39;penguin&#39;],
     &#39;locomotion&#39;: [&#39;walks&#39;, &#39;walks&#39;, &#39;flies&#39;, &#39;walks&#39;]}
df = pandas.DataFrame(data=d)
df = df.set_index([&#39;class&#39;, &#39;animal&#39;, &#39;locomotion&#39;])
print(df)</code></pre>
<p>Select with a key following the order in which levels appear in the index:</p>
<pre><code>df.xs(&#39;mammal&#39;)
df.xs((&#39;mammal&#39;, &#39;dog&#39;))</code></pre>
<p>Select with a key and specify the levels:</p>
<pre><code>df.xs(key=&#39;cat&#39;, level=1)
df.xs(key=(&#39;bird&#39;, &#39;walks&#39;),
      level=[0, &#39;locomotion&#39;])</code></pre>
</div>
<div id="determine-whether-a-column-contains-a-particular-value" class="section level3">
<h3>Determine whether a column contains a particular value</h3>
<p><a href="https://stackoverflow.com/questions/21319929/how-to-determine-whether-a-pandas-column-contains-a-particular-value">How to determine whether a pandas column contains a particular varlue</a></p>
<blockquote>
<p>In of a Series checks whether the value is in the index:</p>
</blockquote>
<pre><code>In : s = pd.Series(list(&#39;abc&#39;))
In : 1 in s
Out: True
In : &#39;a&#39; in s
Out: False</code></pre>
<blockquote>
<p>One option is to see if it’s in unique values:</p>
</blockquote>
<pre><code>In : &#39;a&#39; in s.unique()
Out: True</code></pre>
</div>
</div>
<div id="sort-or-arrange-values" class="section level2">
<h2>Sort or arrange values</h2>
<p>Sort iris by descending order of species and ascending order of petal width</p>
<pre><code>iris.sort_values(by=[&quot;species&quot;, &quot;petal_width&quot;], ascending=[False,True])</code></pre>
</div>
<div id="string-operations-in-pandas" class="section level2">
<h2>String operations in pandas</h2>
<p>See also string operations in python in another section.</p>
<p>String operations in pandas use vectorized string methods of the class StringMethods(pandas.core.base.NoNewAttributesMixin).</p>
<pre><code>df = pandas.DataFrame({&#39;a&#39;:[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]})
help(df.a.str)</code></pre>
<p>Concatenate all values in a character vector:</p>
<pre><code>df[&#39;a&#39;].str.cat()</code></pre>
<p>Replace elements in a character vector:</p>
<pre><code>df[&#39;a&#39;].replace(&#39;a&#39;,&#39;b&#39;,regex=True)</code></pre>
</div>
<div id="difference-between-2-data-frames" class="section level2">
<h2>Difference between 2 data frames</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/48647534/python-pandas-find-difference-between-two-data-frames">Find difference between two data frames</a></li>
<li><a href="https://stackoverflow.com/questions/36891977/pandas-diff-of-two-dataframes/36893773">Diff of 2 data frames</a></li>
</ul>
<p>Two methods Using <code>merge</code>:</p>
<pre><code>merged = df1.merge(df2, indicator=True, how=&#39;outer&#39;)
merged[merged[&#39;_merge&#39;] == &#39;right_only&#39;]</code></pre>
<p>Using <code>drop_duplicates</code></p>
<pre><code>newdf=pd.concat[df1,df2].drop_duplicates(keep=False)</code></pre>
</div>
<div id="where-and-mask" class="section level2">
<h2>Where and mask</h2>
<p><code>where</code> replaces values that do not fit the condition and <code>mak</code> replaces values that fit the condition.</p>
<pre><code>s = pandas.Series(range(5))
s.where(s &gt; 1, 10)
s.mask(s &gt; 1, 10)</code></pre>
</div>
</div>
<div id="paths" class="section level1">
<h1>Paths</h1>
<div id="pathlib" class="section level2">
<h2>Pathlib</h2>
<p>Pathlib is an object oriented path API for python as explained in <a href="https://www.python.org/dev/peps/pep-0428/#why-an-object-oriented-api">PEP 428</a></p>
<p>Instead of</p>
<pre><code>import os
os.path.join(&#39;~&#39;,&#39;downloads&#39;)</code></pre>
<p>You can use:</p>
<pre><code>from pathlib import Path
Path(&#39;~&#39;) / &#39;downloads&#39;</code></pre>
<p>Data located in the home folder</p>
<pre><code> data_dir = Path.home() / &quot;repos/data/&quot;</code></pre>
</div>
</div>
<div id="plot" class="section level1">
<h1>Plot</h1>
<p><a href="https://pythonplot.com/">Python plotting for exploratory analysis</a> is a great gallery of plot examples, each example is written in 5 different plotting libraries: pandas, plotnine, plotly, altair and R ggplot2. There is also one seaborn example.</p>
<div id="matplotlib" class="section level2">
<h2>Matplotlib</h2>
<p>All matplotlib examples require the following imports:</p>
<pre><code>from matplotlib import pyplot as plt
plt.style.use(&#39;seaborn-whitegrid&#39;)
import numpy as np</code></pre>
<p>Simple line plot changing the figure size and the axes limit with pyplot</p>
<pre><code>plt.rcParams[&#39;figure.figsize&#39;] = [10, 10]
fig = plt.figure()
ax = plt.axes()
x = np.linspace(-1.5, 1.5, 1000)
ax.plot(x, 1-3*x)
ax.set_xlim(-6, 6)
ax.set_ylim(-6, 6)</code></pre>
<p>Scatter plot, using a colour variable and the ‘jet’ colour map.</p>
<pre><code>Y = np.array([1,-1,-1, 1])
X = np.array([
        [-1, -1],
        [ 1, -1],
        [-1,  1],
        [ 1,  1]])
fig = plt.figure()
ax = plt.axes()
ax.scatter(X[:,0], X[:,1],c=Y, cmap=&#39;jet&#39;)</code></pre>
<p>Use another <a href="https://matplotlib.org/examples/color/colormaps_reference.html">colour map</a></p>
<pre><code>ax.scatter(X[:,0], X[:,1],c=Y, cmap=&#39;Spectral&#39;)</code></pre>
<p>Plot the probability density function of the <a href="https://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a>.</p>
<p><span class="math display">\[f(x)=\frac{1}{\sigma{\sqrt {2\pi }}}e^{-{\frac {1}{2}}\left({\frac {x-\mu }{\sigma }}\right)^{2}}\]</span></p>
<p>With various sigma and mu values displayed in the legend.</p>
<pre><code>fig = plt.figure()
ax = plt.axes()
x = np.linspace(-5, 5, 1000)
def pdensitynormal(x,sigma_squared,mu):
    sigma = np.sqrt(sigma_squared)
    return 1/(sigma*np.sqrt(2*np.math.pi))*np.exp(-1/2*((x-mu)/sigma)**2)
ax.plot(x, pdensitynormal(x,0.2,0), label=&quot;$\sigma^2=0.2, \mu=0$&quot;)
ax.plot(x, pdensitynormal(x,1,0), label=&quot;$\sigma^2=1, \mu=0$&quot;)
ax.plot(x, pdensitynormal(x,5,0), label=&quot;$\sigma^2=5, \mu=0$&quot;)
ax.plot(x, pdensitynormal(x,0.5,-2), label=&quot;$\sigma^2=0.5, \mu=-2$&quot;)
ax.legend(loc=&quot;upper right&quot;)
plt.show()</code></pre>
<p>3D line, contour plot and scatter plot</p>
<pre><code>from mpl_toolkits import mplot3d # Required for 3d plots
fig = plt.figure()
ax = plt.axes(projection=&#39;3d&#39;)
# Data for a three-dimensional line
xline = np.linspace(-10, 10, 1000)
yline = np.linspace(-10, 10, 1000)
# Just a line
zline = xline**2 + yline**2
ax.plot3D(xline, yline, zline, &#39;gray&#39;)
# A mesh grid
X, Y = np.meshgrid(xline, yline)
Z = X**2 + Y**2
ax.contour3D(X, Y, Z, 50, cmap=&#39;binary&#39;)
# Scatter points
ax.scatter(1,2,3)</code></pre>
<p>See how the <code>np.meshgridi</code> objects interact with each other. Note this nested loop is not the optimal way to compute. Better to use X<strong>2 + Y</strong>2 directly as above.</p>
<pre><code>for i in range(Z.shape[0]):
    for j in range(Z.shape[1]):
        vector = np.array([X[i,j],Y[i,j]])
            Z[i,j] = np.linalg.norm(vector)**2
fig = plt.figure()
ax = plt.axes(projection=&#39;3d&#39;)
ax.contour3D(X, Y, Z, 50, cmap=&#39;binary&#39;)</code></pre>
<div id="pandas-plots-generate-matplotlib-axessubplot-objects" class="section level3">
<h3>Pandas plots generate matplotlib AxesSubplot objects</h3>
<p>Create some data and change the xticks labels</p>
<pre><code>import pandas
df = pandas.DataFrame({&#39;x&#39;:range(0,30), &#39;y&#39;:range(10,40)})
df.set_index(&#39;x&#39;, inplace=True)
plot = df.plot()
type(plot)
#help(plot)
plot.set_xticks(range(0,31,10), minor=False)</code></pre>
</div>
</div>
<div id="plotly" class="section level2">
<h2>Plotly</h2>
<p>The advantage of plotly is that it provides dynamic visualisation inside web pages, such as the possibility to zoom in a graph. It’s the open source component of a commercial project called Dash entreprise.</p>
<p>For example <a href="https://colab.research.google.com/github/bytehub-ai/blog-examples/blob/master/temperature_forecast_example.ipynb#scrollTo=7yJZA1CZSSx4">this notebook</a> on machine learning used to enhance the localisation of weather forecasts. Seen on this blog post <a href="https://medium.com/bytehub-ai/what-does-machine-learning-have-to-do-with-weather-94f3ac625ad3">What does machine learning have to do with weather</a>.</p>
</div>
<div id="plotnine" class="section level2">
<h2>Plotnine</h2>
<p>Grammar of graphics for python <a href="https://github.com/has2k1/plotnine" class="uri">https://github.com/has2k1/plotnine</a></p>
<div id="figure-size" class="section level3">
<h3>Figure size</h3>
<p>Change the <a href="https://plotnine.readthedocs.io/en/stable/generated/plotnine.options.figure_size.html">plotnine figure size</a></p>
<pre><code>import plotnine
plotnine.options.figure_size = (12, 8)</code></pre>
</div>
<div id="facet-grid" class="section level3">
<h3>Facet grid</h3>
<p>Create a facet grid plot</p>
<pre><code>from plotnine import ggplot, aes, geom_line, facet_grid, labs</code></pre>
</div>
</div>
<div id="seaborn" class="section level2">
<h2>Seaborn</h2>
<p>All seaborn examples below require the following imports and datasets:</p>
<pre><code>import seaborn
iris = seaborn.load_dataset(&quot;iris&quot;)
tips = seaborn.load_dataset(&quot;tips&quot;) 
from matplotlib import pyplot as plt</code></pre>
<div id="axes-limit" class="section level3">
<h3>Axes limit</h3>
<p>Set limits on the one axis in a Seaborn plot:</p>
<pre><code>p = seaborn.scatterplot(&#39;petal_length&#39;,&#39;petal_width&#39;,&#39;species&#39;,data=iris)
p.set(ylim=(-2,None))</code></pre>
<p>In Seaborn facet grid. <a href="https://stackoverflow.com/a/25213614/2641825">How to set xlim and ylim in seaborn facet grid</a></p>
<pre><code>g = seaborn.FacetGrid(tips, col=&quot;time&quot;, row=&quot;smoker&quot;)
g = g.map(plt.hist, &quot;total_bill&quot;)
g.set(ylim=(0, None)) </code></pre>
</div>
<div id="grid-plot" class="section level3">
<h3>Grid plot</h3>
<div id="grid-scatter-plot" class="section level4">
<h4>Grid scatter plot</h4>
<p>Draw a scatter plot for each iris species</p>
<pre><code>g = seaborn.FacetGrid(iris, col=&quot;species&quot;, height=6, width=2)
iris[&#39;species&#39;] = iris[&#39;species&#39;].astype(&#39;category&#39;)
g.map(seaborn.scatterplot,&#39;petal_length&#39;,&#39;petal_width&#39;,&#39;species&#39;)
plt.show()</code></pre>
<p>Notice that if you don’t change the color to a categorical variable, it will not vary across the species. I reported <a href="https://github.com/mwaskom/seaborn/issues/2028">this issue</a>.</p>
</div>
<div id="grid-bar-plot" class="section level4">
<h4>Grid Bar plot</h4>
<p>Draw a facet bar plot <a href="https://stackoverflow.com/a/62225095/2641825">from SO</a> for each combination of size and smoker/non smoker</p>
<pre><code>import seaborn as sns
import matplotlib.pyplot as plt
sns.set()
tips=sns.load_dataset(&quot;tips&quot;)
g = sns.FacetGrid(tips, col = &#39;size&#39;,  row = &#39;smoker&#39;, hue = &#39;day&#39;)
g = (g.map(sns.barplot, &#39;time&#39;, &#39;total_bill&#39;, ci = None).add_legend())
plt.show()</code></pre>
</div>
</div>
<div id="title" class="section level3">
<h3>Title</h3>
<p>Use <code>set_title</code> to add a title:</p>
<pre><code>(seaborn
 .scatterplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)
 .set_title(&#39;Progression of tips along the bill amount&#39;)
)</code></pre>
<p>Set a common title for grid plots</p>
<pre><code>g = seaborn.FacetGrid(tips, col=&quot;time&quot;, row=&quot;smoker&quot;)
g = g.map(plt.hist, &quot;total_bill&quot;)
g.fig.suptitle(&#39;I don&#39;t smoke and I don&#39;t tip.&#39;)</code></pre>
<p>In case the title is overwritten on the subplots, you might need to use <a href="https://stackoverflow.com/a/28650623/2641825">fig.subplot_adjust()</a> as such:</p>
<pre><code>g.fig.subplots_adjust(top=.95)</code></pre>
</div>
<div id="figure-size-1" class="section level3">
<h3>Figure size</h3>
<p>Resize a scatter plot</p>
<pre><code>p = seaborn.scatterplot(&#39;petal_length&#39;,&#39;petal_width&#39;,&#39;species&#39;,data=iris)
p.figure.set_figwidth(15)</code></pre>
<div id="larger-grid-plots" class="section level4">
<h4>Larger grid plots</h4>
<p><code>set_figwidth</code> and <code>set_figheight</code> work well to resize a grid object in its entirety.</p>
<pre><code>g = seaborn.FacetGrid(tips, col=&quot;time&quot;, row=&quot;smoker&quot;)
g = g.map(plt.hist, &quot;total_bill&quot;)
g.fig.set_figwidth(10)
g.fig.set_figheight(10) </code></pre>
<p>Mentioned as a comment under <a href="https://stackoverflow.com/a/56970556/2641825">this answer</a></p>
<p>To change the height and aspect ration of individual grid cells, you can use the <code>height</code> and <code>aspect</code> arguments of the FacetGrid call as such:</p>
<pre><code>import seaborn 
from matplotlib import pyplot
seaborn.set()
iris = seaborn.load_dataset(&quot;iris&quot;)
# Change height and aspect ratio
g = seaborn.FacetGrid(iris, col=&quot;species&quot;, height=8, aspect=0.3)
iris[&#39;species&#39;] = iris[&#39;species&#39;].astype(&#39;category&#39;)
g.map(seaborn.scatterplot,&#39;petal_length&#39;,&#39;petal_width&#39;,&#39;species&#39;)
pyplot.show()</code></pre>
<p><code>help(seaborn.FacetGrid)</code></p>
<blockquote>
<p><code>aspect * height</code> gives the width of each facet in inches.</p>
</blockquote>
</div>
</div>
<div id="scatter-plot" class="section level3">
<h3>Scatter Plot</h3>
<p>Create a scatter plot</p>
<pre><code>import seaborn
import matplotlib.pyplot as plt
tips = seaborn.load_dataset(&quot;tips&quot;)
seaborn.scatterplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)
plt.show()</code></pre>
<p>Group by another variable and show the groups with different colors:</p>
<pre><code>searborn(x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;time&quot;, data=tips)</code></pre>
</div>
</div>
<div id="vega" class="section level2">
<h2>Vega</h2>
<p>The tool tip feature is nice in an interactive notebook.</p>
<ul>
<li>Ipython vega for Jupyter notebooks <a href="https://github.com/vega/ipyvega" class="uri">https://github.com/vega/ipyvega</a></li>
<li>Vega gallery <a href="https://vega.github.io/vega/examples/" class="uri">https://vega.github.io/vega/examples/</a></li>
</ul>
<p>Vega Lite</p>
<ul>
<li><p>Vega lite gallery <a href="https://vega.github.io/vega-lite-v1/examples/" class="uri">https://vega.github.io/vega-lite-v1/examples/</a></p></li>
<li><p>Vega lite documentation on <a href="https://vega.github.io/vega-lite/docs/tooltip.html">tooltips</a></p>
<p>from vega import VegaLite import pandas df = pandas.read_json(‘cars.json’) VegaLite({ “data”: {“url”: “data/cars.json”}, “mark”: {“type”: “point”, “tooltip”: true}, “encoding”: { “x”: {“field”: “Horsepower”,“type”: “quantitative”}, “y”: {“field”: “Miles_per_Gallon”,“type”: “quantitative”} } }, df)</p></li>
</ul>
</div>
</div>
<div id="profiling" class="section level1">
<h1>Profiling</h1>
<p><a href="https://stackoverflow.com/questions/2866380/how-can-i-time-a-code-segment-for-testing-performance-with-pythons-timeit">How can I time a code segment for testing performance with Pythons timeit?</a></p>
<p>Time a function:</p>
<pre><code>import time, timeit
def wait():
    time.sleep(1)
timeit.timeit(wait, number=3)</code></pre>
<blockquote>
<p>“If you are profiling your code and can use IPython, it has the magic function <code>%timeit</code>. <code>%%timeit</code> operates on cells.”</p>
</blockquote>
<pre><code>%timeit wait()</code></pre>
</div>
<div id="r-and-python" class="section level1">
<h1>R and python</h1>
<p>See also the <a href="R.html">R page</a> for more details on R.</p>
<p>Reddit <a href="https://old.reddit.com/r/datascience/comments/67p72w/python_vs_r/">python vs R</a></p>
<blockquote>
<p>“R is for analysis. Python is for production. If you want to do analysis only, use R. If you want to do production only, use Python. If you want to do analysis then production, use Python for both. If you aren’t planning to do production then it’s not worth doing, (unless you’re an academic). Conclusion: Use python.”</p>
</blockquote>
<div id="history" class="section level2">
<h2>History</h2>
<p>The central objects in R are vectors, matrices and data frames, that is why I mostly compare R to the python packages numpy and pandas. R was created almost 20 years before numpy and more than 40 years before pandas.</p>
<p><a href="https://en.wikipedia.org/wiki/R_(programming_language)">R_(programming_language)</a></p>
<blockquote>
<p>“R is an implementation of the S programming language combined with lexical scoping semantics, inspired by Scheme. S was created by John Chambers in 1976 while at Bell Labs. A commercial version of S was offered as S-PLUS starting in 1988.”</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/NumPy#History">NumPy history</a></p>
<blockquote>
<p>“In 1995 the special interest group (SIG) matrix-sig was founded with the aim of defining an array computing package; among its members was Python designer and maintainer Guido van Rossum, who extended Python’s syntax (in particular the indexing syntax) to make array computing easier. […] An implementation of a matrix package was completed by Jim Fulton, then generalized by Jim Hugunin and called Numeric. […] new package called Numarray was written as a more flexible replacement for Numeric. Like Numeric, it too is now deprecated. […] In early 2005, NumPy developer Travis Oliphant wanted to unify the community around a single array package and ported Numarray’s features to Numeric, releasing the result as NumPy 1.0 in 2006.”</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Pandas_(software)#History">Pandas_(software)</a></p>
<blockquote>
<p>“Developer Wes McKinney started working on pandas in 2008 while at AQR Capital Management out of the need for a high performance, flexible tool to perform quantitative analysis on financial data. Before leaving AQR he was able to convince management to allow him to open source the library.”</p>
</blockquote>
<p><a href="https://jrvcomputing.wordpress.com/2016/11/14/migrating-from-r-to-python/">Migrating from R to python</a></p>
<blockquote>
<p>“Python is a full fledge programming language but it is missing statistical and plotting libraries. Vectors are an after thought in python most functionality can be reproduced using operator overloading, but some functionality looks clumsy.”</p>
</blockquote>
</div>
<div id="numpy-and-r" class="section level2">
<h2>Numpy and R</h2>
<p>R session showing a division by zero returning an infinite value.</p>
<pre><code>&gt; 1/0
[1] Inf</code></pre>
<p>Python session showing a division by zero error for normal integer division and the same operation on a numpy array returning an infinite value with a warning.</p>
<pre><code>In [1]: 1/0
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
&lt;ipython-input-1-9e1622b385b6&gt; in &lt;module&gt;
----&gt; 1 1/0

ZeroDivisionError: division by zero

In [2]: import numpy as np

In [3]: np.array([1]) / 0
/home/paul/.local/bin/ipython:1: RuntimeWarning: divide by zero encountered in true_divide
  #!/usr/bin/python3
Out[3]: array([inf])</code></pre>
</div>
<div id="pandas-comparison-with-r" class="section level2">
<h2>Pandas comparison with R</h2>
<p>R data frame to be used for examples:</p>
<pre><code>df = data.frame(x = 1:3, y = c(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;), stringsAsFactors = FALSE)</code></pre>
<p>Pandas data frame to be used for examples:</p>
<pre><code>import pandas
df = pandas.DataFrame({&#39;x&#39; : [1,2,3], &#39;y&#39; : [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]})</code></pre>
<table>
<colgroup>
<col width="25%" />
<col width="27%" />
<col width="47%" />
</colgroup>
<thead>
<tr class="header">
<th>Base R</th>
<th>pandas</th>
<th>SO questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>df[df$y %in% c('a','b'),]</code></td>
<td><code>df[df['y'].isin(['a','b'])]</code></td>
<td><a href="https://stackoverflow.com/questions/12096252/use-a-list-of-values-to-select-rows-from-a-pandas-dataframe">list of values to select a row</a></td>
</tr>
<tr class="even">
<td><code>dput(df)</code></td>
<td><code>df.to_dict()</code></td>
<td><a href="https://stackoverflow.com/questions/47450931/print-pandas-data-frame-for-reproducible-example-equivalent-to-dput-in-r">Print pandas data frame for reproducible example</a></td>
</tr>
<tr class="odd">
<td><code>expand.grid(df$x,df$y)</code></td>
<td><code>itertools.product</code></td>
<td>see section below</td>
</tr>
<tr class="even">
<td><code>ifelse</code></td>
<td><code>df.where()</code></td>
<td>[ifelse in pandas]</td>
</tr>
<tr class="odd">
<td><code>gsub</code></td>
<td><code>replace(regex=True)</code></td>
<td><a href="https://stackoverflow.com/questions/21834293/equivalent-of-gsub-for-pandas-series-dataframe/56547104?noredirect=1#comment99677847_56547104">gsub in pandas</a></td>
</tr>
<tr class="even">
<td><code>length(df)</code> and <code>dim(df)</code></td>
<td><code>df.shape</code></td>
<td><a href="https://stackoverflow.com/questions/15943769/how-do-i-get-the-row-count-of-a-pandas-dataframe">row count of a data frame</a></td>
</tr>
<tr class="odd">
<td><code>rbind</code></td>
<td><code>pandas.concat</code></td>
<td><a href="https://stackoverflow.com/questions/14988480/pandas-version-of-rbind">Pandas version of rbind</a></td>
</tr>
<tr class="even">
<td><code>seq(1:5)</code></td>
<td><code>np.array(range(0,5))</code></td>
<td><a href="https://stackoverflow.com/a/60753578/2641825">numpy function to generate sequences</a></td>
</tr>
<tr class="odd">
<td><code>summary</code></td>
<td><code>describe</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>str</code></td>
<td><code>df.info()</code></td>
<td><a href="https://stackoverflow.com/questions/27637281/what-are-python-pandas-equivalents-for-r-functions-like-str-summary-and-he">pandas equivalents for R functions like str summary and head</a></td>
</tr>
</tbody>
</table>
<p><a href="https://stackoverflow.com/questions/43391591/if-else-function-in-pandas-dataframe">ifelse in pandas</a></p>
<p>The mapping of tidyverse to pandas is:</p>
<table>
<colgroup>
<col width="24%" />
<col width="47%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th>tidyverse</th>
<th>pandas</th>
<th>Help or SO questions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>arrange</td>
<td>sort_values</td>
<td></td>
</tr>
<tr class="even">
<td>df %&gt;% select(-a,-b)</td>
<td>df.drop(columns=[‘a’, ‘b’])</td>
<td></td>
</tr>
<tr class="odd">
<td>select(a)</td>
<td>df.filter(items=[‘a’])</td>
<td></td>
</tr>
<tr class="even">
<td>select(contains(“a”))</td>
<td>df.filter(regex=‘a’)</td>
<td></td>
</tr>
<tr class="odd">
<td>filter</td>
<td>query</td>
<td></td>
</tr>
<tr class="even">
<td>group_by</td>
<td>groupby</td>
<td></td>
</tr>
<tr class="odd">
<td>lag</td>
<td><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.shift.html">shift</a></td>
<td><a href="https://stackoverflow.com/questions/23664877/pandas-equivalent-of-oracle-lead-lag-function">pandas lag function</a></td>
</tr>
<tr class="even">
<td>mutate</td>
<td>df.assign(e = lambda x: x[“a”] * 3)</td>
<td><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html">assign</a></td>
</tr>
<tr class="odd">
<td>pivot_longer</td>
<td><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html">melt</a> or <a href="https://pandas.pydata.org/docs/reference/api/pandas.wide_to_long.html">wide_to_long</a></td>
<td></td>
</tr>
<tr class="even">
<td>pivot_wider</td>
<td><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot.html">pivot</a></td>
<td></td>
</tr>
<tr class="odd">
<td>rename</td>
<td>df.rename(columns={‘a’:‘new’})</td>
<td></td>
</tr>
<tr class="even">
<td>separate</td>
<td>df[‘b’], df[‘c’] = df[‘a’].str.split(‘,’, 1).str</td>
<td><a href="https://stackoverflow.com/a/57823566">pandas separate</a></td>
</tr>
<tr class="odd">
<td>summarize</td>
<td>agg</td>
<td></td>
</tr>
<tr class="even">
<td>unite</td>
<td>df[“z”] = df.y + df.y</td>
<td><a href="https://stackoverflow.com/questions/19377969/combine-two-columns-of-text-in-pandas-dataframe">pandas unite</a></td>
</tr>
<tr class="odd">
<td>unnest</td>
<td><a href="https://pandas.pydata.org/pandas-docs/version/0.25/reference/api/pandas.DataFrame.explode.html">explode</a></td>
<td><a href="https://stackoverflow.com/a/53218939/2641825">unnest in pandas</a></td>
</tr>
</tbody>
</table>
<p>Methods to use inside the .groupby().agg() method:</p>
<ul>
<li><code>sum</code></li>
<li><code>count</code></li>
<li><code>mean</code></li>
<li><code>', '.join</code> <a href="https://stackoverflow.com/questions/17841149/pandas-groupby-how-to-get-a-union-of-strings">to get a union of strings</a></li>
</ul>
<div id="expand-grid-in-pandas" class="section level3">
<h3>Expand grid in pandas</h3>
<p>This <a href="https://stackoverflow.com/a/60371544/2641825">SO answer</a> provides an implementation of expand grid using itertools:</p>
<pre><code>import itertools
import pandas
countries = self.by_country_year[&#39;country&#39;].drop_duplicates()
years = range(1990, datetime.now().year)
expand_grid = list(itertools.product(countries, years))
df = pandas.DataFrame(expand_grid, columns=(&#39;country&#39;, &#39;year&#39;))</code></pre>
<p>Another <a href="https://stackoverflow.com/a/64449660/2641825">SO answer on the same topic</a></p>
</div>
<div id="blogs-and-quotes-on-pandas-and-r" class="section level3">
<h3>Blogs and quotes on Pandas and R</h3>
<ul>
<li>pandas.pydata.org <a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/comparison/comparison_with_r.html">Comparison with R</a></li>
<li><a href="https://stmorse.github.io/journal/tidyverse-style-pandas.html">Tydiverse style pandas</a></li>
</ul>
<blockquote>
<p>“Tidyverse allows a mix of quoted and unquoted references to variable names. In my (in)experience, the convenience this brings is accompanied by equal consternation. It seems to me a lot of the problems solved by tidyeval would not exist if all variables were quoted all the time, as in pandas, but there are likely deeper truths I’m missing here…”</p>
</blockquote>
<p>Help of the R function unite from the tidyr package:</p>
<blockquote>
<p>“col: The name of the new column, as a string or symbol. This argument is passed by expression and supports quasiquotation (you can unquote strings and symbols). The name is captured from the expression with ‘rlang::ensym()’ (note that <strong>this kind of interface where symbols do not represent actual objects is now discouraged</strong> in the tidyverse; we support it here for backward compatibility).”</p>
</blockquote>
<p>The use of symbols which do not represent actual objects was was frustrating at first when using pandas, because we hat to use df[“x”] to assign vectors to new column names whereas we could use df.x to display them.</p>
</div>
</div>
<div id="personal-reflection" class="section level2">
<h2>Personal reflection</h2>
<p>R is great for statistical analysis and plotting. You can also use it to elaborate a pipeline to load data, prepare it and analyse it. But when things start to get complicated, such as loading json data from APIs, or dealing with http requests issues, or understanding lazy evaluation, or the consequences of non standard evaluation, moving down the rabbit whole can get really complicated with R. The rabbit hole slide is smoother with python. I have the feeling that I keep a certain level of understanding at all steps. It’s just a matter of taste anyway.</p>
<p>The Python language can be more verbose on some aspects, but it allows for greater programmability, it is also more predictable because non standard evaluation doesn’t create scoping problems and it enables to dive deeper into input/output issues such as URL request headers for example. R remains very good for data exploration, statistical analysis and plotting because non standard evaluation makes it possible to call variables without quotes and to pass formulas to plotting and estimation functions.</p>
<p>I see R more like the bash command line. It’s great for scripts, but you wouldn’t want to write large applications in bash.</p>
<p>Non standard evaluation doesn’t exist in python. - An email thread discussing <a href="https://www.mail-archive.com/python-ideas@python.org/msg15694.html">the idea of non standard evaluation in python</a>. - A <a href="https://third-bit.com/2018/11/16/non-standard-evaluation/">comparison of a python implementation and an R implementation using non standard evaluation</a>.</p>
</div>
</div>
<div id="string" class="section level1">
<h1>String</h1>
<p>See also string operations in pandas vectors.</p>
<p><a href="https://stackoverflow.com/questions/25675943/how-can-i-concatenate-str-and-int-objects">SO answer</a> providing various ways to concatenate python strings.</p>
<div id="string-formatting" class="section level2">
<h2>String formatting</h2>
<p><a href="https://stackoverflow.com/a/10742904/2641825">How to print number with commas as thousands separators?</a></p>
<pre><code>f&#39;{1e6:,}&#39; </code></pre>
</div>
<div id="regex-substitution" class="section level2">
<h2>Regex substitution</h2>
<p><a href="https://docs.python.org/3/library/re.html">Documentation of the re package</a>.</p>
<p>Replace one or more consecutive non alphanumeric characters by an underscore.</p>
<pre><code>re.sub(r&#39;\W+&#39;, &#39;_&#39;, &#39;bla: bla**(bla)&#39;)</code></pre>
<p>Insert a suffix in a file name before the extension <a href="https://stackoverflow.com/a/2763772/2641825">SO anwser</a></p>
<pre><code>import re
re.sub(r&#39;(?:_a)?(\.[^\.]*)$&#39; , r&#39;_suff\1&#39;,&quot;long.file.name.jpg&quot;)</code></pre>
</div>
</div>
<div id="statistics" class="section level1">
<h1>Statistics</h1>
<div id="linear-programming-solvers" class="section level2">
<h2>Linear programming solvers</h2>
<p>Real Python <a href="https://realpython.com/linear-programming-python/#what-is-linear-programming">What is linear programing</a></p>
<blockquote>
<p>Several free Python libraries are specialized to interact with linear or mixed-integer linear programming solvers:</p>
</blockquote>
<p><a href="https://docs.scipy.org/doc/scipy/reference/optimize.html">SciPy Optimization and Root Finding</a></p>
<p><a href="https://www.coin-or.org/PuLP/solvers.html">PuLP</a></p>
<p><a href="https://pyomo.readthedocs.io/en/stable/solving_pyomo_models.html#supported-solvers">Pyomo</a></p>
<p><a href="https://cvxopt.org/userguide/coneprog.html#optional-solvers">CVXOPT</a></p>
</div>
<div id="scaling" class="section level2">
<h2>Scaling</h2>
<p><a href="http://benalexkeen.com/feature-scaling-with-scikit-learn/">Feature scaling with scikit learn</a></p>
<ul>
<li>StandardScaler</li>
<li>MinMaxScaler</li>
<li>RobustScaler</li>
<li>Normalizer</li>
</ul>
</div>
</div>
<div id="style-guide-and-linter" class="section level1">
<h1>Style guide and linter</h1>
<div id="black" class="section level2">
<h2>Black</h2>
<p><a href="https://github.com/psf/black">Black</a> is “the uncompromising Python code formater”</p>
<p>Run <code>black</code> as a pre commit hook with <code>pre-commit</code> as explained below.</p>
</div>
<div id="flake-8" class="section level2">
<h2>Flake 8</h2>
<p>Flake 8 looks at more than just formatting.</p>
<p><a href="https://pypi.org/project/flake8/1.6.1/#warning-error-codes">List of FLake8 warnings and error codes</a></p>
</div>
<div id="pre-commit-hooks" class="section level2">
<h2>Pre commit hooks</h2>
<p>Blog:</p>
<ul>
<li><a href="https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/">pre commits using black and flake8</a></li>
</ul>
<div id="install-pre-commit-hooks" class="section level3">
<h3>Install pre commit hooks</h3>
<p>Install <code>pre-commit</code></p>
<pre><code>pip install pre-commit</code></pre>
<p>Set up <code>pre-commit</code> in a repository</p>
<pre><code>cd path_to_repository
# Add the &quot;pre-commit&quot; python module to a requirements file
vim requirements.txt 
# Create a configuration file
vim .pre-commit-config.yaml </code></pre>
<p>Configuration options such as</p>
<pre><code>repos:
-   repo: https://github.com/ambv/black
    rev: 21.6b0
    hooks:
    - id: black
      language_version: python3.7
-   repo: https://gitlab.com/pycqa/flake8
    rev: 3.7.9
    hooks:
    - id: flake8</code></pre>
<p>Update <a href="https://pre-commit.com/#using-the-latest-version-for-a-repository">hook repositories to the latest version</a></p>
<pre><code>pre-commit autoupdate</code></pre>
<p>Install git hooks in your .git/ directory.</p>
<pre><code>pre-commit install</code></pre>
</div>
<div id="usage-in-continuous-integration" class="section level3">
<h3>Usage in Continuous integration</h3>
<p><a href="https://pre-commit.com/#usage-in-continuous-integration">Usage in Continuous integration</a> has a gitlab example:</p>
<pre><code>    my_job:
      variables:
        PRE_COMMIT_HOME: ${CI_PROJECT_DIR}/.cache/pre-commit
      cache:
        paths:
          - ${PRE_COMMIT_HOME}</code></pre>
</div>
<div id="un-install-pre-commit-hooks" class="section level3">
<h3>Un install pre-commit hooks</h3>
<p>Uninstall</p>
<pre><code>pre-commit uninstall</code></pre>
</div>
</div>
<div id="pylint" class="section level2">
<h2>Pylint</h2>
<p>Edit the configuration file</p>
<pre><code>vim ~/.pylintrc</code></pre>
<p>List of good names that shouldn’t give a “short name” warning</p>
<pre><code>[pylint]
good-names=df</code></pre>
<p>Generate a configuration file</p>
<pre><code>pylint --generate-rcfile</code></pre>
<p>Blog</p>
<ul>
<li>Reddit <a href="https://www.reddit.com/r/Python/comments/82hgzm/any_advantages_of_flake8_over_pylint/">Any advantages of Flake8 over PyLint</a> some answers suggest keeping both.</li>
</ul>
<div id="dangerous-default-argument" class="section level3">
<h3>Dangerous default argument</h3>
<ul>
<li>[SO answer][<a href="https://stackoverflow.com/questions/101268/hidden-features-of-python#113198" class="uri">https://stackoverflow.com/questions/101268/hidden-features-of-python#113198</a>)</li>
<li><a href="https://github.com/PyCQA/pylint/issues/3642">pylint issues</a></li>
</ul>
<blockquote>
<p>I understand the dangerous of using a mutable default value and I suggest switching the warning message for something like “Dangerous mutable default value as argument”. However, this is dangerous for all sorts of scenarios? (I know that pylint isn’t supposed to check the functionality of my code, just trying to clarify this anti-pattern)</p>
</blockquote>
<pre><code>&gt;&gt;&gt; def find(_filter={&#39;_id&#39;: 0}):
...     print({**find.__defaults__[0], **_filter})
...
&gt;&gt;&gt; find()
{&#39;_id&#39;: 0}
&gt;&gt;&gt; find({&#39;a&#39;: 1})
{&#39;_id&#39;: 0, &#39;a&#39;: 1}
&gt;&gt;&gt; find()
{&#39;_id&#39;: 0}
&gt;&gt;&gt; find({&#39;a&#39;: 1, &#39;b&#39;: 2})
{&#39;_id&#39;: 0, &#39;a&#39;: 1, &#39;b&#39;: 2}</code></pre>
<blockquote>
<p>One might argue that the following should be used and I tend to agree:</p>
</blockquote>
<pre><code>&gt;&gt;&gt; def find(_filter=None):
...     if _filter is None:
...             _filter = {&#39;_id&#39;: 0}
...     else:
...             _filter[&#39;_id&#39;] = 0
...     print(_filter)
...
&gt;&gt;&gt; find()
{&#39;_id&#39;: 0}
&gt;&gt;&gt; find({&#39;a&#39;: 1})
{&#39;a&#39;: 1, &#39;_id&#39;: 0}
&gt;&gt;&gt; find()
{&#39;_id&#39;: 0}
&gt;&gt;&gt; find({&#39;a&#39;: 1, &#39;b&#39;: 2})
{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;_id&#39;: 0}</code></pre>
</div>
<div id="using-with-for-resource-allocation" class="section level3">
<h3>Using with for resource allocation</h3>
<p>Pylint message</p>
<blockquote>
<p>Consider using ‘with’ for resource-allocating operations</p>
</blockquote>
<p>Explained in a <a href="https://stackoverflow.com/a/67419279/2641825">SO answer</a></p>
<blockquote>
<p>suppose you are opening a file:</p>
</blockquote>
<pre><code>file_handle = open(&quot;some_file.txt&quot;, &quot;r&quot;)
...
...
file_handle.close()</code></pre>
<blockquote>
<p>You need to close that file manually after required task is done. If it’s not closed, then resource (memory/buffer in this case) is wasted. If you use <code>with</code> in the above example:</p>
</blockquote>
<pre><code>with open(&quot;some_file.txt&quot;, &quot;r&quot;) as file_handle:
    ...
    ...</code></pre>
<blockquote>
<p>there is no need to close that file. Resource de-allocation automatically happens when you use with.</p>
</blockquote>
</div>
</div>
</div>
<div id="system-information" class="section level1">
<h1>System information</h1>
<p>Platform type</p>
<pre><code>import sys
sys.platform</code></pre>
<p>or</p>
<pre><code>import os
os.name</code></pre>
<p>Sys and os return different results ‘linux’ or ‘posix’.</p>
<p>More details are given by</p>
<pre><code>os.uname()</code></pre>
<div id="memory" class="section level2">
<h2>Memory</h2>
<p>Sometimes when a python process runs out of memory, it can get killed by the Linux Kernel. In that case the error message is short “killed” and there is no python trace back printed. You can check that it is indeed a memory error by calling</p>
<pre><code>sudo dmesg</code></pre>
<p>Here is a typical message:</p>
<pre><code>[85962.510533] Out of memory: Kill process 16035 (ipython3) score 320 or sacrifice child
[85962.510554] Killed process 16035 (ipython3) total-vm:7081812kB, anon-rss:4536336kB, file-rss:0kB, shmem-rss:8kB
[85962.687468] oom_reaper: reaped process 16035 (ipython3), now anon-rss:0kB, file-rss:0kB, shmem-rss:8kB</code></pre>
<p>Various related Stack Overflow questions <a href="https://stackoverflow.com/questions/19189522/what-does-killed-mean-when-a-processing-of-a-huge-csv-with-python-which-sudde">what does “kill” mean</a>, <a href="https://stackoverflow.com/questions/47408608/how-can-i-find-the-reason-that-python-script-is-killed">How can I find the reason that python script is killed?</a>, <a href="https://stackoverflow.com/questions/1811173/why-does-my-python-script-randomly-get-killed">Why does python script randomly gets killed?</a>.</p>
</div>
</div>
<div id="test-driven-development" class="section level1">
<h1>Test driven development</h1>
<p>A good post about TDD <a href="https://medium.com/@Cyrdup/unit-testing-youre-doing-it-wrong-407a07692989">Unit testing your doing it wrong</a></p>
<blockquote>
<p>“TDD is actually about every form of tests. For example, I often write performance tests as part of my TDD routine; end-to-end tests as well. Furthermore, this is about behaviours, not implementation: you write a new test when you need to fulfil a requirement. You do not write a test when you need to code a new class or a new method. Subtle, but important nuance. For example, you should not write a new test just because you refactored the code. If you have to, it means you were not really doing TDD.” […] “Good tests must test a behavior in isolation to other tests. Calling them unit, system or integration has no relevance to this. Kent Beck says this much better than I would ever do. ’‘’From this perspective, the integration/unit test frontier is a frontier of design, not of tools or frameworks or how long tests run or how many lines of code we wrote get executed while running the test.’’’ Kent Beck”</p>
</blockquote>
<div id="unit-tests" class="section level2">
<h2>Unit tests</h2>
<p>See <a href="https://github.com/okken/markdown.py/blob/master/test_markdown_unittest.py">python markdown unit tests</a></p>
</div>
<div id="pytest" class="section level2">
<h2>pytest</h2>
<p>Numpy moved from nose to pytest in their, as explained in their <a href="https://docs.scipy.org/doc/numpy/reference/testing.html">testing guidelines</a>:</p>
<blockquote>
<p>“Until the 1.15 release, NumPy used the nose testing framework, it now uses the pytest framework. The older framework is still maintained in order to support downstream projects that use the old numpy framework, but all tests for NumPy should use pytest.”</p>
</blockquote>
<p>Save this function in a file names test_numpy.py</p>
<pre><code>def test_numpy_closeness():
    assert [1,2] == [1,2]
    assert (np.array([1,2]) == np.array([1,2])).all()
    np.testing.assert_allclose(np.array([1,2]),np.array([1,3]))</code></pre>
<p>Save the file to test_nn.py</p>
<pre><code>import neural_nets as nn
import numpy as np

def test_rectified_linear_unit():
    x = np.array([[1,0],
                  [-1,-3]])
    expected = np.array([[1,0],
                         [0,0]])
    provided = nn.rectified_linear_unit(x)
    assert np.allclose(expected, provided), &quot;test failed&quot;</code></pre>
<p>Execute the test suite from bash with py.test as follows:</p>
<pre><code>cd ~/rp/course_machine_learning/projects/project_2_3_mnist/part2-nn
py.test</code></pre>
<p>Test pandas data frame with</p>
<pre><code>assert_frame_equal
assert_series_equal # tricky to use</code></pre>
</div>
</div>
<div id="web-frameworks" class="section level1">
<h1>Web Frameworks</h1>
<p><a href="asynchrosnus://www.codementor.io/garethdwyer/flask-vs-django-why-flask-might-be-better-4xs7mdf8v">Flask vs. Django</a></p>
<p>Note: <a href="http://pgjones.gitlab.io/quart/flask_evolution.html#flask-evolution">Flask Evolution into Quart</a> to support <a href="http://pgjones.gitlab.io/quart/asyncio.html#asyncio">asyncio</a> This last link contains a nice, simple example of how asyncio works with a simulated delay to fetch a web page.</p>
</div>
<div id="media" class="section level1">
<h1>Media</h1>
<p>Podcast <a href="https://talkpython.fm/">talk python to me</a> * <a href="https://talkpython.fm/episodes/show/193/data-science-year-in-review-2018-edition">Data science year in review</a></p>
<div id="blogs" class="section level2">
<h2>Blogs</h2>
<ul>
<li><p><a href="https://blog.juliobiason.me/thoughts/things-i-learnt-the-hard-way/">Things I Learnt The Hard Way (in 30 Years of Software Development)</a></p></li>
<li><p><a href="https://lemire.me/blog/2016/06/21/i-do-not-use-a-debugger/">I do not use a debugger</a> &gt;““Debuggers don’t remove bugs. They only show them in slow motion.” <a href="https://lwn.net/2000/0914/a/lt-debugger.php3">Linus Toarvald doesn’t use a debugger</a></p></li>
<li><p>Dotan Nahum <a href="https://jondot.medium.com/functional-programming-with-python-for-people-without-time-1eebdbd9526c">Functional Programming with Python for People Without Time</a></p></li>
</ul>
<blockquote>
<p>“Cracks in the Ice - We ended the previous part with stating that with a good measure of abstraction, functional programming doesn’t offer a considerable advantage over the “traditional” way of design, object oriented. It’s a lie. […] In our pipeline example above with our Executors — how do you feed in the output of one executor as the input for the next one? well, you have to build that infrastructure. With functional programming, those abstractions are not abstractions that you have to custom build. They’re part of the language, mindset, and ecosystem. Generically speaking — it’s all about impedence mismatch and leaky abstractions and when it comes to data and functions; there’s no mismatch because it’s built up from the core. The thesis is — that to build a functional programming approach over an object-oriented playground — is going to crash and burn at one point or another: be it bad modeling of abstractions, performance problems, bad developer ergonomics, and the worst — wrong mindset. Being able to model problems and solutions in a functional way, transcends above traditional abstraction; the object-oriented approach, in comparison, is crude, inefficient and prone to maintenance problems."</p>
</blockquote>
<ul>
<li><a href="https://www.stochasticlifestyle.com/why-numba-and-cython-are-not-substitutes-for-julia/">Why numba and cython are no substitute for Julia</a> discusses the advantages of the Julia language over Python for large code bases.</li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
