<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Git Commands</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Paul Rougieux</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Tools
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="bash.html">Bash</a>
    </li>
    <li>
      <a href="communication.html">Communication</a>
    </li>
    <li>
      <a href="debian.html">Debian</a>
    </li>
    <li>
      <a href="docker.html">Docker</a>
    </li>
    <li>
      <a href="git.html">Git</a>
    </li>
    <li>
      <a href="lyx.html">Lyx</a>
    </li>
    <li>
      <a href="mysql.html">MySQL</a>
    </li>
    <li>
      <a href="postgresql.html">PostgreSQL</a>
    </li>
    <li>
      <a href="publish.html">Publish</a>
    </li>
    <li>
      <a href="python.html">Python</a>
    </li>
    <li>
      <a href="R.html">R</a>
    </li>
    <li>
      <a href="vim.html">Vim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-microchip"></span>
     
    Algos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="carbon_budget_model.html">Carbon Budget Model</a>
    </li>
    <li>
      <a href="musical_scales.html">Musical scales</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-line-chart"></span>
     
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="explore.html">Explore</a>
    </li>
    <li>
      <a href="datasources.html">Sources</a>
    </li>
  </ul>
</li>
<li>
  <a href="events.html">
    <span class="fa fa-users"></span>
     
    Events
  </a>
</li>
<li>
  <a href="publications.html">
    <span class="fa fa-book"></span>
     
    Publications
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Git Commands</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This page is the continuation of <a
href="https://paulremote.blogspot.de/2013/10/git-commands.html">my blog
post on git commands</a>.</p>
<p>My typical git use consists in archiving file modifications for
personal projects. Sometimes I share these projects with a colleague. We
are then 2 persons working concurrently on the same project, pushing and
pulling changes several times per day.</p>
<div id="simple-workflow-for-one-user" class="section level2">
<h2>Simple workflow for one user</h2>
<p>We suppose someone has helped you initialise a git repository. Before
you modify files, get the latest version of files from the remote
repository:</p>
<pre><code>git pull</code></pre>
<p>Work and modify files in the folder. At some point, when your work
has reached a certain status, you might want to archive it before you
move on to something else. The few commands below tell git to archive
the work.</p>
<p>Show which files have been modified in the folder under git
control:</p>
<pre><code>git status</code></pre>
<p>Add a file to be committed</p>
<pre><code>git add filename</code></pre>
<p>Or add all files:</p>
<pre><code>git add --all</code></pre>
<p>Note: you might use a graphical git client with check boxes to add
the files to be committed. Commit and describe changes</p>
<pre><code>git commit -m &quot;describe changes made to those files&quot;</code></pre>
<p>Now you can continue working and changing files. Repeat the
<code>git add --all</code> and
<code>git commit -m "describe changes"</code> each time your reach a
consistant change status. Before you leave your computer, push the
content to the remote repository with:</p>
<pre><code>git push</code></pre>
<p>In case you work with other people on this remote repository, Before
you push, you might want to integrate work done by others in your
repository. If any new work has been added by others on the remote
repository, git will ask you to first do:</p>
<pre><code>git pull </code></pre>
<p>and then:</p>
<pre><code>git push</code></pre>
<p>This simple work flow works well for one user pulling from- and
pushing to- a master branch on a remote repository.</p>
<p>Sometimes the vi editor starts. To exit the vi editor:</p>
<pre><code>ESC:q!</code></pre>
</div>
<div id="workflow-with-branches" class="section level2">
<h2>Workflow with branches</h2>
<p>Initialise a new repository</p>
<pre><code>git init</code></pre>
<p>Change to the development branch</p>
<pre><code># If the branch doesn&#39;t exist, create it first.
git branch develop
git checkout develop</code></pre>
<p>Work and modify files in the folder. At some point, when your work
has reached a certain status, you might want to archive it before you
move on to something else. The few commands below tell git to archive
the work. All file modifications will be archived with a commit hash
which is a unique key describing your changes. The most important part
is entering a commit message, it should be sufficiently general to
describe your changes with a high level of abstraction and sufficiently
specific to be understood amoung all other changes later.</p>
<p>First show which files have been modified in the folder under git
control:</p>
<pre><code>git status</code></pre>
<p>Add a file to be committed</p>
<pre><code>git add filename
# Add all files
git add --all</code></pre>
<p>Commit and describe changes</p>
<pre><code>git commit -m &quot;describe changes made to those files&quot;</code></pre>
<p>Now you can continue working and changing files. Repeat the
<code>git add --all</code> and
<code>git commit -m "describe changes"</code> each time your reach a
consistant change status.</p>
<p>At some point you will be ready to upload your content to a remote
archive. Merge to the master branch</p>
<pre><code>git checkout master
git merge develop</code></pre>
<p>Push contents to the remote repository</p>
<pre><code>git push</code></pre>
<p>See below how to set-up the remote repository with
<code>git remote add origin ssh:repositoryurl</code> and pushing content
for the first time with <code>git push -u origin master</code>.</p>
<p>Check status again</p>
<pre><code>git status</code></pre>
<p>Go back to the development branch</p>
<pre><code>git checkout develop</code></pre>
<p>Continue to modify files in the repository.</p>
</div>
</div>
<div id="add-and-commit" class="section level1">
<h1>Add and commit</h1>
<div id="add-patterns" class="section level2">
<h2>Add patterns</h2>
<p>Add modified markdown files to the next git commit</p>
<pre><code>git add *.md</code></pre>
<p>The star * is a <a
href="https://git-scm.com/docs/git-add#Documentation/git-add.txt-ltpathspecgt82308203">file
glob pattern</a> that matches all other path components in between.</p>
</div>
<div id="commit-messages" class="section level2">
<h2>Commit messages</h2>
<p>Commit messages descripe at a high level what has been changed in the
code.</p>
<p>On <a
href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/">the
linux kernel repository</a> commit messages start with a capital letter
and do not have a dot at the end. This style is also what is written in
the <a href="https://style.tidyverse.org/gitgithub.html">tidyverse style
guide</a>.</p>
<p>Example of a long commit message (like a letter) torvalds/uemacs <a
href="https://github.com/torvalds/uemacs/commit/fa00fe882f719351fdf7a4c4100baf4f3eab4d61">Stop
using ‘short’ for line and allocation sizes</a>.</p>
<p>Extract:</p>
<blockquote>
<p>“I really should just learn another editor, rather than continue to
polish this turd.”</p>
</blockquote>
<p>Add minor changes to the previous commit (git commit –amend):</p>
<pre><code>git commit --amend</code></pre>
</div>
</div>
<div id="autocompletion" class="section level1">
<h1>Autocompletion</h1>
<p>git has an <a
href="https://git-scm.com/book/en/v1/Git-Basics-Tips-and-Tricks#Auto-Completion">auto
complete</a> feature available in a script:
<code>git-completion.bash</code>.</p>
<p>That script can be loaded in bashrc at the start of the shell. A
debian package was made to simply load git-completion.bash for you:</p>
<pre><code>sudo apt install bash-completion</code></pre>
</div>
<div id="branching" class="section level1">
<h1>Branching</h1>
<p>To start work in a new branch:</p>
<pre><code>git branch new_branch_name
git checkout new_branch_name</code></pre>
<p>To compare a file between 2 branches:</p>
<pre><code>git diff branch1 branch2 file_name</code></pre>
<p>To compare the tip of 2 branches</p>
<pre><code>git diff branch1..branch2</code></pre>
<p>To merge changes back to the main branch:</p>
<pre><code>git checkout main

git merge branch1</code></pre>
<p>If there were conflicts, they will be presented in this way:</p>
<pre><code>&quot;The area where a pair of conflicting changes happened is marked with
markers &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;, =======, and
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;. The part before the ======= is typically your
side, and the part afterwards is typically their side.&quot;</code></pre>
<p>If I am on a detached head, it is recommended to create a temporary
branch (stackoverflow).</p>
<pre><code>git branch temp

git checkout temp

git add -a

git  commit -m &quot;description of changes&quot;

git checkout main

git merge temp</code></pre>
<p>Delete uncommitted changes in current working directory:</p>
<pre><code>git checkout branch_name .</code></pre>
<p>See also below git clean.</p>
<div id="branching-strategy" class="section level2">
<h2>Branching strategy</h2>
<p>For solo projects, I use to have this branching strategy:</p>
<blockquote>
<p>I never work in the master branch, always in a development branch
called <code>develop</code>. I merge <code>develop</code> in
<code>master</code>, only before pushing modifications back to my remote
archive. This simple branching strategy makes it much easier to deal
with potential changes in the remote master branch.</p>
</blockquote>
<p>But I have now changed to a simpler strategy where I work only on the
master branch.</p>
<p>For collaborative projects, we use feature branches or also a dev and
a main branch.</p>
</div>
<div id="delete-a-branch" class="section level2">
<h2>Delete a branch</h2>
<p>I might need to delete a branch at some point:</p>
<pre><code>git branch -d branch_name </code></pre>
<p>Delete a remote branch</p>
<pre><code>git push --delete origin branch_name</code></pre>
<p>Check if a branch has been merged before deleting it</p>
<p>git merge-base main compare</p>
<p>Will return the latest common commit between the 2 branches.</p>
</div>
<div id="merge-branches" class="section level2">
<h2>Merge branches</h2>
<p>To merge <code>branch1</code> changes to the <code>main</code>
branch:</p>
<pre><code>git checkout main

git merge branch1</code></pre>
<p>In case of conflict, you can edit the corresponding file(s) manually
in a text editor, or you can decide to keep one of the 2 versions by
checking out. For example if you are in the <code>main</code> branch</p>
<pre><code>git checkout --ours &lt;filename&gt;</code></pre>
<p>will get the file as it is in the main branch, while</p>
<pre><code>git checkout --theirs &lt;filename&gt;</code></pre>
<p>will get the file as it is in <code>branch1</code>. And vice-versa if
you are currently in a feature branch
<code>git checkout --ours &lt;filename&gt;</code> will get the file as
it is in the feature branch.</p>
</div>
<div id="checkout-a-remote-branch" class="section level2">
<h2>Checkout a remote branch</h2>
<p>When you fetch a remote repository, you get all its branches. The
remote branches can be viewed with:</p>
<pre><code>git branch -r</code></pre>
<p>If there is only one branch with that name, you can simply do
(without the remote prefix, only the branch name):</p>
<pre><code>git checkout &lt;branch name&gt;</code></pre>
<p>To create a local branch that tracks the remote branch. You’ll be
able to make changes to that local branch and push them to the remote
branch later.</p>
</div>
</div>
<div id="configuring-git" class="section level1">
<h1>Configuring git</h1>
<div id="configuring-user-name-and-email" class="section level2">
<h2>Configuring user name and email</h2>
<p>Display your user name, email and remote repositories</p>
<pre><code>git config -l</code></pre>
<p>To change username and email globally</p>
<pre><code>git config --global user.name &quot;Your Name&quot; 

git config --global user.email you@example.com</code></pre>
<p>Stackoverflow <a
href="https://stackoverflow.com/a/9063238/2641825">git multiple user
names for different projects</a> explains how to change the email for
the current repository only</p>
<pre><code>git config user.email personal@example.org</code></pre>
</div>
<div id="other-config-global-options" class="section level2">
<h2>Other config –global options</h2>
<p><a href="https://stackoverflow.com/a/2596835/2641825">How do I make
Git use the editor of my choice for commits?</a></p>
<pre><code>git config --global core.editor &quot;vim&quot;</code></pre>
<p>Edit the global configuration file</p>
<pre><code>git config --global --edit</code></pre>
</div>
<div id="remembering-passwords" class="section level2">
<h2>Remembering passwords</h2>
<p><a
href="https://stackoverflow.com/questions/35942754/how-to-save-username-and-password-in-git">How
to save user name and password in git</a></p>
<pre><code>git config credential.helper store</code></pre>
<p>Alternativelly, it’s better to use ssh keys to connect to git
repositories.</p>
</div>
</div>
<div id="display-changes" class="section level1">
<h1>Display changes</h1>
<p>To view modified files that have not been committed and to view
commit history you can use:</p>
<pre><code>git status
git log

git log --pretty=oneline </code></pre>
<p>Show when the tip of branches have been updated</p>
<pre><code>git reflog</code></pre>
<p>Alternatively, call the repository browser with:</p>
<pre><code>gitk</code></pre>
<p>To view a shorter version of the log file, and get an idea at where I
am in the history:</p>
<pre><code>git log --graph --decorate --all --pretty=oneline</code></pre>
<p>You can define an alias for git log as explained be Fred here:</p>
<pre><code>git config --global alias.lg &quot;log --color --graph --pretty=format:&#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr)%C(bold blue)&amp;lt;%an&amp;gt;%Creset&#39; --abbrev-commit&quot; </code></pre>
<p>The new alias can then be used with</p>
<pre><code>git lg </code></pre>
<p>Use tags to specify important points in history, such as software
versions.</p>
<div id="diff-the-working-directory" class="section level2">
<h2>Diff the working directory</h2>
<p>Shows the changes between the working directory and the index.</p>
<pre><code>git diff</code></pre>
<p>Shows the changes between the index and the HEAD</p>
<pre><code>git diff --cached</code></pre>
<p>Shows all the changes between the working directory and HEAD</p>
<pre><code>git diff HEAD</code></pre>
<p>Compare between 2 commits</p>
<pre><code>git diff &lt;commit hash 1&gt; &lt;commit hash 2&gt;</code></pre>
<p><a href="https://stackoverflow.com/a/17803762/2641825">List all
revision of a given line number in the git history</a></p>
<pre><code>FILE=filename.csv
LINE=1
git log --format=format:%H $FILE | xargs -L 1 git blame $FILE -L $LINE,$LINE</code></pre>
<p>Useful to track different versions of CSV files headers.</p>
<div id="diff-csv-files" class="section level3">
<h3>Diff csv files</h3>
<p>To consider commas a separator when using word diff in csv file, you
can use</p>
<pre><code>git diff --word-diff-regex=&quot;[^[:space:],]+&quot;
# Or 
git diff --color-words=&quot;[^[:space:],]+&quot; x.csv y.csv</code></pre>
</div>
</div>
<div id="show-changes-in-previous-commits" class="section level2">
<h2>Show changes in previous commits</h2>
<p>Show which change happened in a particular commit</p>
<pre><code>git show &lt;commit-hash&gt;</code></pre>
<p>Show only word changes</p>
<pre><code>git show --word-diff &lt;commit-hash&gt;</code></pre>
</div>
<div id="blame" class="section level2">
<h2>Blame</h2>
<p>To see the commit number and author of each line in a file use</p>
<pre><code>git blame filename</code></pre>
</div>
</div>
<div id="illustrations" class="section level1">
<h1>Illustrations</h1>
<p><a href="https://en.wikipedia.org/wiki/File:Git_operations.svg">Data
flows and storage levels in the Git revision control system</a>.</p>
</div>
<div id="gitignore" class="section level1">
<h1>.gitignore</h1>
<p>To ignore all files in a folder but not the folder itself. Put this
.gitignore into the folder, then git add .gitignore</p>
<pre><code>*
!.gitignore</code></pre>
<p>To exclude everything except a specific directory foo/bar (note the
/* - without the slash, the wildcard would also exclude everything
within foo/bar):</p>
<pre><code>/*
!/foo
/foo/*
!/foo/bar</code></pre>
</div>
<div id="gitkeep" class="section level1">
<h1>.gitkeep</h1>
<p><a
href="https://stackoverflow.com/questions/115983/how-can-i-add-a-blank-directory-to-a-git-repository">So
question how can I add a blank directory to a git repository</a></p>
<p>some answers suggest using <code>.gitkeep</code> or simply
<code>.keep</code> because files starting with “.git” should be reserved
for git usage.</p>
</div>
<div id="git-run-to-automate-many-repositories" class="section level1">
<h1>Git run to automate many repositories</h1>
<p>Git run enables to pull from many repositories with a single
command</p>
<p>configuration was a bit complicated on debian</p>
<p>Install nodejs and npm from the backports</p>
<pre><code>sudo apt -t stretch-backports install nodejs
sudo apt -t stretch-backports install npm
sudo apt install build-essential</code></pre>
<p>Configure nmp to run only for the local user <a
href="https://stackoverflow.com/a/40905762/2641825">configure npm to use
a different directory</a> citing docs.npmjs.com <a
href="https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally#manually-change-npms-default-directory">Manually
change npm’s default directory</a></p>
<p>in your home directory, create a directory for global
installations:</p>
<pre><code>mkdir ~/.npm-global</code></pre>
<p>Configure npm to use the new directory path:</p>
<pre><code>npm config set prefix &#39;~/.npm-global&#39;</code></pre>
<p>Install Git run:</p>
<pre><code>npm install -g git-run</code></pre>
<p>Edit your bash profile:</p>
<pre><code>vim ~/.bash_aliases</code></pre>
<p>and add this line:</p>
<pre><code>export PATH=~/.npm-global/bin:$PATH</code></pre>
<p>Then the configuration file is a .json file on the home folder. Edit
it:</p>
<pre><code>vim ~/.grconfig.json</code></pre>
<p>For example:</p>
<pre><code>{
  &quot;tags&quot;: {
    &quot;all&quot;: [
      &quot;/home/paul/repos/bioeconomy_notes&quot;,
      &quot;/home/paul/repos/bioeconomy_papers&quot;,
      &quot;/home/paul/repos/cbm3_python&quot;,
      &quot;/home/paul/repos/cbmcfs3_data&quot;,
      &quot;/home/paul/repos/cbmcfs3_pub&quot;,
      &quot;/home/paul/repos/cbmcfs3_runner&quot;,
    ]
  }
}</code></pre>
<p>Show the status and pull from many repos:</p>
<pre><code>gr git status
gr git pull</code></pre>
</div>
<div id="going-back-in-time" class="section level1">
<h1>Going back in time</h1>
<div id="log" class="section level2">
<h2>Log</h2>
<p>Display the modification log</p>
<pre><code>git log </code></pre>
<p>In the log, you can copy the beginning of a commit hash for use as
<code>commit_sha</code> in the reset commands below.</p>
<p>Display the log of a particular branch (after a fetch for
example)</p>
<pre><code>git log origin/master </code></pre>
<p>Display the log of a particular file</p>
<pre><code>git log path/filename</code></pre>
<p>Display a compact log for one file or one directory only</p>
<pre><code>git log --abbrev-commit --pretty=oneline path_to_file</code></pre>
<p>Edit <code>~/.gitconfig</code> to define an alias that shows the last
10 log entries in a compact way:</p>
<pre><code>lkj    = log --graph --pretty=format:&#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(cyan)&lt;%an&gt;%Creset&#39; --abbrev-commit -10</code></pre>
<p>This alias also works with the log of one file only</p>
<pre><code>git lkj path/filename</code></pre>
<div id="commit-statistics" class="section level3">
<h3>Commit statistics</h3>
<p>Show the number of lines modified in each files for each commit:</p>
<pre><code>git log --numstat </code></pre>
<p>A one liner version showing the number of files changes, number of
lines inserted and deleted <a
href="https://stackoverflow.com/questions/21137477/how-to-get-git-log-with-short-stat-in-one-line">how
to get log with short stat in one line</a>:</p>
<pre><code>git log --pretty=&quot;@%h&quot;  --shortstat |  tr &quot;\n&quot; &quot; &quot; | tr &quot;@&quot; &quot;\n&quot;</code></pre>
</div>
<div id="export-the-log-to-csv" class="section level3">
<h3>Export the log to csv</h3>
<p>SO <a
href="https://stackoverflow.com/questions/10418056/how-do-i-generate-a-git-commit-log-for-the-last-month-and-export-it-as-csv/10418356">Export
git log as csv</a>:</p>
<pre><code>git log --pretty=format:&#39;%h,%an,%ad,&quot;%s&quot;&#39; --date=iso -10</code></pre>
<p>Edit <code>~/.gitconfig</code> to define it as an alias:</p>
<pre><code>logcsv = log --pretty=format:&#39;%h,%an,%ad,\&quot;%s\&quot;&#39; --date=iso</code></pre>
<p>Another version adding stats on the number of files changes, number
of lines inserted and deleted based on <a
href="https://stackoverflow.com/questions/21137477/how-to-get-git-log-with-short-stat-in-one-line">how
to get log with short stat in one line</a>:</p>
<pre><code>git log --pretty=format:&#39;linebegin%h,%an,%ad,&quot;%s&quot;&#39; --shortstat --date=iso |  tr &quot;\n&quot; &quot;,&quot; | sed -E &#39;s/linebegin|,*$/\n/g&#39;</code></pre>
<p>Simpler solution using paste to glue lines together (there is an
issue with extra spaces at the beginning and in the middle of some
lines):</p>
<pre><code>git log --pretty=format:&#39;%h,%an,%ad,&quot;%s&quot;,&#39; --shortstat --date=iso | paste - - - #&gt; /tmp/gitlog.csv</code></pre>
</div>
<div id="tig" class="section level3">
<h3>Tig</h3>
<p>The tig utility is a repository browser for git log and git diff.</p>
</div>
</div>
<div id="rewriting-history" class="section level2">
<h2>Rewriting history</h2>
<div id="amend-to-the-previous-commit" class="section level3">
<h3>Amend to the previous commit</h3>
<p>In case you entered a wrong commit message, you can edit the last
commit message with:</p>
<pre><code>git commit --amend </code></pre>
<p>In case you forgot a file, you can add a file to the last commit
with:</p>
<pre><code>git add filename
git commit --amend</code></pre>
<p>A comment in <a
href="https://stackoverflow.com/questions/14369155/how-to-change-past-commit-to-include-a-missed-file">How
to change past commit to include a missed file?</a> specifies that
commits before and after <code>--amend</code> have different hashes,
even if only the commit message is changed. The use of
<code>--amend</code> is only for private commits, which have not yet
been shared with others.</p>
<p>Rewriting commits older than the previous one is much harder. It
requires the use of git rebase. I regularly want to fix typo in the git
log, but it is not possible it was made unflexible on purpose. Explained
in this <a
href="https://stackoverflow.com/a/457396/2641825">Stackoverflow
Answer</a></p>
<blockquote>
<p>“The real reason git doesn’t allow you to change the commit message
ends up being very simple: that way, you can trust the messages. If you
allowed people to change them afterwards, the messages are inherently
not very trustworthy.”</p>
</blockquote>
</div>
<div id="rebase-your-changes-on-top-of-the-remote-head-commit"
class="section level3">
<h3>Rebase your changes on top of the remote head commit</h3>
<p>It is safe to use rebase as long as the commits have not been pushed
to another repository. To rename older commits, simply run:</p>
<pre><code>git rebase -i
git rebase -i @~9   # Show the last 9 commits in a text editor</code></pre>
<p>Rebase will show the last 3 commits by default in the vim editor.
Each line starts with “pick” followed by the commit hash and commit
message. You can then replace the “pick” word in the vim editor by the
command you want to achieve, press “escape”, “:wq” and peform the git
command on the selected commit.</p>
<p>See also :</p>
<ul>
<li>Answers to a StackOverflow question<br />
<a
href="https://stackoverflow.com/questions/1186535/how-to-modify-a-specified-commit">How
to modify a specified commit?</a>.</li>
<li><a
href="https://stevebennett.me/2012/02/24/10-things-i-hate-about-git/">10
things I hate about git</a> Translation of the man page which he
considers hard to understand: “git-rebase – Sequentially regenerate a
series of commits so they can be applied directly to the head node”</li>
</ul>
</div>
<div id="git-history-when-changing-a-licence" class="section level3">
<h3>Git history when changing a licence</h3>
<p><a href="https://opensource.stackexchange.com/a/6952/28620">SO
question</a> in a case where the project was not made available publicly
yet.</p>
<ul>
<li>Use <code>rebase -i</code></li>
<li>or use <code>git filter-branch</code></li>
</ul>
</div>
</div>
<div id="clean" class="section level2">
<h2>Clean</h2>
<p>Remove all files also those not tracked by git because they are in
.gitignore. For example output pdf files and auxiliary files generated
from latex or from pandoc.</p>
<pre><code>git clean -xf</code></pre>
<p>Remove local (untracked) files from my current Git branch</p>
<p>Show what will be deleted with the -n option:</p>
<pre><code>git clean -f -n</code></pre>
<p>Then - beware: this will delete files - run:</p>
<pre><code>git clean -f </code></pre>
<p>Alternatively clean in interactive mode:</p>
<pre><code>git clean -i</code></pre>
</div>
<div id="reset-whole-folder" class="section level2">
<h2>Reset whole folder</h2>
<p>Identify the commit identity in the log and copy its sha number. Then
to go back to this state for the whole folder:</p>
<pre><code>git reset --hard commit_sha</code></pre>
<p>Do this <strong>before pushing</strong> only!</p>
<p>Once you have pushed the changes, you need to revert the commit and
commit those changes as well:</p>
<pre><code>git revert -m 1 HEAD~
git revert commit_sha</code></pre>
<p>See <a
href="https://stackoverflow.com/questions/9804211/can-not-push-changes-after-using-git-reset-hard"
class="uri">https://stackoverflow.com/questions/9804211/can-not-push-changes-after-using-git-reset-hard</a></p>
<p>Use the begining of a <code>commit_sha</code> copied from the
log.</p>
<p>To remove a commit where I accidentaly commited a very large file. I
used <a href="https://stackoverflow.com/a/39768343/2641825">how to
remove a too large file in a commit</a>:</p>
<pre><code>git reset HEAD^</code></pre>
<p>Then added the large file to .gitignore and committed again.</p>
</div>
<div id="reset-only-one-file" class="section level2">
<h2>Reset only one file</h2>
<p>To go back to this state for only one file, see git checkout</p>
<pre><code>git checkout commit_hash  path_to_file/file_name</code></pre>
<p>No need to enter the commit hash to get to get the file from the
latest commit</p>
<pre><code>git checkout path_to_file/file_name</code></pre>
<p>Checkout the older revision of a file under a new name</p>
<pre><code>git show commit_sha:filename &gt; new_file_name</code></pre>
<p>See also alias and git grep below.</p>
</div>
<div id="revert" class="section level2">
<h2>Revert</h2>
<p>Revert an unwanted commit with a new commit doing exactly the reverse
operation</p>
<pre><code>git revert &lt;commit hash&gt;</code></pre>
<p>Linus Torvald’s <a
href="Linus%20Torvald&#39;s%20advice%20on%20reverting%20a%20merge">advice
on reverting a merge</a></p>
<blockquote>
<p>“When you have a problem you are chasing down, and you hit a”revert
this merge”, what you’re hitting is essentially a single commit that
contains all the changes (but obviously in reverse) of all the commits
that got merged. So it’s debugging hell, because now you don’t have lots
of small changes that you can try to pinpoint which <em>part</em> of it
changes.</p>
</blockquote>
<blockquote>
<p>But does it all work? Sure it does. You can revert a merge, and from
a purely technical angle, Git did it very naturally and had no real
troubles. It just considered it a change from “state before merge” to
“state after merge”, and that was it. Nothing complicated, nothing odd,
nothing really dangerous. Git will do it without even thinking about
it.</p>
</blockquote>
<blockquote>
<p>So from a technical angle, there’s nothing wrong with reverting a
merge, but from a workflow angle it’s something that you generally
should try to avoid.</p>
</blockquote>
<blockquote>
<p>If at all possible, for example, if you find a problem that got
merged into the main tree, rather than revert the merge, try
<em>really</em> hard to bisect the problem down into the branch you
merged, and just fix it, or try to revert the individual commit that
caused it.</p>
</blockquote>
<blockquote>
<p>Yes, it’s more complex, and no, it’s not always going to work
(sometimes the answer is: “oops, I really shouldn’t have merged it,
because it wasn’t ready yet, and I really need to undo <em>all</em> of
the merge”). So then you really should revert the merge, but when you
want to re-do the merge, you now need to do it by reverting the
revert.”</p>
</blockquote>
</div>
</div>
<div id="going-forward-in-time" class="section level1">
<h1>Going forward in time</h1>
<div id="cherry-pick-one-commit" class="section level2">
<h2>Cherry pick one commit</h2>
<p>I was on a dev branch and committed a change to the README file. But
in fact I wanted this change - related to installations instructions -
to be visible by all users immediately. So that commit should have been
on the main branch. The problem is that I had other commit in the dev
branch that were not ready yet to be shared on the main branch. In order
to pick just the commit that changed the README file and put it in the
main branch I did:</p>
<pre><code>git cherry-pick &lt;commit-hash&gt;</code></pre>
</div>
</div>
<div id="gui-graphical-user-interface" class="section level1">
<h1>GUI Graphical User Interface</h1>
<p>For colleagues who need a GUI:</p>
<ul>
<li><a href="http://gitextensions.github.io/"
class="uri">http://gitextensions.github.io/</a> recommended on <a
href="http://gitextensions.github.io/">this SO answer</a></li>
<li><a href="https://desktop.github.com/">Github Desktop</a></li>
</ul>
<p>A section of the git book on <a
href="https://git-scm.com/book/en/v2/Appendix-A%3A-Git-in-Other-Environments-Graphical-Interfaces">Graphical
User Interfaces</a> describes the default git-gui and gitk graphical
user interfaces to prepare commits and view the git log history. It also
describes the github desktop client and in particular it’s “sync”
feature:</p>
<blockquote>
<p>“The main way you interact with other repositories over the network
is through the “Sync” feature. Git internally has separate operations
for pushing, fetching, merging, and rebasing, but the GitHub clients
collapse all of these into one multi-step feature. Here’s what happens
when you click the Sync button:</p>
<pre><code>git pull --rebase. If this fails because of a merge conflict, fall back to git pull --no-rebase.
git push.</code></pre>
<p>This is the most common sequence of network commands when working in
this style, so squashing them into one command saves a lot of time.
”</p>
</blockquote>
</div>
<div id="help" class="section level1">
<h1>Help</h1>
<p>Get help on a command (will start a web browser):</p>
<pre><code>git init --help</code></pre>
</div>
<div id="hosting-services" class="section level1">
<h1>Hosting services</h1>
<div id="gitlab" class="section level2">
<h2>Gitlab</h2>
<div id="issue-triage" class="section level3">
<h3>Issue triage</h3>
<p>On the Gitlab labels page:</p>
<blockquote>
<p>“Labels can be applied to issues and merge requests. Star a label to
make it a priority label. Order the prioritized labels to change their
relative priority, by dragging.”</p>
</blockquote>
<p><a
href="https://about.gitlab.com/handbook/engineering/quality/issue-triage/#priority">Issue
triage by priority</a></p>
<table>
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th>Priority</th>
<th>Importance</th>
<th>Intention</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>~priority::1</code></td>
<td>Urgent</td>
<td>We will address this as soon as possible regardless of the limit on
our team capacity.</td>
</tr>
<tr class="even">
<td><code>~priority::2</code></td>
<td>High</td>
<td>We will address this soon and will provide capacity from our team
for it in the next few releases.</td>
</tr>
<tr class="odd">
<td><code>~priority::3</code></td>
<td>Medium</td>
<td>We want to address this but may have other higher priority
items.</td>
</tr>
<tr class="even">
<td><code>~priority::4</code></td>
<td>Low</td>
<td>We don’t have visibility when this will be addressed.</td>
</tr>
</tbody>
</table>
</div>
<div id="ci-continuous-integration" class="section level3">
<h3>CI Continuous Integration</h3>
<p>By default, job artifacts are not kept on failure. To enable this add
a <code>when</code> clause to <code>.gitlab-ci.yaml</code></p>
<pre><code>  artifacts:
    when: always
    paths:
    - notebooks</code></pre>
</div>
<div id="gitlab-pages" class="section level3">
<h3>gitlab pages</h3>
<p>Site URL available in the project repository under Settings/Pages</p>
<blockquote>
<p>The app’s built output files are in a folder named “public”</p>
</blockquote>
<p>The public folder also needs to be published as an artifact. See the
<code>.gitlab-ci.yml</code> file in this repository.</p>
</div>
<div id="deploy-token" class="section level3">
<h3>Deploy token</h3>
<p>Create a deploy token on the repository page. It also works at the
project level for several repos.</p>
<p>A deploy token makes it possible to clone in an unauthenticated
way.</p>
<p><a
href="git%20clone%20https://username:token@gitlab.com/user/repo.git">SO
answer</a></p>
<pre><code>git clone https://username:token@gitlab.com/user/repo.git</code></pre>
<div id="usage-quotas" class="section level4">
<h4>Usage quotas</h4>
<p>Check usage quotas for a group at (replace group_name by the actual
group name):</p>
<pre><code>https://gitlab.com/groups/group_name/-/usage_quotas</code></pre>
<p>For a user at (link works as is):</p>
<pre><code>https://gitlab.com/-/profile/usage_quotas#pipelines-quota-tab</code></pre>
</div>
</div>
</div>
</div>
<div id="line-endings" class="section level1">
<h1>Line endings</h1>
<p><a
href="https://stackoverflow.com/questions/7156694/git-how-to-renormalize-line-endings-in-all-files-in-all-revisions">How
to renormalize line endings in all files in all revisions?</a></p>
<pre><code>git add --renormalize .</code></pre>
<p>This is usually taken care of at the system level. But sometimes when
you share files with windows machines (accessing them on a shared folder
for example) you end up with commits that show a lot of modifications
because the windows line ending LRLF appears in the linux machine. <a
href="https://help.github.com/en/github/using-git/configuring-git-to-handle-line-endings">Configuring
git to handle line endings</a> To force the line ending to be LF only,
create a .gitattributes file which contains:</p>
<pre><code>text eol=lf</code></pre>
</div>
<div id="publishing-project-documentation" class="section level1">
<h1>Publishing project documentation</h1>
<div id="on-github" class="section level2">
<h2>On Github</h2>
<p>Older content related to pages built from branches.</p>
<p>SO answer to the question “How to add a git repo as a submodule of
itself? (Or: How to generate GitHub Pages programmatically?)”: An
alternative to using Git Submodules to generate GitHub Pages is to use
Git Subtree Merge Strategy.</p>
<p>In fact I didn’t use quite that strategy and I instead cloned a
temporary copy of my repository. Created the gh-page branch. Pushed it
to github. Then I went back to the original repository (where I have a
few large untracked data files I find handy to keep for analyses
purposes).</p>
<p>Then within the inst folder, I cloned only the gh-branch. To clone
only one branch:</p>
<pre><code>git clone -b mybranch --single-branch git://sub.domain.com/repo.git</code></pre>
<p>Then I renamed the folder to “web”, so that I had a inst/web folder,
tracking the gh-branch. inst/web is ignored in the main repository.</p>
</div>
<div id="on-gitlab" class="section level2">
<h2>On Gitlab</h2>
<p>Gitlab has an integrated CI mechanism, * <a
href="https://docs.gitlab.com/ee/user/project/pages/getting_started/pages_ci_cd_template.html">Create
a pages website by using a CI / CD template</a> * <a
href="https://www.r-bloggers.com/2020/09/rendering-an-r-markdown-presentation-to-gitlab-pages/">Rendering
an R markdown presentation to gitlab pages</a> uses the
<code>rocker/verse:4.0.0</code> docker image. Posted on September 16,
2020. * <a href="https://rlesur.gitlab.io/bookdown-gitlab-pages/">GitLab
CI for your bookdown project</a> Uses the
<code>rocker/verse:4.0.2</code> docker image. Posted on 2020-09-08. A
setup generating pages for the master branch and also for merge
requests.</p>
<p>To generate html pages from markdown and publish them, I added a
<code>.gitlab-ci.yml</code> to the repository. The CI deployment is
visible on the <a
href="https://gitlab.com/paulrougieux/paulrougieux/-/jobs">paulrougieux.jobs</a>
page. Clicking on “running” displays the latest activity of an ongoing
build. It starts with “Pulling docker image rocker/verse:4.0.0 …”. Once
the build is finished, the completed page is visible at <a
href="https://paulrougieux.gitlab.io/paulrougieux/"
class="uri">https://paulrougieux.gitlab.io/paulrougieux/</a></p>
</div>
</div>
<div id="remote" class="section level1">
<h1>Remote</h1>
<p><a href="https://git-scm.com/docs/git-remote#git-remote-emaddem">Add
a remote repository</a> with:</p>
<pre><code>git remote add git@github.com:paulrougieux/paulrougieux.github.io.git
# or
git remote add reponame https://repositoryurl </code></pre>
<p><a
href="https://git-scm.com/docs/git-remote#git-remote-emset-urlem">Change
the url of a remote repository</a></p>
<pre><code>git remote set-url origin git@github.com:paulrougieux/paulrougieux.github.io.git</code></pre>
<p>When a repository is connected to several remote repositories, you
can push content to repositories by specifying their names</p>
<pre><code>git push -u origin master
git push -u anotherrepository master</code></pre>
<p>To change the default git remote, push with :</p>
<pre><code>git push -u origin master</code></pre>
<p>Then later push of that branch to that remote can be made simply
with:</p>
<pre><code>git push</code></pre>
<p>Another command without specifying the remote and the branch</p>
<pre><code>$ git push -u

fatal: The current branch master has no upstream branch.
To push the current branch and set the remote as upstream, use
    git push --set-upstream origin master</code></pre>
<p>After I run this set upstream flag, I can push to the remote server.
Then I get this message</p>
<pre><code>[...]
 * [new branch]      master -&amp;gt; masterBranch master set up to track remote branch master from origin. </code></pre>
<p>I’ll have to figure out what this does.</p>
<div id="push-to-multiple-remotes" class="section level2">
<h2>Push to multiple remotes</h2>
<p>Based on <a
href="https://jigarius.com/blog/multiple-git-remote-repositories">this
blog post</a> I added the push remote twice to the origin repo as such
:</p>
<pre><code>git remote set-url --add --push origin  git@gitlab.com:paulrougieux/paulrougieux.git
git remote set-url --add --push origin  git@github.com:paulrougieux/paulrougieux.github.io.git</code></pre>
<p>The output of git push -v shows that it is now pushing to both
repositories</p>
<pre><code>git push -v
Pushing to git@gitlab.com:paulrougieux/paulrougieux.git
To gitlab.com:paulrougieux/paulrougieux.git
 = [up to date]      master -&gt; master
updating local tracking ref &#39;refs/remotes/origin/master&#39;
Everything up-to-date
Pushing to git@github.com:paulrougieux/paulrougieux.github.io.git
To github.com:paulrougieux/paulrougieux.github.io.git
 = [up to date]      master -&gt; master
updating local tracking ref &#39;refs/remotes/origin/master&#39;
Everything up-to-date</code></pre>
</div>
<div id="pull-rebase-versus-merge" class="section level2">
<h2>Pull rebase versus merge</h2>
<p><a
href="https://sdqweb.ipd.kit.edu/wiki/Git_pull_--rebase_vs._--merge">Explanation
on rebase versus merge</a></p>
<blockquote>
<p>“If you pull remote changes with the flag –rebase, then your local
changes are <strong>reapplied on top</strong> of the remote
changes.”</p>
</blockquote>
<pre><code>git pull --rebase</code></pre>
<blockquote>
<p>“If you pull remote changes with the flag –merge, which is also the
default, then your local changes are merged with the remote changes.
This results in a <strong>merge commit</strong> that points to the
latest local commit and the latest remote commit.”</p>
</blockquote>
<pre><code>git pull --merge</code></pre>
<blockquote>
<p>“It is best practice to always rebase your local commits when you
pull before pushing them.”</p>
</blockquote>
<p>This can be set as a global configuration with</p>
<pre><code>git config --global pull.rebase true</code></pre>
</div>
</div>
<div id="rename-and-delete-files" class="section level1">
<h1>Rename and delete files</h1>
<p>Rename a file</p>
<pre><code>git mv file_name file_name_new</code></pre>
<p>Change the case of a file on a windows FAT 32 system:</p>
<pre><code>git mv load.r load2.R
git mv load2.R load.R</code></pre>
<p>If a file or folder has been renamed outside of git, I get this
warning:</p>
<pre><code>$ git add .
warning: You ran &#39;git add&#39; with neither &#39;-A (--all)&#39; or &#39;--ignore-remo
whose behaviour will change in Git 2.0 with respect to paths you removed
Paths like &#39;docs/efi/efi_logo_rgb_small_siw.jpg&#39; that are
removed from your working tree are ignored with this version of Git.

* &#39;git add --ignore-removal &#39;, which is the current default,
  ignores paths you removed from your working tree.

* &#39;git add --all &#39; will let you also record the removals.</code></pre>
<p>Therefore I think I should always run “git add –all” after I have
removed or renamed files.</p>
</div>
<div id="replace-and-search-text" class="section level1">
<h1>Replace and search text</h1>
<div id="searching-text-with-grep" class="section level2">
<h2>Searching text with grep</h2>
<p>Example from the git grep help page. Looks for time_t in all tracked
.c and .h files in the working directory and its subdirectories.</p>
<pre><code>git grep &#39;time_t&#39; -- &#39;*.[ch]&#39;</code></pre>
<p>Search all files in the subdirectory “subdir” for lines containing
the words “factor” and “item”. Show 2 lines of context (2 leading and 2
trailing lines).</p>
<pre><code>git grep -e item --and -e factor -C 2 -- subdir/</code></pre>
<p>Search all R markdown files containing the word lyx ignore the
case:</p>
<pre><code>git grep -i lyx -- *.Rmd</code></pre>
<p>Stackoverflow: <a
href="https://stackoverflow.com/questions/2928584/how-to-grep-search-committed-code-in-the-git-history">How
to search committed code in the git history?</a></p>
<p>Search in all possible locations in all commits</p>
<pre><code>git grep &lt;regexp&gt; $(git rev-list --all)</code></pre>
<p>Search for a particular location in the git repo</p>
<pre><code>git grep &lt;regexp&gt; $(git rev-list --all -- lib/util) -- lib/util</code></pre>
<p>The above grep commands will give you a list of commit sha where the
grep pattern was present in the repo. You can then checkout the older
revision of a file under a new name</p>
<pre><code>git show commit_sha:filename &gt; new_file_name</code></pre>
<div id="unique-results" class="section level3">
<h3>Unique results</h3>
<p>Get unique list of import statements in python files</p>
<pre><code>git grep -h  import -- &quot;*.py&quot; | sort --unique</code></pre>
</div>
<div id="searching-for-two-terms-on-the-same-line"
class="section level3">
<h3>Searching for two terms on the same line</h3>
<p>For example:</p>
<pre><code>git grep -e module_dir --and -e &quot;import&quot;</code></pre>
</div>
<div id="excluding-a-pattern-from-the-search" class="section level3">
<h3>Excluding a pattern from the search</h3>
<p>For example (<a
href="https://stackoverflow.com/questions/56203430/how-to-use-git-grep-not">SO</a>):</p>
<pre><code>git grep -e &quot;index=True&quot; --and --not -e &quot;ignore_index&quot;</code></pre>
</div>
</div>
<div id="replacing-strings" class="section level2">
<h2>Replacing strings</h2>
<p>Use git grep to replace strings in many files in the directory :</p>
<pre><code>git grep -l &#39;original_text&#39; | xargs sed -i &#39;s/original_text/new_text/g&#39;</code></pre>
<p>See also the refactor function in the <a href="bash.html">bash</a>
page.</p>
</div>
</div>
<div id="statistics" class="section level1">
<h1>Statistics</h1>
<p>Count the number of lines of code for each language in a remote git
repository according to this <a
href="https://stackoverflow.com/a/29012789/2641825">stackoverflow
answer</a></p>
<pre><code>#!/usr/bin/env bash
git clone --depth 1 &quot;$1&quot; temp-linecount-repo &amp;&amp;
  printf &quot;(&#39;temp-linecount-repo&#39; will be deleted automatically)\n\n\n&quot; &amp;&amp;
  cloc temp-linecount-repo &amp;&amp;
  rm -rf temp-linecount-repo</code></pre>
<blockquote>
<p>“This script requires CLOC (“Count Lines of Code”) to be installed.
cloc can probably be installed with your package manager”</p>
</blockquote>
<pre><code>sudo apt install cloc</code></pre>
<blockquote>
<p>“You can install the script by saving its code to a file
<code>cloc-git</code>, running <code>chmod +x cloc-git</code>, and then
moving the file to a folder in your <code>$PATH</code> such as
<code>/usr/local/bin</code>.”</p>
</blockquote>
<p>Usage</p>
<pre><code>cloc-git https://github.com/evalEmpire/perl5i.git</code></pre>
</div>
<div id="tagging" class="section level1">
<h1>Tagging</h1>
<p>Creating an annotated tag</p>
<pre><code>git tag -a v1.4 -m &#39;my version 1.4&#39;
git tag v0.0.2  -m &quot;Version 0.0.2&quot;</code></pre>
<p>A regular push command won’t push a tag (bitbucket), to push all your
tags :</p>
<pre><code>git push origin --tags</code></pre>
<p>List tags</p>
<pre><code>git tag -l</code></pre>
<p>You can add a tag after the fact. To tag an earlier commit, specify
the commit checksum or part of it:</p>
<pre><code>git log --pretty=oneline

git tag -a v1.2 -m &#39;version 1.2&#39; 9fceb02</code></pre>
<p>Delete a tag</p>
<pre><code>git tag -d tag_name</code></pre>
<p>To delete a tag on the remote server as well</p>
<pre><code>git push --delete origin tagname</code></pre>
<p>Return all files in the repository to a particular tag:</p>
<pre><code>git checkout tags/v0.1</code></pre>
<p>Optionally you can checkout and create a new branch to commit your
changes with:</p>
<pre><code>git checkout tags/o.1 -b newbranchname</code></pre>
<p>Git tools <a
href="https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work">signing
your work</a>Signed tags Generate a pgp key</p>
<pre><code>gpg --gen-key</code></pre>
<p>More information on gpg key publishing in the <a
href="bash.html">bash page</a>. Display what keys are available</p>
<pre><code>gpg --list-keys</code></pre>
<p>Configure git to use the key</p>
<pre><code> git config --global user.signingkey 0A46826A
 git config --global user.signingkey CC44A3EC868FDAE69F0E57148A77836103E2ADB0</code></pre>
<div id="push-tags" class="section level2">
<h2>Push tags</h2>
<p>A regular push command won’t push a tag (bitbucket), to push all your
tags :</p>
<pre><code>git push origin --tags</code></pre>
<p>Or</p>
<pre><code>git push --tags</code></pre>
</div>
</div>
<div id="to-do-lists" class="section level1">
<h1>TO DO lists</h1>
<p>In one repo:</p>
<pre><code>git grep TODO</code></pre>
<p>In multiple repos (using git run):</p>
<pre><code>gr git grep &quot;^TODO &quot;</code></pre>
</div>
<div id="uploading-content-to-online-git-platforms"
class="section level1">
<h1>Uploading content to online git platforms</h1>
<p>Git is useful as a version management on its own. But it’s even more
usefull when code can be back-up online. * Free public git storage is
availble on <a href="http://github.com/">Github</a>. * Free public and
private git storage are available on <a
href="http://bitbucket.org/">Bitbucket</a>, with up to 5 collaborators
per project. * Free public and private git storage are available on <a
href="https://gitlab.com/">Gitlab</a>.</p>
<p>Commands I’ve used to upload content to an existing repository
github.com/paul4forest/forestproductsdemand are:</p>
<pre><code>    git remote add origin https://github.com/paul4forest/forestproductsdemand
    git pull origin master
    git add
    git commit -m &quot;Explanatory message&quot;
    git push origin master</code></pre>
<p>Commands to upload content to a fresh repository from bitbucket :</p>
<pre><code>    mkdir /path/to/your/project
    cd /path/to/your/project
    git init
    git remote add origin ssh://git@bitbucket.org/username/bbreponame.git
    # Upload and set the local changes as upstream
    git push -u origin master</code></pre>
<p>See also this discussion on <a
href="http://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time">why
do I need to set upstream</a>?</p>
<p>Commands to copy an existing repository from bitbucket :</p>
<pre><code> git clone git@bitbucket.org/username/bbreponame.git</code></pre>
<div id="setting-up-ssh-keys" class="section level2">
<h2>Setting up SSH keys</h2>
<p>See <a
href="https://help.github.com/en/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Generating
a new SSH key and adding it to the ssh-agent</a> and <a
href="https://help.github.com/en/articles/adding-a-new-ssh-key-to-your-github-account">Adding
a new SSH key to your GitHub account</a></p>
<p>To test if my new ssh key worked with github, I created a branch and
pushed it to github. Then I deleted the branch locally and remotely:</p>
<pre><code>git branch &quot;key&quot;
git checkout key
git push --set-upstream origin key
# Checked that the &quot;key&quot; branch became visible on github
git checkout master
git branch -d key
git push origin --delete key</code></pre>
</div>
</div>
<div
id="stash-to-keep-uncommitted-changes-in-the-current-branch-while-working-quickly-in-another-branch"
class="section level1">
<h1>Stash to Keep uncommitted changes in the current branch while
working quickly in another branch</h1>
<p>For example you edit a file in branch develop</p>
<pre><code>git checkout develop
echo &quot;blabla&quot; &gt; newfile.txt</code></pre>
<p>Imagine you are in the middle of your work and need to do an urgent
modification in another branch. To move to another branch, you would
normaly need to commit this change. If you don’t want to commit the
change yet. You can store temporary changes with the command:</p>
<pre><code>git stash</code></pre>
<p>Move to the master branch</p>
<pre><code>git checkout master
# perform important operation in the master branch.</code></pre>
<p>Get back to the develop branch and reload uncommited changes</p>
<pre><code>git checkout develop
git stash pop</code></pre>
</div>
<div id="subversion" class="section level1">
<h1>Subversion</h1>
<p>Subversion is another version control system. It is different than
git and should be on another page, but since I don’t expect to use it
very much, it probably makes sense to keep a Subversion section under
the git page here. See also wiki.debian.org <a
href="https://wiki.debian.org/SmallSVNTutorial">small SVN
tutorial</a>.</p>
<p>Install subversion from the Debian repository</p>
<pre><code>sudo apt install subversion</code></pre>
<p>Load the latest version of some repository</p>
<pre><code>svn checkout --username yourusername http://repositoryurl</code></pre>
<p>Get help on a command</p>
<pre><code>svn help log</code></pre>
<p>See the last 4 log entries</p>
<pre><code>svn log -l 4</code></pre>
<p>Bring changes from the repository HEAD into the working copy</p>
<pre><code>svn up</code></pre>
<p>synchronize working copy to revision given by -r.</p>
<pre><code>svn up -r10860</code></pre>
<p>show the status</p>
<pre><code>svn status</code></pre>
<p>show differences</p>
<pre><code>svn diff</code></pre>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Presentations:</p>
<pre><code>Power Your Workflow With Git (towards 43 minutes, an animation of branches and merging) A recommendation if you work in a team, don&#39;t use pull, but use fetch + merge.
Getting Started with GitHub + Git</code></pre>
<p>Workflow:</p>
<pre><code>Mixing private and public repository in Git workflow</code></pre>
<p>Book:</p>
<ul>
<li><a href="https://git-scm.com/book/en/v2">Pro Git book</a> good
introduction.</li>
</ul>
<p>Tutorial:</p>
<ul>
<li>Git foundations</li>
<li><a
href="https://www.willingconsulting.com/post/2019-07-01-locations-and-git/">Definition
and pictures of git and related services</a></li>
</ul>
<p>Blogs:</p>
<ul>
<li><a
href="https://stevebennett.me/2012/02/24/10-things-i-hate-about-git/">10
things I hate about git</a></li>
<li><a href="http://fperez.org/py4science/git.html">list of git
resources</a> by Fernando Perez, the creator of ipython</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
